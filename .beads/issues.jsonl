{"id":"agentic_coding_flywheel_setup-01s","title":"Add --deep flag to acfs doctor","description":"# Task: Add --deep flag to acfs doctor\n\n## Context\nPart of EPIC: Enhanced Doctor with Functional Tests (agentic_coding_flywheel_setup-t9i)\n\n## What to Do\nAdd --deep flag to doctor.sh that enables functional tests beyond binary existence:\n\n### Argument Parsing\n- Add DEEP_MODE=false global\n- Parse --deep flag alongside existing --json\n- --deep and --json can be combined\n\n### Conditional Execution\n```bash\nif [[ \"$DEEP_MODE\" == \"true\" ]]; then\n    run_deep_checks\nfi\n```\n\n### Help Text\n```\nOptions:\n  --json     Output in JSON format\n  --deep     Run functional tests (auth, connections)\n```\n\n## Acceptance Criteria\n- --deep flag parsed correctly\n- Default doctor unchanged (fast, existence only)\n- --deep runs additional tests\n- Works with --json for structured output\n\n## Files to Modify\n- scripts/lib/doctor.sh: Argument parsing","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T12:45:17.480684-05:00","updated_at":"2025-12-21T14:47:39.076269-05:00","closed_at":"2025-12-21T14:47:39.076269-05:00","close_reason":"Added --deep flag to doctor.sh with DEEP_MODE global, run_deep_checks() function containing agent auth, database connectivity, and cloud CLI checks. Updated help text and verified --deep and --json work together."}
{"id":"agentic_coding_flywheel_setup-066","title":"Implement acfs session import with --dry-run","description":"# Task: Implement acfs session import with --dry-run\n\n## Purpose\nAllow importing sessions from other installations, primarily for VIEWING and REFERENCE, not automated replay.\n\n## Critical Reframe: Import for Reference, Not Replay\n\n**Original concept:** Import sessions and \"replay\" them to reproduce setups.\n**Problem:** Automated replay is dangerous and rarely what users want.\n**Better concept:** Import sessions to VIEW what was done, learn from them, manually apply.\n\n### Use Cases (Realistic)\n1. **Team learning:** \"How did Sarah set up the database? Let me import her session and see.\"\n2. **Debugging:** \"What commands led to this error? Import and view the session.\"\n3. **Documentation:** \"Import production setup session, export as markdown for wiki.\"\n4. **Backup restore:** \"I reformatted, let me see what I had installed before.\"\n\n### NOT a Use Case\n- ❌ \"Automatically replay 500 commands to recreate environment\"\n- ❌ \"Run someone elses session as a script\"\n\n## Implementation\n\n```bash\n# Primary use: import for viewing\nacfs session import session-export.json\n# → Imports to local session storage\n# → Output: \"Imported session abc123. View with: acfs session show abc123\"\n\n# Dry-run shows what WOULD be imported (for safety)\nacfs session import --dry-run session-export.json\n# → Shows session metadata, command count, date range\n# → Does NOT import\n\n# View imported session (the main value)\nacfs session show abc123\n# → Displays session with timestamps, commands, outputs\n# → Searchable, browsable\n\n# Export to markdown for documentation\nacfs session show abc123 --format=markdown \u003e setup-notes.md\n```\n\n### Import Safety\n```bash\nimport_session() {\n    local file=\"$1\"\n    local dry_run=\"${2:-false}\"\n    \n    # Validate JSON structure\n    if \\! jq -e \".version and .commands\" \"$file\" \u0026\u003e/dev/null; then\n        log_error \"Invalid session format\"\n        return 1\n    fi\n    \n    # Check version compatibility\n    local version=$(jq -r \".version\" \"$file\")\n    if [[ \"$version\" \\!= \"1.0\" ]]; then\n        log_warn \"Session version $version may not be fully compatible\"\n    fi\n    \n    # Show summary\n    local cmd_count=$(jq \".commands | length\" \"$file\")\n    local date_range=$(jq -r \"\\\"\\\\(.commands[0].timestamp) to \\\\(.commands[-1].timestamp)\\\"\" \"$file\")\n    \n    echo \"Session Summary:\"\n    echo \"  Commands: $cmd_count\"\n    echo \"  Date Range: $date_range\"\n    echo \"  Source: $(jq -r \".metadata.hostname // \\\"unknown\\\"\" \"$file\")\"\n    \n    if [[ \"$dry_run\" == \"true\" ]]; then\n        echo \"\"\n        echo \"(Dry run - nothing imported)\"\n        return 0\n    fi\n    \n    # Actually import\n    local session_id=$(generate_session_id)\n    mkdir -p \"$ACFS_SESSIONS_DIR\"\n    cp \"$file\" \"$ACFS_SESSIONS_DIR/$session_id.json\"\n    \n    echo \"\"\n    echo \"Imported as: $session_id\"\n    echo \"View with: acfs session show $session_id\"\n}\n```\n\n## No Replay Command\nWe intentionally do NOT implement `acfs session replay`. If users want to re-run commands:\n1. View the session\n2. Copy commands they want\n3. Run them manually with understanding\n\nThis is safer and more educational.\n\n## Dependencies\n- Depends on: Session schema (agentic_coding_flywheel_setup-c61)\n- Depends on: Session sanitization (agentic_coding_flywheel_setup-1xq)\n\n## Acceptance Criteria\n- [ ] Import saves session to local storage for viewing\n- [ ] --dry-run shows summary without importing\n- [ ] Clear output pointing to `acfs session show`\n- [ ] No automated replay functionality\n- [ ] Version compatibility warning","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T12:46:40.664925-05:00","updated_at":"2025-12-21T15:53:52.474506-05:00","closed_at":"2025-12-21T15:53:52.474506-05:00","close_reason":"Implemented session import in session.sh: (1) import_session() with --dry-run for safety preview, (2) show_session() with --format json|markdown|summary, (3) list_imported_sessions() for browsing imports, (4) Auto-detects CASS vs ACFS format and converts, (5) Stores in ~/.acfs/sessions/. No replay functionality per design. All acceptance criteria met.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-066","depends_on_id":"agentic_coding_flywheel_setup-wsj","type":"blocks","created_at":"2025-12-21T12:47:40.323082-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-0ge","title":"[ubu.4] Implement upgrade execution logic","description":"# Implement Upgrade Execution Logic\n\n## Purpose\nCore logic for executing do-release-upgrade non-interactively with proper error handling.\n\n## Key Functions\n\n### ubuntu_prepare_upgrade()\nPrepares system for upgrade:\n```bash\n# 1. Update package lists\napt-get update\n\n# 2. Install any pending upgrades\napt-get dist-upgrade -y\n\n# 3. Install update-manager-core if missing\napt-get install -y update-manager-core\n\n# 4. Clean up old packages\napt-get autoremove -y\napt-get clean\n```\n\n### ubuntu_do_upgrade()\nPerforms the actual upgrade:\n```bash\n# Run do-release-upgrade non-interactively\n# -f DistUpgradeViewNonInteractive: No prompts\n# -m server: Use server release channels\nDEBIAN_FRONTEND=noninteractive \\\n  do-release-upgrade \\\n    -f DistUpgradeViewNonInteractive \\\n    -m server \\\n    2\u003e\u00261 | tee -a \"$UPGRADE_LOG\"\n```\n\n### ubuntu_trigger_reboot()\nHandles reboot with state preservation:\n```bash\n# Update state to indicate reboot needed\nstate_upgrade_needs_reboot\n\n# Sync filesystem\nsync\n\n# Delay to ensure state is written\nsleep 2\n\n# Reboot\nsystemctl reboot\n```\n\n## Non-Interactive Mode Details\n\ndo-release-upgrade has several ways to run non-interactively:\n\n1. **-f DistUpgradeViewNonInteractive**: Uses dpkg defaults for all prompts\n2. **DEBIAN_FRONTEND=noninteractive**: Tells dpkg to not prompt\n3. **-m server**: Uses server upgrade channel (more stable than desktop)\n\n## Error Handling\n\n### Common Failure Modes\n1. **Disk full**: Caught by preflight, but also check exit code\n2. **Package conflicts**: Log details, suggest manual resolution\n3. **Network failure**: Retry with exponential backoff\n4. **Interrupted upgrade**: Can often recover with dpkg --configure -a\n\n### Recovery Actions\n```bash\nubuntu_recover_failed_upgrade() {\n  log_warn \"Attempting to recover from failed upgrade...\"\n  \n  # Fix any interrupted dpkg operations\n  dpkg --configure -a\n  \n  # Fix broken dependencies\n  apt-get -f install -y\n  \n  # Try the upgrade again\n  ubuntu_do_upgrade\n}\n```\n\n## Logging\n\nAll output goes to /var/log/acfs/upgrade.log:\n- Timestamped entries\n- Full apt output for debugging\n- Clear phase markers\n- Error details\n\n## Estimated Runtime\n\nPer upgrade hop:\n- apt update/upgrade: 5-10 minutes\n- do-release-upgrade: 20-45 minutes\n- Reboot: 2-5 minutes\n- Total per hop: ~30-60 minutes\n\nFor 24.04 → 25.10 (3 hops): 1.5-3 hours total","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T16:21:19.431419-05:00","updated_at":"2025-12-21T16:40:38.660185-05:00","closed_at":"2025-12-21T16:40:38.660185-05:00","close_reason":"Core upgrade execution logic already implemented: ubuntu_prepare_upgrade (apt update, dist-upgrade, clean), ubuntu_do_upgrade (do-release-upgrade with DistUpgradeViewNonInteractive), ubuntu_trigger_reboot (graceful shutdown with delay). Logging handled by log_* functions.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-0ge","depends_on_id":"agentic_coding_flywheel_setup-9xt","type":"blocks","created_at":"2025-12-21T16:23:36.233447-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-0ge","depends_on_id":"agentic_coding_flywheel_setup-0vb","type":"blocks","created_at":"2025-12-21T16:23:36.441258-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-0iq","title":"Create scripts/preflight.sh validation script","description":"# Task: Create scripts/preflight.sh validation script\n\n## Purpose\nValidate system prerequisites before installation begins to fail fast with clear errors.\n\n## Checks to Implement\n\n### 1. System Requirements\n```bash\ncheck_os() {\n    [[ -f /etc/os-release ]] || fail \"Not a Linux system\"\n    source /etc/os-release\n    [[ \"$ID\" == \"ubuntu\" ]] || warn \"Untested OS: $ID (Ubuntu recommended)\"\n    \n    # Version check\n    local version=\"${VERSION_ID:-0}\"\n    (( ${version%%.*} \u003e= 22 )) || warn \"Ubuntu 22.04+ recommended\"\n}\n\ncheck_architecture() {\n    local arch=$(uname -m)\n    [[ \"$arch\" == \"x86_64\" || \"$arch\" == \"aarch64\" ]] || \\\n        fail \"Unsupported architecture: $arch\"\n}\n\ncheck_memory() {\n    local mem_gb=$(awk \"/MemTotal/ {printf \\\"%.0f\\\", \\$2/1024/1024}\" /proc/meminfo)\n    (( mem_gb \u003e= 4 )) || warn \"Low memory: ${mem_gb}GB (8GB+ recommended)\"\n}\n\ncheck_disk() {\n    local free_gb=$(df -BG / | awk \"NR==2 {print \\$4}\" | tr -d \"G\")\n    (( free_gb \u003e= 20 )) || fail \"Insufficient disk: ${free_gb}GB free (need 20GB+)\"\n}\n```\n\n### 2. Network Connectivity (Critical Addition)\n```bash\ncheck_network() {\n    # Test basic connectivity\n    curl -sf --max-time 5 https://github.com \u003e /dev/null || \\\n        fail \"Cannot reach github.com - check network/firewall\"\n    \n    # Test key installer URLs\n    for url in \"https://bun.sh\" \"https://astral.sh\" \"https://claude.ai\"; do\n        curl -sf --max-time 5 \"$url\" \u003e /dev/null || \\\n            warn \"Cannot reach $url\"\n    done\n}\n```\n\n### 3. APT Lock Check (Critical Addition)\n```bash\ncheck_apt_lock() {\n    # Check for active apt processes\n    if fuser /var/lib/dpkg/lock-frontend \u0026\u003e/dev/null; then\n        fail \"APT is locked by another process. Wait or run: sudo killall apt apt-get\"\n    fi\n    \n    # Check for unattended-upgrades\n    if pgrep -x unattended-upgr \u0026\u003e/dev/null; then\n        warn \"unattended-upgrades running - may cause apt conflicts\"\n        warn \"Consider: sudo systemctl stop unattended-upgrades\"\n    fi\n}\n```\n\n### 4. User Environment\n```bash\ncheck_user() {\n    [[ \"$EUID\" -ne 0 ]] || warn \"Running as root not recommended\"\n    [[ -n \"$HOME\" ]] || fail \"HOME not set\"\n    [[ -w \"$HOME\" ]] || fail \"HOME not writable\"\n}\n\ncheck_shell() {\n    local shell=$(basename \"$SHELL\")\n    [[ \"$shell\" == \"bash\" || \"$shell\" == \"zsh\" ]] || \\\n        warn \"Untested shell: $shell\"\n}\n```\n\n### 5. Existing Conflicts\n```bash\ncheck_conflicts() {\n    # Check for nvm (conflicts with mise)\n    [[ \\! -d \"$HOME/.nvm\" ]] || warn \"nvm detected - may conflict with mise\"\n    \n    # Check for pyenv (conflicts with uv)\n    [[ \\! -d \"$HOME/.pyenv\" ]] || warn \"pyenv detected - may conflict with uv\"\n    \n    # Check for existing mise\n    command -v mise \u0026\u003e/dev/null \u0026\u0026 warn \"mise already installed\"\n}\n```\n\n## Output Format\n```\nACFS Pre-Flight Check\n=====================\n[✓] Operating System: Ubuntu 24.04\n[✓] Architecture: x86_64\n[✓] Memory: 16GB\n[✓] Disk Space: 45GB free\n[✓] Network: github.com reachable\n[✓] APT: No locks detected\n[\\!] Warning: nvm detected - may conflict with mise\n[✗] Error: Cannot reach claude.ai\n\nResult: 1 error, 1 warning\n```\n\n## Exit Codes\n- 0: All critical checks pass (warnings OK)\n- 1: Critical check failed (installation would fail)\n\n## Dependencies\n- None (standalone script)\n- Used by: install.sh integration (agentic_coding_flywheel_setup-545)\n\n## Acceptance Criteria\n- [ ] All system checks implemented\n- [ ] APT lock detection added\n- [ ] Network connectivity tests added\n- [ ] Clear pass/warn/fail output\n- [ ] Non-zero exit on critical failure\n- [ ] Can run standalone: ./scripts/preflight.sh","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T12:43:13.693214-05:00","updated_at":"2025-12-21T14:41:41.971739-05:00","closed_at":"2025-12-21T14:41:41.971739-05:00","close_reason":"Created scripts/preflight.sh with all required checks: OS, arch, memory, disk, network, APT locks, user env, conflicts"}
{"id":"agentic_coding_flywheel_setup-0jo","title":"Document acfs-update (help, README, onboard)","description":"## What\nCreate documentation for acfs-update:\n1. --help output with all options and examples\n2. Update main README.md with update command section\n3. Add onboard lesson (e.g., 06_keeping_updated.md)\n4. Add to wizard website if applicable\n\n## --help Content\n- Usage synopsis\n- Category descriptions\n- Option descriptions\n- Common examples\n- Troubleshooting tips\n\n## README Section\n- Brief description of acfs-update\n- Quick examples\n- Link to detailed docs if any\n\n## Onboard Lesson\n- Why regular updates matter\n- How to use acfs-update\n- What each category includes\n- Troubleshooting common issues\n\n## Success Criteria\n- [ ] --help is comprehensive\n- [ ] README updated\n- [ ] Onboard lesson created\n- [ ] Examples work correctly","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-21T13:27:12.053254-05:00","updated_at":"2025-12-21T15:32:25.441289-05:00","closed_at":"2025-12-21T15:32:25.441289-05:00","close_reason":"Completed all documentation tasks: --help, README, onboard lesson","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-0jo","depends_on_id":"agentic_coding_flywheel_setup-csv","type":"blocks","created_at":"2025-12-21T13:28:24.051126-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-0ok","title":"EPIC: Pre-Flight Validation","description":"# Epic: Pre-Flight Validation\n\n## Overview\nCreate a lightweight pre-flight check script that validates VPS readiness BEFORE running the full installer.\n\n## Problem Statement\nUsers discover VPS configuration problems 15 minutes into installation, wasting significant time. Common predictable issues: wrong Ubuntu version, insufficient disk, low RAM, DNS failures.\n\n## Business Impact\n- Fail fast, fail informatively: Know in 10 seconds instead of 15 minutes\n- Provider-agnostic: Works regardless of OVH/Contabo/Hetzner differences\n- Increases confidence: Users know their VPS is correctly provisioned\n\n## Technical Approach\n1. Create scripts/preflight.sh (~150 lines)\n2. Checks: OS version, arch, disk, RAM, swap, internet, DNS, user perms\n3. Output: Human-readable with colors, --json for programmatic use\n4. Wizard integration: New step between SSH Connect and Run Installer\n\n## Success Criteria\n- Catches \u003e80% of installation failures before they happen\n- Runs in \u003c15 seconds\n- Clear actionable output for each check\n- Wizard updated with pre-flight step\n\n## Files to Create/Modify\n- scripts/preflight.sh (new)\n- apps/web/app/wizard/preflight-check/page.tsx (new)\n- apps/web/lib/wizardSteps.ts\n\n## Reference\nSee: docs/ROADMAP_INSTALLER_RELIABILITY.md Section 2","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-21T12:40:27.552018-05:00","updated_at":"2025-12-21T15:03:46.566266-05:00","closed_at":"2025-12-21T15:03:46.566266-05:00","close_reason":"All child tasks closed: 0iq (scripts/preflight.sh), 10n (wizard step). Pre-flight validation checks OS, disk, network, APT locks, user env, conflicts.","comments":[{"id":1,"issue_id":"agentic_coding_flywheel_setup-0ok","author":"jemanuel","text":"FYI: created `agentic_coding_flywheel_setup-mjt` (Manifest-Driven Installer Integration). This work will refactor `install.sh` to source generated installers + manifest_index and will touch selection semantics (`--only/--skip/--print-plan`) and curl|bash bootstrap (single archive).\n\nPlease keep this epic’s work compatible with your scope:\n- orchestration/state/error-reporting/preflight remains install.sh + scripts/lib owned\n- generated scripts stay source-safe (no top-level side effects)","created_at":"2025-12-21T18:50:07Z"}]}
{"id":"agentic_coding_flywheel_setup-0sb","title":"EPIC: Agent Session Sharing and Replay","description":"# Epic: Agent Session Sharing and Replay\n\n## Overview\nEnable users to export successful agent sessions and share/replay them, creating a library of reusable workflows.\n\n## Problem Statement\nWhen an agent workflow works well, there is no way to share it with teammates, replay it on similar problems, or learn from successful patterns. Session data exists in CASS but is not exportable.\n\n## Business Impact\n- Agent sessions are valuable artifacts (successful workflows should be reusable)\n- Learning from examples \u003e documentation (seeing what worked teaches patterns)\n- Community effect (shared sessions make ACFS more valuable)\n- Differentiation (other tools don't enable workflow sharing)\n\n## Technical Approach\nPhase 1 (Local):\n1. Create acfs session export/import commands\n2. Define export JSON schema (sanitized transcript, outcomes, key prompts)\n3. Build sanitization rules (redact API keys, tokens, passwords)\n4. Implement --dry-run preview for imports\n5. Integrate with CASS for session retrieval\n\nPhase 2 (Community - Future):\n- Hosted backend for sharing\n- Search/browse interface\n- Upvote/rating system\n\n## Success Criteria\n- Sessions exportable to portable JSON format\n- All secrets/credentials automatically redacted\n- Import shows clear preview of what will be created/modified\n- Round-trip: export then import reproduces outcomes\n\n## Dependencies\n- Requires CASS (Coding Agent Session Search) installed\n\n## Files to Create\n- scripts/lib/session.sh (new)\n- acfs/session/ directory with templates\n\n## Reference\nSee: docs/ROADMAP_INSTALLER_RELIABILITY.md Section 7","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-21T12:41:47.258515-05:00","updated_at":"2025-12-21T12:41:47.258515-05:00"}
{"id":"agentic_coding_flywheel_setup-0vb","title":"[ubu.5] Add preflight checks for upgrade safety","description":"# Add Preflight Checks for Upgrade Safety\n\n## Purpose\nValidate system is safe to upgrade before attempting. Prevents catastrophic failures mid-upgrade.\n\n## Required Checks\n\n### 1. Disk Space (ubuntu_check_disk_space)\n```bash\n# Require at least 5GB free on root partition\nlocal available_gb=$(df -BG / | awk \"NR==2 {print \\$4}\" | tr -d \"G\")\nif [[ \"$available_gb\" -lt 5 ]]; then\n  log_error \"Insufficient disk space: ${available_gb}GB available, 5GB required\"\n  return 1\nfi\n```\n\n### 2. Network Connectivity (ubuntu_check_network)\n```bash\n# Test connectivity to Ubuntu archive\nif \\! curl -fsS --connect-timeout 10 http://archive.ubuntu.com/ubuntu/ \u003e/dev/null; then\n  log_error \"Cannot reach Ubuntu archive servers\"\n  return 1\nfi\n\n# Test HTTPS (needed for some repos)\nif \\! curl -fsS --connect-timeout 10 https://changelogs.ubuntu.com/ \u003e/dev/null; then\n  log_warn \"HTTPS connectivity issues (non-fatal)\"\nfi\n```\n\n### 3. Not Running in Docker (ubuntu_check_not_docker)\n```bash\n# do-release-upgrade does not work in containers\nif [[ -f /.dockerenv ]] || grep -q docker /proc/1/cgroup 2\u003e/dev/null; then\n  log_error \"Ubuntu upgrade not supported in Docker containers\"\n  return 1\nfi\n```\n\n### 4. Not Running in WSL (ubuntu_check_not_wsl)\n```bash\n# WSL has its own upgrade mechanism\nif grep -qi microsoft /proc/version 2\u003e/dev/null; then\n  log_error \"Ubuntu upgrade not supported in WSL\"\n  return 1\nfi\n```\n\n### 5. APT State Clean (ubuntu_check_apt_state)\n```bash\n# Check for broken packages\nif \\! apt-get check 2\u003e/dev/null; then\n  log_error \"APT has broken packages. Run: apt-get -f install\"\n  return 1\nfi\n\n# Check for held packages (may block upgrade)\nlocal held=$(apt-mark showhold)\nif [[ -n \"$held\" ]]; then\n  log_warn \"Held packages may cause upgrade issues: $held\"\nfi\n\n# Check dpkg for interrupted operations\nif [[ -f /var/lib/dpkg/lock-frontend ]]; then\n  log_error \"Another package manager is running\"\n  return 1\nfi\n```\n\n### 6. Running as Root (ubuntu_check_root)\n```bash\nif [[ $EUID -ne 0 ]]; then\n  log_error \"Ubuntu upgrade requires root privileges\"\n  return 1\nfi\n```\n\n### 7. Uptime Check (ubuntu_check_recent_boot)\n```bash\n# Warn if system was just rebooted (may indicate instability)\nlocal uptime_seconds=$(cat /proc/uptime | cut -d. -f1)\nif [[ \"$uptime_seconds\" -lt 60 ]]; then\n  log_warn \"System just booted. Waiting for services to stabilize...\"\n  sleep 30\nfi\n```\n\n## Aggregate Function\n\n```bash\nubuntu_preflight_checks() {\n  local failed=0\n  \n  ubuntu_check_root || failed=1\n  ubuntu_check_not_docker || failed=1\n  ubuntu_check_not_wsl || failed=1\n  ubuntu_check_disk_space || failed=1\n  ubuntu_check_network || failed=1\n  ubuntu_check_apt_state || failed=1\n  ubuntu_check_recent_boot  # Warning only, no failure\n  \n  return $failed\n}\n```\n\n## Design Decisions\n\n### Why 5GB disk space?\nConservative estimate. do-release-upgrade downloads ~1-2GB of packages,\nneeds temp space for extraction, and the new packages may be larger.\n5GB provides comfortable margin.\n\n### Why check Docker/WSL?\nThese environments have their own upgrade mechanisms. Running \ndo-release-upgrade would fail or cause undefined behavior.\n\n### Why allow held packages with warning?\nSome users intentionally hold packages. Blocking on this would be\ntoo aggressive. We warn but proceed - upgrade may fail later with\nclear error if held package is actually problematic.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T16:21:45.558198-05:00","updated_at":"2025-12-21T16:38:21.048174-05:00","closed_at":"2025-12-21T16:38:21.048174-05:00","close_reason":"Added WSL check (ubuntu_check_not_wsl) and recent boot stability check (ubuntu_check_recent_boot). Updated ubuntu_preflight_checks to include all safety validations.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-0vb","depends_on_id":"agentic_coding_flywheel_setup-9xt","type":"blocks","created_at":"2025-12-21T16:23:35.437967-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-10n","title":"Add pre-flight wizard step to website","description":"# Task: Add pre-flight wizard step to website\n\n## Context\nPart of EPIC: Pre-Flight Validation (agentic_coding_flywheel_setup-0ok)\n\n## What to Do\nAdd a new wizard step that runs preflight checks before installation.\n\n### New Step: Pre-Flight Check\nInsert between SSH Connect and Run Installer steps:\n\n**Page content:**\n1. Explanation: \"Before installing, lets check your VPS is ready\"\n2. Command to run: `curl -fsSL https://raw.githubusercontent.com/.../preflight.sh | bash`\n3. Copy button for command\n4. Expected output example (with pass/warn/fail indicators)\n5. Checkbox: \"Pre-flight passed\" or \"I understand some checks failed\" \n6. Troubleshooting accordion for common failures\n\n**Key UX decisions:**\n- Users CAN proceed with warnings (not blocking)\n- Failures show specific fix steps\n- \"Skip pre-flight\" option for experienced users\n\n### Implementation\n1. Create new page file\n2. Update step list in lib/wizardSteps.ts\n3. Insert between SSH and Install steps (framework handles numbering)\n\n## Acceptance Criteria\n- [ ] New page with preflight command\n- [ ] Clear expected output example  \n- [ ] Copy button works\n- [ ] Users can proceed after checkbox\n- [ ] Troubleshooting section useful\n- [ ] Mobile-friendly\n\n## Files to Create/Modify\n- apps/web/app/wizard/preflight-check/page.tsx (new - justified as new wizard page)\n- apps/web/lib/wizardSteps.ts (add step to array)\n\n## Notes\nCreating new page file is justified: each wizard step is a separate page per Next.js App Router convention.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T12:43:14.946009-05:00","updated_at":"2025-12-21T14:45:31.827424-05:00","closed_at":"2025-12-21T14:45:31.827424-05:00","close_reason":"Completed","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-10n","depends_on_id":"agentic_coding_flywheel_setup-0iq","type":"blocks","created_at":"2025-12-21T12:47:29.574155-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-166","title":"cli_tools.sh: avoid false success for atuin install","description":"scripts/lib/cli_tools.sh install_atuin logs 'atuin installed' even if the installer fails (it logs warn but still prints success). This can mislead users and downstream checks.","acceptance_criteria":"- install_atuin only prints success when atuin is actually installed (or already present).","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-20T14:51:24.570123-05:00","updated_at":"2025-12-20T14:52:41.863958-05:00","closed_at":"2025-12-20T14:52:41.863958-05:00","close_reason":"Fixed scripts/lib/cli_tools.sh install_atuin to only log success when atuin is actually installed."}
{"id":"agentic_coding_flywheel_setup-16o","title":"web: fix analytics + animation glitches","description":"Uncommitted web updates add GA4 analytics + new landing/flywheel pages. Found issues: AnalyticsProvider uses Measurement Protocol sendBeacon with empty api_secret (never works, confusing), and flywheel hero elements use inverted mounted gating that can cause flash/flicker. Fix page-exit tracking using gtag transport_type=beacon (no api_secret) and make flywheel/home animations consistent (no flash).","status":"closed","priority":1,"issue_type":"bug","assignee":"FuchsiaCreek","created_at":"2025-12-20T17:54:13.401226-05:00","updated_at":"2025-12-20T18:18:54.488309-05:00","closed_at":"2025-12-20T18:18:54.488309-05:00","close_reason":"web analytics/animations: fix lint purity + GA beacon + CSS var names; build green"}
{"id":"agentic_coding_flywheel_setup-17e","title":"EPIC: CI/CD \u0026 Quality Gates","description":"# Epic: CI/CD \u0026 Quality Gates\n\n## Overview\nSet up comprehensive CI/CD pipeline to ensure quality and enable confident deployments.\n\n## Background \u0026 Reasoning\nA project of this scope needs automated quality gates:\n- Catch bugs before they reach users\n- Verify installer actually works on real Ubuntu\n- Ensure website builds correctly\n- Maintain code quality standards\n\n## CI Components\n\n### 1. Code Quality\n- ESLint for TypeScript/JavaScript\n- Prettier for formatting\n- shellcheck for bash scripts\n- TypeScript type checking\n\n### 2. Website Tests\n- Unit tests for components\n- Build verification\n- Lighthouse CI for performance\n\n### 3. Installer Tests\n- Spin Ubuntu VM (GitHub Actions runner or cloud)\n- Run full install.sh\n- Execute acfs doctor\n- Verify all tools present\n\n### 4. Integration Tests\n- Manifest parsing\n- Generator outputs\n- Doctor check coverage\n\n## GitHub Actions Workflows\n\n```yaml\n# .github/workflows/ci.yml\n- lint-and-type-check\n- test-website\n- test-installer-ubuntu-25\n- shellcheck-scripts\n```\n\n## Success Criteria\n- [ ] All PRs require passing CI\n- [ ] Installer tested on real Ubuntu\n- [ ] Website build verified\n- [ ] shellcheck passes on all .sh files\n- [ ] Coverage reports generated\n- [ ] Deployment preview for PRs\n\n## Considerations\n- Keep CI fast (\u003c 10 min for most checks)\n- Installer test can be slower (separate workflow)\n- Use caching aggressively\n- Matrix test multiple Ubuntu versions","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-19T22:22:08.720517-05:00","updated_at":"2025-12-20T12:47:02.195651-05:00","closed_at":"2025-12-20T12:47:02.195651-05:00","close_reason":"Closed","labels":["ci","epic"]}
{"id":"agentic_coding_flywheel_setup-17e.1","title":"Set up GitHub Actions for website CI","description":"# Task: Set up GitHub Actions for Website CI\n\n## Description\nCreate GitHub Actions workflow for website quality gates.\n\n## Workflow File\n`.github/workflows/website.yml`\n\n## Jobs\n\n### 1. lint-and-typecheck\n```yaml\n- uses: oven-sh/setup-bun@v1\n- run: bun install\n- run: bun run lint\n- run: bun run type-check\n```\n\n### 2. build\n```yaml\n- uses: oven-sh/setup-bun@v1\n- run: bun install\n- run: bun run build\n```\n\n### 3. test (if tests exist)\n```yaml\n- run: bun test\n```\n\n### 4. lighthouse (optional)\n```yaml\n- uses: treosh/lighthouse-ci-action@v10\n  with:\n    urls: |\n      http://localhost:3000/\n    uploadArtifacts: true\n```\n\n## Triggers\n- Push to main\n- Pull requests to main\n\n## Caching\n```yaml\n- uses: actions/cache@v3\n  with:\n    path: ~/.bun/install/cache\n    key: ${{ runner.os }}-bun-${{ hashFiles('**/bun.lock') }}\n```\n\n## Acceptance Criteria\n- [ ] Runs on every PR\n- [ ] Lint + typecheck required to pass\n- [ ] Build verification\n- [ ] Caching for speed\n- [ ] Clear failure messages","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:27:08.308979-05:00","updated_at":"2025-12-20T11:48:52.669536-05:00","closed_at":"2025-12-20T11:48:52.669536-05:00","close_reason":"Created GitHub Actions workflow for website CI. Fixed barrel import issues causing SSG build failures by switching to direct component imports. All lint, type-check, and build steps now pass.","labels":["ci","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-17e.1","depends_on_id":"agentic_coding_flywheel_setup-17e","type":"parent-child","created_at":"2025-12-19T22:27:08.310651-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-17e.2","title":"Set up GitHub Actions for installer testing","description":"# Task: Set up GitHub Actions for Installer Testing\n\n## Description\nCreate GitHub Actions workflow that tests the installer on real Ubuntu.\n\n## Workflow File\n`.github/workflows/installer.yml`\n\n## Jobs\n\n### 1. shellcheck\nFast job that runs on every PR:\n```yaml\n- uses: ludeeus/action-shellcheck@master\n  with:\n    scandir: './scripts'\n    additional_files: 'install.sh'\n```\n\n### 2. test-ubuntu-25\nFull installer test (may be slow):\n```yaml\nruns-on: ubuntu-latest\ncontainer:\n  image: ubuntu:25.04\nsteps:\n  - uses: actions/checkout@v4\n  - name: Run installer\n    run: |\n      bash install.sh --yes --mode vibe\n  - name: Run doctor\n    run: |\n      su - ubuntu -c \"acfs doctor\"\n  - name: Verify key tools\n    run: |\n      su - ubuntu -c \"ntm --help\"\n      su - ubuntu -c \"ubs --help\"\n      # ... etc\n```\n\n### 3. test-ubuntu-24\nSame but on 24.04 LTS for compatibility.\n\n## Triggers\n- Push to main\n- Pull requests touching install.sh or scripts/\n\n## Matrix Testing\n```yaml\nstrategy:\n  matrix:\n    ubuntu: ['24.04', '25.04']\n```\n\n## Acceptance Criteria\n- [ ] shellcheck passes on all scripts\n- [ ] Installer works on Ubuntu 24.04\n- [ ] Installer works on Ubuntu 25.04\n- [ ] All tools verified after install\n- [ ] acfs doctor exits 0","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:27:21.687302-05:00","updated_at":"2025-12-20T12:46:57.410761-05:00","closed_at":"2025-12-20T12:46:57.410761-05:00","close_reason":"Closed","labels":["ci","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-17e.2","depends_on_id":"agentic_coding_flywheel_setup-17e","type":"parent-child","created_at":"2025-12-19T22:27:21.688994-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-187","title":"[cleanup] Consolidate duplicate acfs_resolve_selection implementations","description":"## Issue\n\nThere are TWO implementations of `acfs_resolve_selection`:\n\n1. **scripts/lib/install_helpers.sh** (lines 43-272)\n   - Actively used by install.sh (sourced via detect_environment)\n   - More comprehensive: has SKIP_TAGS, SKIP_CATEGORIES, ACFS_PLAN_REASON, ACFS_PLAN_EXCLUDE_REASON\n\n2. **scripts/lib/selection.sh** (lines 195-315)\n   - Has test file (test_selection.sh) with 10 passing tests\n   - NOT sourced anywhere in install.sh - effectively dead code\n   - Cleaner separation with named helper functions\n\n## Problem\n\n- Duplicate code creates maintenance burden\n- Tests exist for selection.sh but production uses install_helpers.sh\n- If someone modifies selection.sh thinking it's the canonical implementation, those changes won't take effect\n\n## Options\n\n1. **Delete selection.sh**: Remove the unused file and its tests, keep install_helpers.sh\n2. **Migrate to selection.sh**: Move selection logic to selection.sh, source it from install_helpers.sh\n3. **Merge best of both**: Combine the clean structure of selection.sh with the features of install_helpers.sh\n\n## Recommendation\n\nOption 3: selection.sh has better test coverage and cleaner code structure. Merge the extra features from install_helpers.sh (SKIP_TAGS, SKIP_CATEGORIES, reason tracking) into selection.sh, then source selection.sh from install_helpers.sh.\n\n## Files Involved\n\n- scripts/lib/selection.sh (standalone, tested, unused)\n- scripts/lib/test_selection.sh (tests selection.sh)\n- scripts/lib/install_helpers.sh (has duplicate implementation, used)\n\n## Priority\n\nP3 - Not urgent, code works, but should be cleaned up to avoid confusion.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T16:35:13.451373-05:00","updated_at":"2025-12-21T16:35:13.451373-05:00"}
{"id":"agentic_coding_flywheel_setup-1of","title":"[codex.5] Update README codex references","description":"## Goal\nAudit and fix any codex-cli authentication references in README.md.\n\n## Scope\n1. Search README.md for any mention of:\n   - OPENAI_API_KEY\n   - codex authentication\n   - agent login\n2. Update any incorrect guidance\n3. Add correct auth flow description if missing\n\n## Correct Information\n- codex-cli uses OAuth via ChatGPT Pro/Plus account\n- Authentication command: codex auth\n- No API key needed\n- Browser-based login flow\n\n## Files to Modify\n- README.md\n\n## Acceptance Criteria\n1. No incorrect OPENAI_API_KEY references for codex\n2. Clear, correct auth guidance if discussed","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T16:26:01.346705-05:00","updated_at":"2025-12-21T16:43:44.97006-05:00","closed_at":"2025-12-21T16:43:44.97006-05:00","close_reason":"Fixed README.md codex auth references: API key -\u003e OAuth, set OPENAI_API_KEY -\u003e run codex login","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-1of","depends_on_id":"agentic_coding_flywheel_setup-ua5","type":"blocks","created_at":"2025-12-21T16:26:36.402862-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-1xq","title":"Implement session sanitization rules","description":"# Task: Implement session sanitization rules\n\n## Context\nPart of EPIC: Agent Session Sharing and Replay (agentic_coding_flywheel_setup-0sb)\n\n## What to Do\nCreate comprehensive sanitization for exported sessions:\n\n### Patterns to Redact\n```bash\nREDACT_PATTERNS=(\n    # API Keys\n    'sk-[a-zA-Z0-9]{48}'           # OpenAI\n    'sk-ant-[a-zA-Z0-9-]{90,}'     # Anthropic\n    'AIza[a-zA-Z0-9_-]{35}'        # Google\n\n    # Tokens\n    'ghp_[a-zA-Z0-9]{36}'          # GitHub PAT\n    'gho_[a-zA-Z0-9]{36}'          # GitHub OAuth\n    'xoxb-[a-zA-Z0-9-]+'           # Slack\n\n    # Passwords\n    'password[\"\\s:=]+[^\\s]+'\n    'secret[\"\\s:=]+[^\\s]+'\n\n    # Optional\n    '\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\b'  # IPv4\n)\n```\n\n### sanitize_content() Function\nApply all patterns, replace with [REDACTED].\n\n## Acceptance Criteria\n- All known secret patterns covered\n- No false negatives (secrets leak)\n- Minimal false positives\n- Optional patterns (IPs, emails) configurable\n\n## Files to Create\n- scripts/lib/session.sh","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T12:46:38.133523-05:00","updated_at":"2025-12-21T15:42:23.983001-05:00","closed_at":"2025-12-21T15:42:23.983001-05:00","close_reason":"Added sanitization to scripts/lib/session.sh: (1) REDACT_PATTERNS array covering OpenAI/Anthropic/Google API keys, GitHub/Slack tokens, AWS keys, password patterns; (2) OPTIONAL_REDACT_PATTERNS for IPs/emails enabled via ACFS_SANITIZE_OPTIONAL=1; (3) sanitize_content() for string sanitization; (4) sanitize_session_export() for JSON files; (5) contains_secrets() helper. All acceptance criteria met.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-1xq","depends_on_id":"agentic_coding_flywheel_setup-c61","type":"blocks","created_at":"2025-12-21T12:47:39.770295-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-21v","title":"Fix set -e counter increments in scripts","description":"Scripts using set -euo pipefail cannot safely use ((count++)) because it returns exit status 1 when count is 0, which can trigger premature exits.\n\nFix all instances by switching to ((count += 1)) or an assignment.\n\nFixed in:\n- scripts/lib/security.sh (verify_all_installers)\n- packages/onboard/onboard.sh (show_status)\n- scripts/generated/doctor_checks.sh (run_manifest_checks)\n- packages/manifest/src/generate.ts (doctor check generator)","acceptance_criteria":" - scripts/lib/security.sh --verify runs through all installers without exiting early.\n - onboard status works even when some lessons are completed.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-20T14:21:25.532068-05:00","updated_at":"2025-12-20T14:25:34.323739-05:00","closed_at":"2025-12-20T14:25:34.323739-05:00","close_reason":"Replaced set -e unsafe ((count++)) with += 1 across security.sh, onboard.sh, and generated doctor checks (and generator)."}
{"id":"agentic_coding_flywheel_setup-2bn","title":"EPIC: Onboarding TUI","description":"# Epic: Onboarding TUI\n\n## Overview\nBuild the interactive `onboard` command that teaches users Linux basics and the ACFS workflow through hands-on missions.\n\n## Background \u0026 Reasoning\nDocumentation fails beginners. Interactive learning succeeds. The onboard TUI:\n- Teaches by doing, not reading\n- Builds muscle memory for key commands\n- Introduces tools progressively\n- Can be re-run anytime as a refresher\n\n## 7 Missions\n\n### Mission 0: Welcome\n- What you now have\n- The VPS as playground (safe to break, just re-run ACFS)\n- Overview of installed tools\n\n### Mission 1: Linux Navigation\n- pwd, ls, cd, mkdir, rm\n- /home/ubuntu vs /data/projects\n- Navigation shortcuts (dev, proj, p aliases)\n\n### Mission 2: SSH \u0026 Persistence\n- What SSH is\n- Why tmux matters (connection drops, tmux lives)\n- Basic attach/detach\n\n### Mission 3: tmux Basics\n- Create/attach/detach sessions\n- Split panes\n- Copy mode basics\n\n### Mission 4: Agent Commands\n- cc (Claude), cod (Codex), gmi (Gemini)\n- First login flow\n- `caam backup` right after login\n\n### Mission 5: NTM Command Center\n- ntm deps -v (verify)\n- ntm tutorial\n- ntm spawn demo --cc=2 --cod=1\n- ntm send/broadcast\n\n### Mission 6: NTM Command Palette\n- Show vendored command_palette.md\n- Searchable prompt list\n- \"Send to all agents\" feature\n\n### Mission 7: The Flywheel Loop\n- Plan in Beads → bv\n- Coordinate via Agent Mail\n- Run agents via NTM\n- Search via cass\n- Build memory via cm\n- Scan with ubs\n- Optional guardrails via slb\n\n## Success Criteria\n- [ ] All 7 missions implemented\n- [ ] Can be re-run safely anytime\n- [ ] Works offline (except optional updates)\n- [ ] Takes \u003c 30 minutes to complete all\n- [ ] User feels confident to start coding\n\n## Technical Approach\n- Shell script or simple Go/Rust binary\n- Uses gum or similar for TUI elements\n- Stores progress in ~/.acfs/onboard_progress.json","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-19T22:21:25.187518-05:00","updated_at":"2025-12-20T12:21:20.499516-05:00","closed_at":"2025-12-20T12:21:20.499516-05:00","close_reason":"All sub-tasks completed: 2bn.1 (onboard TUI shell script). Interactive menu with gum support, progress tracking, and completion markers implemented.","labels":["epic","onboard"]}
{"id":"agentic_coding_flywheel_setup-2bn.1","title":"Create onboard TUI shell script","description":"# Task: Create Onboard TUI Shell Script\n\n## Description\nBuild the interactive onboarding TUI that teaches users the ACFS workflow.\n\n## Location\nInstall to: `~/.local/bin/onboard`\n\n## UX Flow\n\n```\n┌─────────────────────────────────────────────────────┐\n│           Welcome to ACFS Onboarding                │\n│                                                     │\n│  Choose a lesson:                                   │\n│                                                     │\n│  [1] Welcome \u0026 Overview                ✓ completed  │\n│  [2] Linux Navigation (5 min)          ● in progress│\n│  [3] SSH \u0026 Persistence                              │\n│  [4] tmux Basics                                    │\n│  [5] Agent Commands (cc, cod, gmi)                  │\n│  [6] NTM Command Center                             │\n│  [7] NTM Prompt Palette                             │\n│  [8] The Flywheel Loop                              │\n│                                                     │\n│  [q] Quit  [r] Restart from beginning               │\n└─────────────────────────────────────────────────────┘\n```\n\n## Implementation Options\n\n### Option A: Pure Bash + gum\nUse charmbracelet/gum for TUI elements:\n```bash\ngum choose \"Welcome\" \"Linux Navigation\" \"SSH \u0026 Persistence\" ...\n```\n\n### Option B: Simple menu\nPlain bash with read:\n```bash\nwhile true; do\n    clear\n    echo \"ACFS Onboarding\"\n    echo \"1) Welcome\"\n    echo \"2) Linux Navigation\"\n    ...\n    read -p \"Choose: \" choice\ndone\n```\n\n## Lesson Format\nEach lesson:\n1. Brief explanation\n2. Command to try\n3. Expected output\n4. Checkpoint/quiz\n\n## Progress Tracking\nStore in ~/.acfs/onboard_progress.json:\n```json\n{\n  \"completed\": [1, 2, 3],\n  \"current\": 4,\n  \"started_at\": \"2025-12-19T...\"\n}\n```\n\n## Acceptance Criteria\n- [ ] All 8 lessons implemented\n- [ ] Progress saved between runs\n- [ ] Can be re-run anytime\n- [ ] Works over SSH\n- [ ] Clear and beginner-friendly","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:26:56.967996-05:00","updated_at":"2025-12-20T12:17:32.895359-05:00","closed_at":"2025-12-20T12:17:32.895359-05:00","close_reason":"Implemented interactive onboard TUI with: gum-based menu when available, fallback simple menu, progress tracking in ~/.acfs/onboard_progress.json, lesson completion markers, --reset flag, updated 1-8 numbering. Commit d96659e.","labels":["onboard","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-2bn.1","depends_on_id":"agentic_coding_flywheel_setup-2bn","type":"parent-child","created_at":"2025-12-19T22:26:56.969656-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-2du","title":"Set up bun workspaces for monorepo","description":"# Task: Set up Bun Workspaces\n\n## Description\nConfigure bun workspaces in the root package.json to manage:\n- apps/web (Next.js wizard website)\n- packages/manifest (manifest utilities)\n- packages/onboard (onboard TUI)\n\n## Technical Details\nRoot package.json should include:\n```json\n{\n  \"workspaces\": [\"apps/*\", \"packages/*\"]\n}\n```\n\nEach workspace needs its own package.json with appropriate name/scripts.\n\n## Reasoning\nBun workspaces allow:\n- Shared dependencies across packages\n- Single lockfile (bun.lock)\n- Easy cross-package imports\n- Consistent tooling\n\n## Acceptance Criteria\n- [ ] Root package.json with workspaces config\n- [ ] Each workspace has valid package.json\n- [ ] `bun install` works from root\n- [ ] Cross-package imports resolve correctly\n\n## Dependencies\nDepends on directory structure being created first.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:20:33.61383-05:00","updated_at":"2025-12-19T23:27:33.126119-05:00","closed_at":"2025-12-19T23:27:33.126119-05:00","close_reason":"Root bun workspace set up with apps/* and packages/* workspaces","labels":["infrastructure","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-2du","depends_on_id":"agentic_coding_flywheel_setup-e88","type":"blocks","created_at":"2025-12-19T22:20:33.616805-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-2yd","title":"[ubu.2] Extend state.sh for upgrade tracking","description":"# Extend state.sh for Upgrade Tracking\n\n## Purpose\nAdd upgrade-specific state fields to track multi-reboot upgrade progress.\n\n## State Schema Extensions\n\nAdd new fields to state.json schema:\n\n```json\n{\n  \"schema_version\": 3,  // Bump version for new fields\n  // ... existing fields ...\n  \n  // NEW: Ubuntu upgrade tracking\n  \"ubuntu_upgrade\": {\n    \"enabled\": true,\n    \"started_at\": \"2025-12-21T10:00:00Z\",\n    \"original_version\": \"24.04\",\n    \"target_version\": \"25.10\",\n    \"current_stage\": \"upgrading\",\n    \"upgrade_path\": [\"24.04\", \"24.10\", \"25.04\", \"25.10\"],\n    \"completed_upgrades\": [\n      {\"from\": \"24.04\", \"to\": \"24.10\", \"completed_at\": \"...\"}\n    ],\n    \"current_upgrade\": {\"from\": \"24.10\", \"to\": \"25.04\", \"started_at\": \"...\"},\n    \"needs_reboot\": false,\n    \"resume_after_reboot\": true,\n    \"last_error\": null\n  }\n}\n```\n\n## Functions to Add\n\n```bash\n# Initialize upgrade state\nstate_upgrade_init() {\n  local original_version=\"$1\"\n  local target_version=\"$2\"\n  local upgrade_path=\"$3\"  # JSON array\n}\n\n# Mark current upgrade as started\nstate_upgrade_start() {\n  local from_version=\"$1\"\n  local to_version=\"$2\"\n}\n\n# Mark current upgrade as completed\nstate_upgrade_complete() {\n  local to_version=\"$1\"\n}\n\n# Mark that system needs reboot\nstate_upgrade_needs_reboot() {\n  # Sets needs_reboot=true, resume_after_reboot=true\n}\n\n# Clear reboot flags after successful resume\nstate_upgrade_resumed() {\n  # Sets needs_reboot=false\n}\n\n# Check if upgrade is complete\nstate_upgrade_is_complete() {\n  # Returns 0 if current version \u003e= target version\n}\n\n# Get current upgrade stage\nstate_upgrade_get_stage() {\n  # Returns: not_started | upgrading | awaiting_reboot | completed\n}\n\n# Record upgrade error\nstate_upgrade_set_error() {\n  local error_msg=\"$1\"\n}\n\n# Clean up upgrade state after completion\nstate_upgrade_cleanup() {\n  # Remove ubuntu_upgrade section entirely\n}\n```\n\n## Schema Migration\n\nAdd migration from v2 to v3:\n- v3 is backwards compatible (new fields are optional)\n- Existing v2 state files work without modification\n- ubuntu_upgrade section only added when upgrade starts\n\n## Why Separate State Section?\n\nThe upgrade state is conceptually different from installation state:\n- Upgrade happens BEFORE installation\n- Upgrade may span multiple reboots\n- Upgrade state should be cleaned up after completion\n\nKeeping it in a separate section makes this clear and allows\nindependent cleanup.\n\n## Atomic Write Considerations\n\nAll state writes already use atomic temp-file+rename pattern.\nThis is critical for upgrade state since we're about to reboot\nand can't risk corrupted state.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T16:20:15.998308-05:00","updated_at":"2025-12-21T16:35:14.533749-05:00","closed_at":"2025-12-21T16:35:14.533749-05:00","close_reason":"Extended state.sh with 14 upgrade tracking functions (state_upgrade_init, state_upgrade_start, state_upgrade_complete, etc.). Updated schema to v3 with backward compatibility for v2.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-2yd","depends_on_id":"agentic_coding_flywheel_setup-9xt","type":"blocks","created_at":"2025-12-21T16:23:35.258019-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-31e","title":"Installer: implement (or de-scope) cloud/db installs + skip flags","description":"install.sh defines --skip-postgres/--skip-vault/--skip-cloud and smoke test references them, but install.sh never installs PostgreSQL/Vault/cloud CLIs. scripts/lib/cloud_db.sh + acfs.manifest.yaml define these installs, and README claims they're installed.","acceptance_criteria":"Either:\n- installer runs cloud/db phase (respecting skip flags) without breaking Ubuntu 24.04/25.x CI, OR\n- docs/manifest updated to match reality and flags removed/hidden.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-20T14:17:29.066623-05:00","updated_at":"2025-12-20T14:37:42.698153-05:00","closed_at":"2025-12-20T14:37:42.698153-05:00","close_reason":"Implemented cloud/db phase in install.sh (Postgres 18 via PGDG, Vault via HashiCorp repo, cloud CLIs via bun) honoring skip flags; updated smoke test + phase numbering."}
{"id":"agentic_coding_flywheel_setup-325","title":"Implement agent auth functional tests","description":"# Task: Implement agent auth functional tests\n\n## Context\nPart of EPIC: Enhanced Doctor with Functional Tests (agentic_coding_flywheel_setup-t9i)\n\n## What to Do\nCreate functional tests for AI agent authentication:\n\n### check_claude_auth()\n1. Check if claude binary exists (skip if not)\n2. Check if ~/.claude/config.json exists\n3. Try claude --print-system-info (low-cost API check)\n4. Return: 0=OK, 1=fail, 2=skip\n\n### check_codex_auth()\n1. Check if codex binary exists\n2. Check for OPENAI_API_KEY env var\n3. Check for API key in ~/.zshrc.local\n4. Return status\n\n### check_gemini_auth()\n1. Check if gemini binary exists\n2. Check for GOOGLE_API_KEY or GEMINI_API_KEY\n3. Check for credentials file\n4. Return status\n\n## Acceptance Criteria\n- Each check has clear pass/fail criteria\n- Skipped if tool not installed (status 2)\n- Auth issues detected reliably\n- No false positives\n\n## Files to Modify\n- scripts/lib/doctor.sh: Add check functions","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T12:45:18.598224-05:00","updated_at":"2025-12-21T14:57:34.018612-05:00","closed_at":"2025-12-21T14:57:34.018612-05:00","close_reason":"Implemented check_claude_auth(), check_codex_auth(), check_gemini_auth() with config/API key checks","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-325","depends_on_id":"agentic_coding_flywheel_setup-01s","type":"blocks","created_at":"2025-12-21T12:47:34.958137-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-32g","title":"[ubu.9] Handle LTS-to-LTS upgrade path special case","description":"# Handle LTS-to-LTS Upgrade Path Special Case\n\n## Purpose\nUbuntu LTS releases can upgrade directly to the next LTS (22.04 → 24.04) OR follow the regular path through intermediate releases. We need to handle this correctly.\n\n## Background\n\nUbuntu upgrade paths have special rules:\n- **Normal releases**: Must upgrade sequentially (24.10 → 25.04 → 25.10)\n- **LTS releases**: Can upgrade directly to next LTS (22.04 → 24.04)\n- **LTS to normal**: Requires enabling \"Prompt=normal\" in /etc/update-manager/release-upgrades\n\n## Default Behavior\n\nBy default, do-release-upgrade on LTS systems only shows LTS upgrades.\nTo see non-LTS upgrades, need to modify configuration:\n\n```bash\n# In /etc/update-manager/release-upgrades\n# Change: Prompt=lts\n# To:     Prompt=normal\n```\n\n## Implementation\n\n### Detection\n```bash\n# Check if current system is LTS\nubuntu_is_lts() {\n  local version=$(ubuntu_get_version_string)\n  # LTS versions: 22.04, 24.04, 26.04, etc.\n  [[ \"$version\" =~ ^[0-9]+\\.04$ ]]\n}\n```\n\n### Path Calculation for LTS Systems\n```bash\nubuntu_calculate_upgrade_path() {\n  local target=\"$1\"\n  local current=$(ubuntu_get_version_string)\n  \n  if ubuntu_is_lts; then\n    # Check if we should go LTS-to-LTS or through normal releases\n    local next_lts=$(ubuntu_get_next_lts \"$current\")\n    \n    if ubuntu_version_gte \"$next_lts\" \"$target\"; then\n      # Target is the next LTS or earlier - go direct\n      echo \"$next_lts\"\n    else\n      # Target is beyond next LTS - need to go through normal releases\n      # Enable normal release channel\n      ubuntu_enable_normal_releases\n      ubuntu_calculate_sequential_path \"$current\" \"$target\"\n    fi\n  else\n    ubuntu_calculate_sequential_path \"$current\" \"$target\"\n  fi\n}\n```\n\n### Enable Normal Releases\n```bash\nubuntu_enable_normal_releases() {\n  local config=\"/etc/update-manager/release-upgrades\"\n  \n  if [[ -f \"$config\" ]]; then\n    # Backup original\n    cp \"$config\" \"${config}.acfs-backup\"\n    \n    # Change Prompt=lts to Prompt=normal\n    sed -i \"s/^Prompt=lts$/Prompt=normal/\" \"$config\"\n    \n    log_info \"Enabled normal release upgrades (was LTS-only)\"\n  fi\n}\n```\n\n## Example Upgrade Paths\n\n### From 22.04 LTS to 25.10\nOption A (LTS path first):\n- 22.04 → 24.04 (LTS hop)\n- 24.04 → 24.10 → 25.04 → 25.10 (normal path)\n\nOption B (all normal):\n- 22.04 → 22.10 → 23.04 → 23.10 → 24.04 → 24.10 → 25.04 → 25.10\n\n**We choose Option A** - fewer hops, more stable.\n\n### From 24.04 LTS to 25.10\n- 24.04 → 24.10 → 25.04 → 25.10 (normal path, 3 hops)\n\n## Configuration Restoration\n\nAfter reaching target version, restore original LTS-only setting:\n```bash\nubuntu_restore_lts_only() {\n  local config=\"/etc/update-manager/release-upgrades\"\n  local backup=\"${config}.acfs-backup\"\n  \n  if [[ -f \"$backup\" ]]; then\n    mv \"$backup\" \"$config\"\n    log_info \"Restored LTS-only release setting\"\n  fi\n}\n```\n\n## Testing Notes\n\n- Test from 22.04: Verify LTS-to-LTS hop works\n- Test from 24.04: Verify normal path enables correctly\n- Test config restoration after completion","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T16:24:05.237039-05:00","updated_at":"2025-12-21T16:39:24.893274-05:00","closed_at":"2025-12-21T16:39:24.893274-05:00","close_reason":"Added LTS detection (ubuntu_is_lts - even years only), next LTS calculation (ubuntu_get_next_lts), and release channel management (ubuntu_enable_normal_releases, ubuntu_restore_lts_only).","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-32g","depends_on_id":"agentic_coding_flywheel_setup-9xt","type":"blocks","created_at":"2025-12-21T16:24:40.623353-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-3ci","title":"Fix acfs doctor --json output (pure JSON + correct counts)","description":"scripts/lib/doctor.sh --json currently prints section headings before JSON, doesn’t increment pass/warn/fail counters in JSON mode, and doesn’t escape strings. Make --json emit only valid JSON on stdout with correct summary counts (and handle missing /etc/os-release).","status":"closed","priority":1,"issue_type":"bug","assignee":"FuchsiaCreek","created_at":"2025-12-20T13:44:19.646755-05:00","updated_at":"2025-12-20T13:49:30.854595-05:00","closed_at":"2025-12-20T13:49:30.854595-05:00","close_reason":"Fixed scripts/lib/doctor.sh --json to emit pure valid JSON (no headings), increment counters in JSON mode, and JSON-escape strings; also handles missing /etc/os-release."}
{"id":"agentic_coding_flywheel_setup-3ht","title":"Implement cloud CLI updates (vercel, wrangler, supabase, fly)","description":"## What\nImplement the 'cloud' category for acfs-update:\n- Vercel CLI: bun update -g vercel\n- Wrangler (Cloudflare): bun update -g wrangler\n- Supabase CLI: bun update -g supabase\n- Fly CLI: Reinstall via official installer (flyctl self-upgrade)\n- AWS CLI: Detect install method, update accordingly\n\n## AWS CLI Handling (added)\nAWS CLI can be installed multiple ways:\n1. apt-installed: Handled by system updates (apt upgrade)\n2. pip-installed: pip install --upgrade awscli\n3. Official installer: Re-run installer or use aws --update\n\nDetection: Check `which aws`, then `dpkg -s awscli` vs `pip show awscli`\n\n## Technical Details\n- Most cloud CLIs are bun global packages - simple updates\n- Fly CLI has built-in: flyctl self-upgrade (or reinstall)\n- Cloud CLIs may have authentication state - preserve it\n\n## Considerations\n- Only update tools that are installed\n- Skip tools without prompting if not present\n- For bun packages: bun update -g \u003cpkg\u003e\n- Log version changes\n\n## Success Criteria\n- [ ] All cloud CLIs update correctly\n- [ ] AWS CLI detected and updated properly\n- [ ] Skips uninstalled CLIs\n- [ ] Authentication preserved\n- [ ] Version changes logged","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:26:43.995628-05:00","updated_at":"2025-12-21T15:13:23.18063-05:00","closed_at":"2025-12-21T15:13:23.18063-05:00","close_reason":"Already implemented in scripts/lib/update.sh:update_cloud() - Wrangler, Supabase, Vercel via bun install -g @latest","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-3ht","depends_on_id":"agentic_coding_flywheel_setup-75e","type":"blocks","created_at":"2025-12-21T13:27:25.514415-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-3mp","title":"Implement runtime updates (bun, rust, uv, go)","description":"## What\nImplement the 'runtimes' category for acfs-update:\n- Bun: bun upgrade\n- Rust: rustup update (stable, nightly if installed)\n- uv: uv self update (or reinstall via official installer)\n- Go: apt handles if system-installed, skip otherwise\n\n## Technical Details\n- Each runtime has different update mechanisms\n- Bun: ~/.bun/bin/bun upgrade\n- Rust: ~/.cargo/bin/rustup update\n- uv: May need to source the installer again\n- Go: Typically managed via apt, but could be manual install\n\n## Considerations\n- Must run as target user, not root (except go via apt)\n- Capture before/after versions for each\n- Skip if tool not installed (detected by missing binary)\n- Rust may update multiple toolchains - capture all\n\n## Success Criteria\n- [ ] Each runtime updates correctly\n- [ ] Skips uninstalled runtimes gracefully\n- [ ] Version changes logged\n- [ ] Works for both root and non-root users","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:26:07.808375-05:00","updated_at":"2025-12-21T15:13:50.956617-05:00","closed_at":"2025-12-21T15:13:50.956617-05:00","close_reason":"Implemented version tracking for bun/rust/uv, added update_go() function","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-3mp","depends_on_id":"agentic_coding_flywheel_setup-75e","type":"blocks","created_at":"2025-12-21T13:27:24.85834-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-3nk","title":"Silence Next.js turbopack root warning in monorepo","description":"Next.js build warns about inferred Turbopack workspace root because there are multiple bun.lock files (repo root + apps/web). Configure apps/web/next.config.ts turbopack.root explicitly so Next/Turbopack uses the intended root and the warning goes away (no file deletions).","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-20T15:30:19.912859-05:00","updated_at":"2025-12-20T15:34:12.38145-05:00","closed_at":"2025-12-20T15:34:12.38145-05:00","close_reason":"Set apps/web turbopack.root to the workspace root so Next/Turbopack resolves deps correctly and the monorepo root warning is silenced without deleting any lockfiles.","labels":["dx","web"]}
{"id":"agentic_coding_flywheel_setup-4jr","title":"Implement handle_checksum_mismatch() with skip/abort/proceed options","description":"# Task: Implement handle_checksum_mismatch() with batched prompts\n\n## Purpose\nWhen an upstream installer checksum does not match, provide user options while maintaining security.\n\n## Critical UX Improvement: Batch All Mismatches\n\n**Problem with per-tool prompts:**\nIf 5 tools have changed, user gets 5 separate prompts. Annoying and breaks flow.\n\n**Solution:** Collect all mismatches first, then present ONE decision prompt.\n\n```bash\ndeclare -a CHECKSUM_MISMATCHES=()\n\n# During verification phase (collect, dont prompt)\ncheck_installer_checksum() {\n    local tool=\"$1\" url=\"$2\" expected=\"$3\"\n    local actual=$(fetch_checksum \"$url\")\n    \n    if [[ \"$actual\" \\!= \"$expected\" ]]; then\n        CHECKSUM_MISMATCHES+=(\"$tool|$url|$expected|$actual\")\n        return 1  # Mark as mismatch but continue\n    fi\n    return 0\n}\n\n# After all tools checked, present batched decision\nhandle_all_checksum_mismatches() {\n    if [[ ${#CHECKSUM_MISMATCHES[@]} -eq 0 ]]; then\n        return 0  # All good\n    fi\n    \n    echo \"\"\n    log_warn \"Checksum mismatches detected for ${#CHECKSUM_MISMATCHES[@]} installers:\"\n    echo \"\"\n    for entry in \"${CHECKSUM_MISMATCHES[@]}\"; do\n        IFS=\"|\" read -r tool url expected actual \u003c\u003c\u003c \"$entry\"\n        echo \"  $tool:\"\n        echo \"    Expected: ${expected:0:16}...\"\n        echo \"    Actual:   ${actual:0:16}...\"\n    done\n    echo \"\"\n    echo \"This usually means upstream scripts were updated.\"\n    echo \"\"\n    echo \"Options:\"\n    echo \"  [P] Proceed with new versions (update checksums.yaml later)\"\n    echo \"  [S] Skip these tools, install everything else\"\n    echo \"  [A] Abort installation\"\n    echo \"\"\n    \n    read -r -p \"Choice [P/s/a]: \" choice\n    case \"${choice,,}\" in\n        s) \n            for entry in \"${CHECKSUM_MISMATCHES[@]}\"; do\n                SKIPPED_TOOLS+=(\"${entry%%|*}\")\n            done\n            return 0\n            ;;\n        a) exit 1 ;;\n        *) return 0 ;;  # Proceed (default)\n    esac\n}\n```\n\n## Non-Interactive Mode\nIn non-interactive (agent/CI) mode, behavior depends on tool classification:\n- CRITICAL tool mismatch → abort (cant proceed safely)\n- RECOMMENDED tool mismatch → auto-skip with warning\n\n## Security Considerations\n- Always log the actual vs expected hash\n- Encourage users to verify upstream changes before proceeding\n- Document how to update checksums.yaml\n\n## Dependencies\n- Depends on: Tool classification (agentic_coding_flywheel_setup-v8a)\n- Used by: verify_and_run() flow (agentic_coding_flywheel_setup-anq)\n\n## Acceptance Criteria\n- [ ] All mismatches collected before any prompt\n- [ ] Single batched prompt for all mismatches\n- [ ] Clear display of which tools affected\n- [ ] P/S/A options with sensible defaults\n- [ ] Non-interactive mode follows CRITICAL/RECOMMENDED rules","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T12:44:37.23646-05:00","updated_at":"2025-12-21T14:46:15.314163-05:00","closed_at":"2025-12-21T14:46:15.314163-05:00","close_reason":"Added checksum mismatch batching to security.sh: CHECKSUM_MISMATCHES array, record/clear/count/has functions, handle_all_checksum_mismatches() with P/S/A prompt, check_installer_checksum(), and _handle_mismatches_noninteractive() for CI/agent mode. Integrates with tools.sh for CRITICAL vs RECOMMENDED classification.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-4jr","depends_on_id":"agentic_coding_flywheel_setup-v8a","type":"blocks","created_at":"2025-12-21T12:47:33.143559-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-4ou","title":"EPIC: Automated Upstream Checksum Monitoring","description":"# Epic: Automated Upstream Checksum Monitoring\n\n## Overview\nCreate a GitHub Action that daily monitors upstream installer scripts for changes and auto-creates PRs to update checksums.yaml.\n\n## Problem Statement\nChecksums get stale when upstream tools release updates. Users hit 'checksum mismatch' errors that are actually normal releases, not security issues. Maintainers don't check daily; users hit issues first.\n\n## Business Impact\n- Stale checksums = false security failures\n- Automated PRs enable review (maintainer verifies legitimacy)\n- Reduces user friction (fewer 'checksum mismatch' errors)\n- Keeps project proactively maintained\n\n## Technical Approach\n1. Create .github/workflows/checksum-monitor.yml\n2. Daily cron at 6am UTC + manual trigger\n3. Run security.sh --verify --json to detect changes\n4. If mismatches found, update checksums.yaml\n5. Create PR with diff summary and review checklist\n6. Optional: Slack/Discord notification for urgent updates\n\n## Success Criteria\n- PRs created within 24 hours of upstream changes\n- PR body includes old/new checksums and verification checklist\n- Maintainer can review and merge with confidence\n- No user-facing checksum failures from stale data\n\n## Files to Create/Modify\n- .github/workflows/checksum-monitor.yml (new)\n- scripts/lib/security.sh: Add --json output for --verify\n\n## Reference\nSee: docs/ROADMAP_INSTALLER_RELIABILITY.md Section 6","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-21T12:41:27.836408-05:00","updated_at":"2025-12-21T15:17:32.064598-05:00","closed_at":"2025-12-21T15:17:32.064598-05:00","close_reason":"EPIC complete - all children implemented: GitHub Action workflow (coj), --json verify output (ss3), enhanced PR body (xos)"}
{"id":"agentic_coding_flywheel_setup-4xi","title":"Implement confirm_resume() interactive prompt","description":"# Task: Implement confirm_resume() interactive prompt\n\n## Purpose\nWhen ACFS detects a previous incomplete installation, ask the user whether to resume or start fresh.\n\n## Critical UX Decision: Silent Resume by Default\n\n**Key insight:** Users who run `./install.sh` on a partially-installed system WANT to resume. Forcing an interactive prompt every time creates friction.\n\n**Design:**\n```bash\nconfirm_resume() {\n    local state_file=\"$1\"\n    local last_phase=$(jq -r \".current_phase_id\" \"$state_file\")\n    local timestamp=$(jq -r \".started_at\" \"$state_file\")\n    \n    # Silent resume by default - just show status\n    log_info \"Resuming installation from phase: $last_phase\"\n    log_info \"Started: $timestamp\"\n    \n    # Only prompt if --interactive flag or stdin is a tty AND not --resume\n    if [[ \"${ACFS_INTERACTIVE:-}\" == \"true\" ]] \u0026\u0026 [[ -t 0 ]]; then\n        echo \"\"\n        echo \"Previous installation detected. Options:\"\n        echo \"  [R] Resume from $last_phase (default)\"\n        echo \"  [F] Fresh install (wipe state)\"\n        echo \"  [A] Abort\"\n        read -r -p \"Choice [R/f/a]: \" choice\n        case \"${choice,,}\" in\n            f) return 1 ;;  # Fresh\n            a) exit 0 ;;    # Abort\n            *) return 0 ;;  # Resume (default)\n        esac\n    fi\n    \n    return 0  # Auto-resume\n}\n```\n\n## CLI Flags Integration\n- `--resume`: Force resume without any prompt (explicit intent)\n- `--force-reinstall`: Force fresh install\n- `--interactive`: Enable prompts (for manual runs)\n- No flags + partial state: Silent resume with status message\n\n## Rationale\n- Agentic workflows run non-interactively; prompts would hang forever\n- Human users running manually see clear status and can use flags if needed\n- Matches behavior of `apt upgrade` which just continues by default\n\n## Dependencies\n- Depends on: state.json schema (agentic_coding_flywheel_setup-5zt)\n- Depends on: init_state()/save_state() (agentic_coding_flywheel_setup-uxc)\n\n## Acceptance Criteria\n- [ ] Silent resume is the default (no prompts)\n- [ ] Status message shown: \"Resuming from phase X\"\n- [ ] --interactive flag enables prompts for manual users\n- [ ] --resume flag makes intent explicit\n- [ ] Works correctly in non-tty environments (pipes, cron, CI)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T12:43:12.413691-05:00","updated_at":"2025-12-21T14:44:07.526112-05:00","closed_at":"2025-12-21T14:44:07.526112-05:00","close_reason":"Added confirm_resume() to state.sh with silent resume by default, CLI flag support (--resume, --force-reinstall, --interactive), gum integration, and parse_resume_flags() helper. All tests pass.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-4xi","depends_on_id":"agentic_coding_flywheel_setup-uxc","type":"blocks","created_at":"2025-12-21T12:47:28.330237-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-4zg","title":"Enforce checksum-verified upstream installer execution","description":"Root cause: checksum verification system exists (scripts/lib/security.sh + checksums.yaml) but many install/update paths still use unverified 'curl | bash/sh'. Integrate security.fetch_and_run into install.sh + scripts/lib/* and update doctor/smoke hints to avoid suggesting unverified installs.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-20T18:50:14.820583-05:00","updated_at":"2025-12-20T19:20:03.20366-05:00","closed_at":"2025-12-20T19:20:03.20366-05:00","close_reason":"Replaced remaining unverified upstream installer execution in scripts/lib/* with checksums.yaml + security.sh verification; tightened security.sh; updated doctor/smoke hints; shellcheck clean; changes pushed.","labels":["installer","security"]}
{"id":"agentic_coding_flywheel_setup-542","title":"Create acfs session list command","description":"# Task: Create acfs session list command\n\n## Context\nPart of EPIC: Agent Session Sharing and Replay (agentic_coding_flywheel_setup-0sb)\n\n## Rationale\nBefore export, users need to see what sessions are available.\n\n## Command\n```bash\nacfs session list\n# Output:\n# Recent Sessions (last 30 days):\n#   abc123  2025-01-15 10:30  claude-code  45m  \"Implemented auth...\"\n#   def456  2025-01-14 14:00  codex        20m  \"Fixed pagination bug\"\n#   ghi789  2025-01-13 09:15  claude-code  60m  \"Refactored API...\"\n#\n# Use: acfs session export --session-id \u003cid\u003e to export\n\nacfs session list --json\n# JSON array of sessions\n```\n\n## Implementation\n- Call CASS under the hood\n- Format output nicely for humans\n- --json for programmatic use\n- Show session ID, date, agent, duration, summary\n\n## Acceptance Criteria\n- Lists recent sessions\n- Shows key metadata (id, date, agent, duration)\n- --json works\n- Graceful error if CASS not installed\n\n## Dependencies\nRequires: Research CASS format task complete\n\n## Files to Modify\n- scripts/lib/session.sh","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T12:51:15.177278-05:00","updated_at":"2025-12-21T15:49:58.843284-05:00","closed_at":"2025-12-21T15:49:58.843284-05:00","close_reason":"Implemented list_sessions function in session.sh: (1) Shows sessions by agent and top workspaces via CASS stats, (2) --json flag outputs structured JSON, (3) --days/--agent/--limit options for filtering, (4) Graceful error if CASS not installed with install link. Also added check_cass_installed() and get_workspace_sessions() helpers.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-542","depends_on_id":"agentic_coding_flywheel_setup-eli","type":"blocks","created_at":"2025-12-21T12:51:29.699166-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-545","title":"Integrate preflight into install.sh as optional first step","description":"# Task: Integrate preflight into install.sh as optional first step\n\n## Context\nPart of EPIC: Pre-Flight Validation (agentic_coding_flywheel_setup-0ok)\n\n## Rationale\nUsers who skip the wizard and run the installer directly should still get pre-flight validation. Currently they only see failures 15 minutes in.\n\n## Proposal\nAdd preflight as Phase 0 of install.sh:\n\n```bash\nrun_phase 0 \"Pre-Flight Validation\" run_preflight_checks\n```\n\n### Behavior\n- Run all preflight checks\n- On FAIL: Show errors, exit (don't waste time)\n- On WARN: Show warnings, ask to continue (unless --yes)\n- On PASS: Continue silently\n\n### Flag\n```bash\n--skip-preflight    # Skip pre-flight checks (for debugging)\n```\n\n## Acceptance Criteria\n- Preflight runs before Phase 1\n- Failures abort immediately with actionable message\n- Warnings shown but don't block (with --yes)\n- --skip-preflight available for edge cases\n\n## Files to Modify\n- install.sh: Add Phase 0, add flag\n- scripts/preflight.sh: Ensure can be sourced, not just executed","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T12:50:00.154616-05:00","updated_at":"2025-12-21T14:47:37.034619-05:00","closed_at":"2025-12-21T14:47:37.034619-05:00","close_reason":"Integrated preflight into install.sh as Phase 0. Added run_preflight_checks() function, --skip-preflight flag, and auto-download for curl|bash scenario.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-545","depends_on_id":"agentic_coding_flywheel_setup-0iq","type":"blocks","created_at":"2025-12-21T12:51:28.766175-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-5m6","title":"EPIC: VPS Installer (install.sh)","description":"# Epic: VPS Installer (install.sh)\n\n## Overview\nBuild the one-liner bash installer that transforms a fresh Ubuntu VPS into a fully-armed agentic coding environment.\n\n## Background \u0026 Reasoning\nThis is the \"magic moment\" - the user pastes one command and everything happens. The installer must:\n- Work when run as root (common VPS default)\n- Work when run as ubuntu with sudo\n- Be idempotent (safe to run twice)\n- Handle connection drops and resume\n- Log everything for debugging\n\n## Design Philosophy\n**Vibe Mode Default**: Passwordless sudo, agents with full permissions, minimal friction.\n**Checkpointed Phases**: Each phase writes state so reruns skip completed work.\n**Module Manifest**: Single source of truth (acfs.manifest.yaml) drives all installs.\n\n## Installer Phases\n1. Preflight + confirm OS (Ubuntu 24.04+ / 25.x)\n2. Create/normalize `ubuntu` user + sudoers\n3. Base packages (apt)\n4. Shell (zsh + oh-my-zsh + p10k + plugins)\n5. Dev toolchain (bun, uv, rust, go, tmux, rg, ast-grep)\n6. Agent stack (claude/codex/gemini CLIs + aliases)\n7. Flywheel stack (ntm, slb, ubs, cass, cm, bv, caam, mcp_agent_mail)\n8. Post-install UX (onboard + doctor + summary)\n\n## Success Criteria\n- [ ] Fresh Ubuntu 25.x VPS → working environment in \u003c 15 minutes\n- [ ] Safe to run twice without breaking anything\n- [ ] All 8 Dicklesworthstone tools installed and verified\n- [ ] `acfs doctor` shows all green\n- [ ] Logs available at /var/log/acfs/install.log\n\n## Considerations\n- Always prefer upstream installers when available\n- Verify each tool after install\n- Provide clear error messages with fix suggestions\n- Support `--dry-run` for transparency","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-19T22:21:06.097272-05:00","updated_at":"2025-12-20T12:01:44.001564-05:00","closed_at":"2025-12-20T12:01:44.001564-05:00","close_reason":"All 12 sub-tasks completed. VPS installer fully modularized with libraries for: logging, OS detection, user normalization, shell setup, CLI tools, language runtimes, coding agents, Dicklesworthstone stack, cloud/database tools, smoke test, and canonical zshrc.","labels":["epic","installer"]}
{"id":"agentic_coding_flywheel_setup-5m6.1","title":"Create installer logging library (scripts/lib/logging.sh)","description":"# Task: Create Installer Logging Library\n\n## Description\nBuild a reusable logging library for consistent installer output.\n\n## Functions\n\n```bash\nlog_step()    # [1/8] Step description (blue)\nlog_detail()  # Indented detail (gray)\nlog_success() # ✔ Success message (green)\nlog_warn()    # ⚠️ Warning message (yellow)\nlog_error()   # ✖ Error message (red)\nlog_debug()   # Only if ACFS_DEBUG=1\n```\n\n## Requirements\n- All output to stderr (keep stdout clean)\n- Support --quiet flag (suppress non-errors)\n- Support --verbose flag (show debug)\n- Timestamps in log file\n- ANSI color codes with fallback\n\n## Log File\nWrite all output to:\n- `/var/log/acfs/install.log`\n- `~/.acfs/logs/install.\u003ctimestamp\u003e.log`\n\n## Implementation\n\n```bash\n#!/bin/bash\n# scripts/lib/logging.sh\n\nACFS_LOG_FILE=\"/var/log/acfs/install.log\"\nACFS_QUIET=\"${ACFS_QUIET:-0}\"\nACFS_VERBOSE=\"${ACFS_VERBOSE:-0}\"\n\nlog_step() {\n    local step=\"$1\"\n    local msg=\"$2\"\n    echo -e \"\\033[34m[$step] $msg\\033[0m\" \u003e\u00262\n    echo \"[$(date -Iseconds)] STEP: $msg\" \u003e\u003e \"$ACFS_LOG_FILE\"\n}\n```\n\n## Acceptance Criteria\n- [ ] All log functions implemented\n- [ ] Colors work in terminal\n- [ ] --quiet suppresses output\n- [ ] --verbose shows debug\n- [ ] Log file written with timestamps\n- [ ] Works when sourced by other scripts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:24:17.871116-05:00","updated_at":"2025-12-19T23:23:59.34494-05:00","closed_at":"2025-12-19T23:23:59.34494-05:00","close_reason":"Files created in previous session: scripts/lib/logging.sh, os_detect.sh, user.sh, zsh.sh, and install.sh with all 8 phases","labels":["installer","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-5m6.1","depends_on_id":"agentic_coding_flywheel_setup-5m6","type":"parent-child","created_at":"2025-12-19T22:24:17.872789-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-5m6.10","title":"Create modern CLI tools installer (scripts/lib/cli_tools.sh)","description":"# Task: Create Modern CLI Tools Installer\n\n## Description\nInstall modern CLI replacements that the zshrc depends on.\n\n## Tools to Install\n\n### Via apt (Ubuntu 24.04+)\n- ripgrep (rg) - fast grep\n- fd-find (fd) - fast find\n- bat/batcat - better cat\n- fzf - fuzzy finder\n- tmux - terminal multiplexer\n- neovim - better vim\n\n### Via cargo (more recent versions)\n- lsd - modern ls with icons\n- dust - better du\n- btop - better top (or via apt)\n- zoxide - better cd\n- ast-grep (sg) - structural grep\n\n### Via curl/installer\n- lazygit - git TUI\n- lazydocker - docker TUI\n- direnv - directory-specific env\n\n## Functions\n```bash\ninstall_apt_cli_tools()\ninstall_cargo_cli_tools()\ninstall_other_cli_tools()\nverify_cli_tools()\n```\n\n## Acceptance Criteria\n- [ ] All tools installed\n- [ ] Fallback logic (apt first, cargo if newer needed)\n- [ ] Verification for each tool\n- [ ] Idempotent","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:37:54.469899-05:00","updated_at":"2025-12-20T11:27:23.299944-05:00","closed_at":"2025-12-20T11:27:23.299944-05:00","close_reason":"Created scripts/lib/cli_tools.sh with modular installer functions for apt, cargo, and curl-based CLI tools","labels":["installer","mvp","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-5m6.10","depends_on_id":"agentic_coding_flywheel_setup-5m6","type":"parent-child","created_at":"2025-12-19T22:37:54.472277-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-5m6.11","title":"Create cloud and database tools installer (scripts/lib/cloud_db.sh)","description":"# Task: Create Cloud \u0026 Database Tools Installer\n\n## Description\nInstall PostgreSQL, HashiCorp Vault, and cloud CLIs.\n\n## Tools to Install\n\n### PostgreSQL 18\n```bash\n# Add PGDG repo\nsudo sh -c 'echo \"deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main\" \u003e /etc/apt/sources.list.d/pgdg.list'\ncurl -fsSL https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/postgresql.gpg\nsudo apt update\nsudo apt install -y postgresql-18\n```\n\n### HashiCorp Vault\n```bash\n# Via official HashiCorp repo\n```\n\n### Cloud CLIs (via bun)\n```bash\nbun install -g wrangler      # Cloudflare\nbun install -g supabase      # Supabase\nbun install -g vercel        # Vercel\n```\n\n## Functions\n```bash\ninstall_postgresql()\ninstall_vault()\ninstall_cloud_clis()\nverify_cloud_db()\n```\n\n## Acceptance Criteria\n- [ ] PostgreSQL 18 installed and running\n- [ ] Vault CLI available\n- [ ] All cloud CLIs installed\n- [ ] Verification passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:37:54.761033-05:00","updated_at":"2025-12-20T12:01:27.926318-05:00","closed_at":"2025-12-20T12:01:27.926318-05:00","close_reason":"Created scripts/lib/cloud_db.sh with install functions for PostgreSQL 18, HashiCorp Vault, and cloud CLIs (Wrangler, Supabase, Vercel). Respects skip flags, idempotent, configures PostgreSQL for development.","labels":["installer","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-5m6.11","depends_on_id":"agentic_coding_flywheel_setup-5m6","type":"parent-child","created_at":"2025-12-19T22:37:54.761485-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-5m6.12","title":"Create post-install smoke test","description":"# Task: Create Post-Install Smoke Test\n\n## Description\nAutomatic verification that runs at the end of install.sh.\n\n## What It Tests\n\n### Critical Path (must pass)\n1. User is ubuntu\n2. Shell is zsh\n3. Passwordless sudo works\n4. /data/projects exists\n5. bun, uv, cargo, go available\n6. claude, codex, gemini commands exist\n7. ntm command works\n8. onboard command exists\n\n### Non-Critical (warn only)\n- Agent Mail server can start\n- All 8 stack tools respond to --help\n- PostgreSQL service running\n\n## Output\n```\n[Smoke Test]\n✅ User: ubuntu\n✅ Shell: zsh\n✅ Sudo: passwordless\n✅ Workspace: /data/projects exists\n✅ Languages: bun, uv, cargo, go\n✅ Agents: claude, codex, gemini\n✅ NTM: working\n✅ Onboard: installed\n\n⚠️ Agent Mail: not started (run 'am' to start)\n⚠️ PostgreSQL: not running (optional)\n\nSmoke test: 8/8 critical passed, 2 warnings\n```\n\n## Integration\n- Called automatically at end of install.sh\n- Exit 0 if all critical pass\n- Exit 1 if any critical fail (with guidance)\n\n## Acceptance Criteria\n- [ ] All critical checks implemented\n- [ ] Clear pass/fail output\n- [ ] Warnings for non-critical\n- [ ] Runs in \u003c 10 seconds","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:38:39.577781-05:00","updated_at":"2025-12-20T11:54:49.548513-05:00","closed_at":"2025-12-20T11:54:49.548514-05:00","labels":["installer","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-5m6.12","depends_on_id":"agentic_coding_flywheel_setup-5m6","type":"parent-child","created_at":"2025-12-19T22:38:39.579953-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-5m6.2","title":"Create OS detection library (scripts/lib/os_detect.sh)","description":"# Task: Create OS Detection Library\n\n## Description\nBuild a library to detect and validate the target OS.\n\n## Requirements\n- Detect Ubuntu version (24.04, 25.x)\n- Detect architecture (amd64, arm64)\n- Fail gracefully on unsupported OS\n- Provide useful error messages\n\n## Functions\n\n```bash\ndetect_os()          # Returns: ubuntu\ndetect_version()     # Returns: 25.04\ndetect_codename()    # Returns: plucky\ndetect_arch()        # Returns: amd64 or arm64\nvalidate_os()        # Exit 1 if unsupported\n```\n\n## Supported Configurations\n- Ubuntu 24.04 LTS (noble)\n- Ubuntu 25.04 (plucky)\n- Ubuntu 25.10 (future)\n- Architectures: amd64, arm64\n\n## Implementation\n\n```bash\n#!/bin/bash\n# scripts/lib/os_detect.sh\n\ndetect_os() {\n    if [[ -f /etc/os-release ]]; then\n        . /etc/os-release\n        echo \"$ID\"\n    else\n        echo \"unknown\"\n    fi\n}\n\nvalidate_os() {\n    local os=$(detect_os)\n    local version=$(detect_version)\n    \n    if [[ \"$os\" != \"ubuntu\" ]]; then\n        log_error \"ACFS requires Ubuntu. Detected: $os\"\n        exit 1\n    fi\n    \n    # Check version \u003e= 24.04\n    if [[ \"${version%.*}\" -lt 24 ]]; then\n        log_error \"ACFS requires Ubuntu 24.04 or later. Detected: $version\"\n        exit 1\n    fi\n}\n```\n\n## Acceptance Criteria\n- [ ] Correctly detects Ubuntu versions\n- [ ] Detects arm64 vs amd64\n- [ ] Clear error on unsupported OS\n- [ ] Works on fresh Ubuntu VPS","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:24:30.433099-05:00","updated_at":"2025-12-19T23:23:59.346095-05:00","closed_at":"2025-12-19T23:23:59.346095-05:00","close_reason":"Files created in previous session: scripts/lib/logging.sh, os_detect.sh, user.sh, zsh.sh, and install.sh with all 8 phases","labels":["installer","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-5m6.2","depends_on_id":"agentic_coding_flywheel_setup-5m6","type":"parent-child","created_at":"2025-12-19T22:24:30.435198-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-5m6.3","title":"Create user normalization library (scripts/lib/user.sh)","description":"# Task: Create User Normalization Library\n\n## Description\nBuild a library to ensure the ubuntu user exists with correct configuration.\n\n## Requirements\n- Create ubuntu user if missing\n- Set up passwordless sudo\n- Copy SSH authorized_keys from root\n- Set zsh as default shell (after zsh installed)\n\n## Functions\n\n```bash\nensure_ubuntu_user()     # Create user if missing\nsetup_passwordless_sudo() # Write sudoers.d file\ncopy_ssh_keys()          # From root to ubuntu\nset_default_shell()      # Change to zsh\n```\n\n## Sudoers Configuration\nFile: `/etc/sudoers.d/90-ubuntu-acfs`\n```\nubuntu ALL=(ALL) NOPASSWD:ALL\n```\n\n## SSH Key Handling\nIf running as root:\n1. Check /root/.ssh/authorized_keys exists\n2. Create /home/ubuntu/.ssh/ if needed\n3. Copy authorized_keys\n4. Fix permissions (700, 600)\n5. Set ownership to ubuntu:ubuntu\n\n## Groups\nAdd ubuntu to:\n- sudo\n- docker (after docker installed)\n\n## Acceptance Criteria\n- [ ] Creates ubuntu user if missing\n- [ ] Passwordless sudo works\n- [ ] SSH keys copied from root\n- [ ] Correct file permissions\n- [ ] Works when run as root or ubuntu\n- [ ] Idempotent (safe to run twice)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:24:42.426684-05:00","updated_at":"2025-12-19T23:23:59.346616-05:00","closed_at":"2025-12-19T23:23:59.346616-05:00","close_reason":"Files created in previous session: scripts/lib/logging.sh, os_detect.sh, user.sh, zsh.sh, and install.sh with all 8 phases","labels":["installer","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-5m6.3","depends_on_id":"agentic_coding_flywheel_setup-5m6","type":"parent-child","created_at":"2025-12-19T22:24:42.428514-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-5m6.4","title":"Create shell setup library (scripts/lib/zsh.sh)","description":"# Task: Create Shell Setup Library\n\n## Description\nBuild a library to install and configure the complete shell environment.\n\n## Components\n1. zsh installation\n2. Oh My Zsh installation\n3. Powerlevel10k theme\n4. Plugins installation\n5. ACFS zshrc deployment\n\n## Functions\n\n```bash\ninstall_zsh()              # apt install zsh\ninstall_oh_my_zsh()        # Official installer\ninstall_powerlevel10k()    # Clone to custom themes\ninstall_zsh_plugins()      # Clone plugins\ndeploy_acfs_zshrc()        # Copy acfs.zshrc\nconfigure_zshrc()          # Set up loader\n```\n\n## Plugins to Install\n- zsh-autosuggestions\n- zsh-syntax-highlighting\n- docker\n- docker-compose\n- sudo\n- colored-man-pages\n- command-not-found\n- git (built-in)\n\n## File Layout\n```\n~/.acfs/\n├── zsh/\n│   └── acfs.zshrc     # Main config\n└── ...\n\n~/.zshrc                # Tiny loader\n~/.zshrc.local          # User overrides (touch)\n~/.p10k.zsh             # Theme config\n```\n\n## zshrc Loader Content\n```bash\n# ACFS loader\nsource \"$HOME/.acfs/zsh/acfs.zshrc\"\n[ -f \"$HOME/.zshrc.local\" ] \u0026\u0026 source \"$HOME/.zshrc.local\"\n```\n\n## Acceptance Criteria\n- [ ] zsh installed and working\n- [ ] Oh My Zsh installed\n- [ ] Powerlevel10k theme active\n- [ ] All plugins installed\n- [ ] acfs.zshrc deployed\n- [ ] Loader .zshrc in place\n- [ ] User overrides supported","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:24:55.348206-05:00","updated_at":"2025-12-19T23:23:59.346999-05:00","closed_at":"2025-12-19T23:23:59.346999-05:00","close_reason":"Files created in previous session: scripts/lib/logging.sh, os_detect.sh, user.sh, zsh.sh, and install.sh with all 8 phases","labels":["installer","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-5m6.4","depends_on_id":"agentic_coding_flywheel_setup-5m6","type":"parent-child","created_at":"2025-12-19T22:24:55.350105-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-5m6.5","title":"Create language runtimes installer (scripts/lib/languages.sh)","description":"# Task: Create Language Runtimes Installer\n\n## Description\nBuild a library to install all required language runtimes.\n\n## Languages to Install\n\n### Bun\n```bash\ncurl -fsSL https://bun.sh/install | bash\n```\n- Add to PATH: ~/.bun/bin\n- Install completions\n\n### uv (Python)\n```bash\ncurl -LsSf https://astral.sh/uv/install.sh | sh\n```\n- Installs to ~/.local/bin\n- Set UV_LINK_MODE=copy\n\n### Rust\n```bash\ncurl https://sh.rustup.rs -sSf | sh -s -- -y\n```\n- Adds ~/.cargo/bin to PATH\n- Non-interactive install\n\n### Go\n```bash\nsudo apt install -y golang-go\n```\n- Or latest from go.dev if needed\n\n## Functions\n\n```bash\ninstall_bun()     # Bun runtime\ninstall_uv()      # uv Python tooling\ninstall_rust()    # Rust + cargo\ninstall_go()      # Go toolchain\nverify_languages() # Check all installed\n```\n\n## Verification\n\n```bash\nbun --version\nuv --version\ncargo --version\ngo version\n```\n\n## Acceptance Criteria\n- [ ] All 4 languages installed\n- [ ] All in PATH\n- [ ] Verification commands pass\n- [ ] Idempotent (safe to run twice)\n- [ ] Works on arm64 and amd64","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:25:06.994349-05:00","updated_at":"2025-12-20T11:53:59.789783-05:00","closed_at":"2025-12-20T11:53:59.789783-05:00","close_reason":"Created scripts/lib/languages.sh with install_bun, install_uv, install_rust, install_go, and verify_languages functions. Follows cli_tools.sh patterns, idempotent, supports arm64/amd64.","labels":["installer","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-5m6.5","depends_on_id":"agentic_coding_flywheel_setup-5m6","type":"parent-child","created_at":"2025-12-19T22:25:06.996068-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-5m6.6","title":"Create coding agents installer (scripts/lib/agents.sh)","description":"# Task: Create Coding Agents Installer\n\n## Description\nBuild a library to install the three coding agent CLIs.\n\n## Agents to Install\n\n### Claude Code\n```bash\n# Official installer (check docs for latest)\ncurl -fsSL https://claude.ai/install.sh | bash\n# Or via installer script\n```\n- Installs to ~/.local/bin/claude\n- Requires login after install\n\n### Codex CLI (OpenAI)\n```bash\nbun install -g @openai/codex@latest\n```\n- Installed via bun global\n- Requires API key or login\n\n### Gemini CLI (Google)\n```bash\nbun install -g @google/gemini-cli@latest\n```\n- Installed via bun global\n- Requires login\n\n## Aliases\nThese are set in acfs.zshrc:\n```bash\nalias cc='NODE_OPTIONS=\"--max-old-space-size=32768\" ENABLE_BACKGROUND_TASKS=1 claude --dangerously-skip-permissions'\nalias cod='codex --dangerously-bypass-approvals-and-sandbox -m gpt-5.2-codex -c model_reasoning_effort=\"xhigh\" -c model_reasoning_summary_format=experimental --enable web_search_request'\nalias gmi='gemini --yolo --model gemini-3-pro-preview'\n```\n\n## Functions\n\n```bash\ninstall_claude_code()  # Install Claude CLI\ninstall_codex_cli()    # Install Codex CLI\ninstall_gemini_cli()   # Install Gemini CLI\nverify_agents()        # Check all installed\n```\n\n## Note\nThese require login after install - that happens in onboarding.\n\n## Acceptance Criteria\n- [ ] All 3 agents installed\n- [ ] Commands available in PATH\n- [ ] Aliases configured in zshrc\n- [ ] Verification commands work\n- [ ] Clear message about login requirement","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:25:22.66693-05:00","updated_at":"2025-12-20T11:56:10.596544-05:00","closed_at":"2025-12-20T11:56:10.596544-05:00","close_reason":"Created scripts/lib/agents.sh with install_claude_code, install_codex_cli, install_gemini_cli, and verify_agents functions. Requires bun. Idempotent and follows established patterns.","labels":["installer","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-5m6.6","depends_on_id":"agentic_coding_flywheel_setup-5m6","type":"parent-child","created_at":"2025-12-19T22:25:22.668571-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-5m6.7","title":"Create Dicklesworthstone stack installer (scripts/lib/stack.sh)","description":"# Task: Create Dicklesworthstone Stack Installer\n\n## Description\nBuild a library to install all 8 Dicklesworthstone tools.\n\n## Tools to Install (in order)\n\n### 1. NTM (Named Tmux Manager)\n```bash\ncurl -fsSL https://raw.githubusercontent.com/Dicklesworthstone/ntm/main/install.sh | bash\n```\n- Agent orchestration cockpit\n- Verify: `ntm --help`\n\n### 2. MCP Agent Mail\n```bash\ncurl -fsSL https://raw.githubusercontent.com/Dicklesworthstone/mcp_agent_mail/main/scripts/install.sh | bash -s -- --yes\n```\n- Agent coordination server\n- Verify: `command -v am`\n\n### 3. Ultimate Bug Scanner (UBS)\n```bash\ncurl -fsSL https://raw.githubusercontent.com/Dicklesworthstone/ultimate_bug_scanner/master/install.sh | bash -s -- --easy-mode\n```\n- Bug scanning with guardrails\n- Verify: `ubs --help`\n\n### 4. Beads Viewer (BV)\n```bash\ncurl -fsSL https://raw.githubusercontent.com/Dicklesworthstone/beads_viewer/main/install.sh | bash\n```\n- Task management TUI\n- Verify: `bv --help`\n\n### 5. CASS (Coding Agent Session Search)\n```bash\ncurl -fsSL https://raw.githubusercontent.com/Dicklesworthstone/coding_agent_session_search/main/install.sh | bash -s -- --easy-mode --verify\n```\n- Unified session search\n- Verify: `cass --help`\n\n### 6. CM (CASS Memory System)\n```bash\ncurl -fsSL https://raw.githubusercontent.com/Dicklesworthstone/cass_memory_system/main/install.sh | bash -s -- --easy-mode --verify\n```\n- Procedural memory for agents\n- Verify: `cm --version`\n\n### 7. CAAM (Coding Agent Account Manager)\n```bash\ncurl -fsSL https://raw.githubusercontent.com/Dicklesworthstone/coding_agent_account_manager/main/install.sh | bash\n```\n- Auth switching\n- Verify: `caam --help`\n\n### 8. SLB (Simultaneous Launch Button)\n```bash\ncurl -fsSL https://raw.githubusercontent.com/Dicklesworthstone/slb/main/scripts/install.sh | bash\n```\n- Two-person rule for dangerous commands\n- Verify: `slb --help`\n\n## Functions\n\n```bash\ninstall_ntm()\ninstall_mcp_agent_mail()\ninstall_ubs()\ninstall_bv()\ninstall_cass()\ninstall_cm()\ninstall_caam()\ninstall_slb()\nverify_stack()  # Check all 8 installed\n```\n\n## Acceptance Criteria\n- [ ] All 8 tools installed\n- [ ] All commands in PATH\n- [ ] All verify commands pass\n- [ ] Idempotent installation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:25:40.15948-05:00","updated_at":"2025-12-20T11:58:04.942997-05:00","closed_at":"2025-12-20T11:58:04.942997-05:00","close_reason":"Created scripts/lib/stack.sh with install functions for all 8 Dicklesworthstone tools (NTM, MCP Agent Mail, UBS, BV, CASS, CM, CAAM, SLB). Idempotent with verification functions.","labels":["installer","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-5m6.7","depends_on_id":"agentic_coding_flywheel_setup-5m6","type":"parent-child","created_at":"2025-12-19T22:25:40.161715-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-5m6.8","title":"Create main install.sh orchestrator","description":"# Task: Create Main install.sh Orchestrator\n\n## Description\nBuild the main installer script that orchestrates all phases.\n\n## Script Structure\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\n# Parse arguments\nparse_args() {\n    while [[ $# -gt 0 ]]; do\n        case $1 in\n            --yes) ACFS_AUTO_APPROVE=1 ;;\n            --mode) ACFS_MODE=\"$2\"; shift ;;\n            --dry-run) ACFS_DRY_RUN=1 ;;\n            --quiet) ACFS_QUIET=1 ;;\n            --verbose) ACFS_VERBOSE=1 ;;\n            *) log_error \"Unknown option: $1\"; exit 1 ;;\n        esac\n        shift\n    done\n}\n\n# Main phases\nmain() {\n    log_step \"0/8\" \"Preflight checks\"\n    source_libs\n    validate_os\n    \n    log_step \"1/8\" \"Setting up ubuntu user\"\n    ensure_ubuntu_user\n    setup_passwordless_sudo\n    \n    log_step \"2/8\" \"Creating workspace\"\n    create_workspace\n    \n    log_step \"3/8\" \"Installing shell environment\"\n    install_zsh_environment\n    \n    log_step \"4/8\" \"Installing languages\"\n    install_languages\n    \n    log_step \"5/8\" \"Installing dev tools\"\n    install_dev_tools\n    \n    log_step \"6/8\" \"Installing coding agents\"\n    install_agents\n    \n    log_step \"7/8\" \"Installing Dicklesworthstone stack\"\n    install_stack\n    \n    log_step \"8/8\" \"Final configuration\"\n    deploy_configs\n    install_onboard\n    \n    print_completion_message\n}\n\nmain \"$@\"\n```\n\n## Error Handling\n- Trap errors with helpful message\n- Log to file before exit\n- Suggest running acfs doctor\n\n## Checkpointing\n- Write completed phases to ~/.acfs/state.json\n- Skip completed phases on re-run\n- Support --force to re-run all\n\n## Acceptance Criteria\n- [ ] All 8 phases implemented\n- [ ] Clean error handling\n- [ ] Checkpointing works\n- [ ] --dry-run mode\n- [ ] Completion message with next steps\n- [ ] Works as root or ubuntu","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:25:56.003488-05:00","updated_at":"2025-12-19T23:23:59.347345-05:00","closed_at":"2025-12-19T23:23:59.347345-05:00","close_reason":"Files created in previous session: scripts/lib/logging.sh, os_detect.sh, user.sh, zsh.sh, and install.sh with all 8 phases","labels":["installer","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-5m6.8","depends_on_id":"agentic_coding_flywheel_setup-5m6","type":"parent-child","created_at":"2025-12-19T22:25:56.005402-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-5m6.9","title":"Create clean canonical acfs.zshrc","description":"# Task: Create Clean Canonical acfs.zshrc\n\n## Description\nCreate the production-ready zshrc that ACFS deploys to VPS.\n\n## File: acfs/zsh/acfs.zshrc\n\n## Requirements\nBased on user's original zshrc but:\n- Remove duplicate PATH/Bun blocks\n- Remove duplicate aliases\n- Use safe chpwd hook instead of overriding cd()\n- Fix atuin path before init ordering\n- Conditional tool aliases (only if tool exists)\n- Support user overrides via ~/.zshrc.local\n\n## Structure\n\n```bash\n# ~/.acfs/zsh/acfs.zshrc\n# ACFS canonical zsh config (managed)\n\n# --- SSH guard ---\n# Prevent weird terminal settings over SSH\n\n# --- Paths (early) ---\n# ~/.local/bin, ~/.cargo/bin, go, bun, atuin\n\n# --- Oh My Zsh ---\n# Theme: powerlevel10k\n# Plugins: git, autosuggestions, syntax-highlighting, etc.\n\n# --- Editor preference ---\n# vim over SSH, nvim locally\n\n# --- Modern CLI aliases ---\n# Only set if tool exists\n# lsd/eza, bat, fd, rg, dust, btop, nvim, lazygit\n\n# --- Git aliases ---\n# gs, gd, gdc, gp, gpu, gco, gcm, gca, gb, glog\n\n# --- Docker aliases ---\n# dc, dps, dpsa, dimg, dex\n\n# --- Directory shortcuts ---\n# dev, proj, dots, p\n\n# --- Custom functions ---\n# mkcd, extract\n\n# --- Safe ls after cd ---\n# Using chpwd hook, not overriding cd()\n\n# --- Tool settings ---\n# UV_LINK_MODE, etc.\n\n# --- Tool initializations ---\n# cargo, atuin, zoxide, direnv, fzf\n\n# --- Agent aliases ---\n# cc, cod, gmi (dangerous mode enabled)\n\n# --- Keybindings ---\n# Ctrl/Alt+Arrow for word movement\n# Home/End keys\n# Force atuin Ctrl-R\n```\n\n## Acceptance Criteria\n- [ ] No duplicate code\n- [ ] All tools alias only if present\n- [ ] chpwd hook works correctly\n- [ ] Atuin Ctrl-R works\n- [ ] Local overrides supported\n- [ ] Passes shellcheck","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:27:40.519614-05:00","updated_at":"2025-12-20T11:59:34.896944-05:00","closed_at":"2025-12-20T11:59:34.896944-05:00","close_reason":"Fixed shellcheck warnings, added directives for zsh-specific variables. File already met all requirements: no duplicates, conditional aliases, safe chpwd hook, proper atuin ordering, local overrides support.","labels":["config","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-5m6.9","depends_on_id":"agentic_coding_flywheel_setup-5m6","type":"parent-child","created_at":"2025-12-19T22:27:40.521482-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-5uu","title":"EPIC: Phase-Granular Progress Persistence","description":"# Epic: Phase-Granular Progress Persistence\n\n## Overview\nMake install.sh truly resumable by writing state after each phase completes, not just at the end.\n\n## Problem Statement\nCurrently, ~/.acfs/state.json is only written AFTER successful completion (install.sh ~line 1197-1210). If SSH disconnects at phase 8/10, users lose 15-20 minutes of work and must restart from scratch.\n\n## Business Impact\n- User Frustration: VPS SSH is unreliable; users close laptops, lose WiFi\n- Completion Rate: Long installs (15-25 min) have high interruption probability\n- Support Burden: 'I lost my progress' is a predictable complaint\n\n## Success Criteria\n- Re-running installer after disconnect resumes from last completed phase\n- State file is atomic (no corruption on interrupt)\n- Resume behavior is default; --force-reinstall overrides\n\n## Files to Modify\n- install.sh: Main state management logic\n- scripts/lib/state.sh (new): Extracted state helpers\n\n## Reference\nSee: docs/ROADMAP_INSTALLER_RELIABILITY.md Section 1","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-21T12:40:05.86043-05:00","updated_at":"2025-12-21T15:03:45.447046-05:00","closed_at":"2025-12-21T15:03:45.447046-05:00","close_reason":"All child tasks closed: 5zt (state schema), uxc (init/save), aa1 (atomic writes), d09 (corruption handling), 4xi (confirm_resume), yaj (run_phase wrapper), ywk (integration tests). Core phase-granular persistence implemented in scripts/lib/state.sh.","comments":[{"id":2,"issue_id":"agentic_coding_flywheel_setup-5uu","author":"jemanuel","text":"FYI: created `agentic_coding_flywheel_setup-mjt` (Manifest-Driven Installer Integration). This work will refactor `install.sh` to source generated installers + manifest_index and will touch selection semantics (`--only/--skip/--print-plan`) and curl|bash bootstrap (single archive).\n\nPlease keep this epic’s work compatible with your scope:\n- orchestration/state/error-reporting/preflight remains install.sh + scripts/lib owned\n- generated scripts stay source-safe (no top-level side effects)","created_at":"2025-12-21T18:50:07Z"}]}
{"id":"agentic_coding_flywheel_setup-5vz","title":"Add installer security verification","description":"# Task: Add Installer Security Verification\n\n## Description\nMake the curl|bash pattern more trustworthy.\n\n## Features\n\n### 1. Checksum Verification\nBefore running sub-installers, verify checksums:\n```bash\nverify_checksum() {\n    local url=\"$1\"\n    local expected_sha256=\"$2\"\n    local content=$(curl -fsSL \"$url\")\n    local actual=$(echo \"$content\" | sha256sum | cut -d' ' -f1)\n    if [[ \"$actual\" != \"$expected_sha256\" ]]; then\n        log_error \"Checksum mismatch for $url\"\n        exit 1\n    fi\n    echo \"$content\"\n}\n```\n\n### 2. HTTPS Enforcement\nAll URLs must be HTTPS. Fail on HTTP.\n\n### 3. --print Mode\nShow exactly what will be downloaded:\n```bash\ninstall.sh --print\n# Outputs:\n# Will download:\n# - https://bun.sh/install (sha256: abc123...)\n# - https://astral.sh/uv/install.sh (sha256: def456...)\n# ...\n```\n\n### 4. Source Links\nWebsite shows link to install.sh source on GitHub.\n\n### 5. Changelog\nWhat changed since last version.\n\n## Checksums File\n```yaml\n# checksums.yaml\ninstallers:\n  bun: \"abc123...\"\n  uv: \"def456...\"\n  # etc\n```\n\n## Acceptance Criteria\n- [ ] Checksum verification for key installers\n- [ ] HTTPS enforced\n- [ ] --print mode works\n- [ ] Website links to source","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:39:05.141855-05:00","updated_at":"2025-12-20T12:52:21.63953-05:00","closed_at":"2025-12-20T12:52:21.63953-05:00","close_reason":"Implemented security.sh with HTTPS enforcement, SHA256 checksum verification, --print/--verify/--update-checksums modes. Created checksums.yaml with hashes for 14 installers. Commit bc41158.","labels":["installer","security","task"]}
{"id":"agentic_coding_flywheel_setup-5zm","title":"Implement report_failure() with structured output","description":"# Task: Implement report_failure() with structured output\n\n## Context\nPart of EPIC: Per-Phase Error Reporting (agentic_coding_flywheel_setup-fkf)\n\n## What to Do\nCreate a comprehensive failure report function:\n\n### Human Output (terminal)\n```\n╔══════════════════════════════════════════════════════════════╗\n║  ✖ INSTALLATION FAILED                                        ║\n║                                                                ║\n║  Phase 6/10: Language Runtimes                                 ║\n║  Failed at: Installing Rust via rustup                         ║\n║                                                                ║\n║  Error: curl: (7) Failed to connect to sh.rustup.rs           ║\n║                                                                ║\n║  Suggested Fix:                                                ║\n║    1. Check internet: curl -I https://google.com              ║\n║    2. Retry: curl ... | bash -s -- --resume                   ║\n║                                                                ║\n║  Full log: /var/log/acfs/install.log                          ║\n╚══════════════════════════════════════════════════════════════╝\n```\n\n### JSON Output (log file)\nAppend structured JSON to install.log for tooling.\n\n### With gum\nUse gum style for prettier box drawing.\n\n## Acceptance Criteria\n- Shows phase number and name\n- Shows specific step that failed\n- Shows error excerpt (truncated if long)\n- Shows suggested fix from ERROR_PATTERNS\n- Shows resume command\n- Works with and without gum\n\n## Files to Modify\n- install.sh: Add report_failure() function","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T12:44:00.671428-05:00","updated_at":"2025-12-21T14:47:14.92113-05:00","closed_at":"2025-12-21T14:47:14.92113-05:00","close_reason":"Created scripts/lib/report.sh with report_failure(), report_success(), report_warning(), report_skipped_summary(). Supports gum styling, JSON logging, and suggested fixes from ERROR_PATTERNS.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-5zm","depends_on_id":"agentic_coding_flywheel_setup-vwv","type":"blocks","created_at":"2025-12-21T12:47:30.834519-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-5zm","depends_on_id":"agentic_coding_flywheel_setup-qqo","type":"blocks","created_at":"2025-12-21T12:47:31.011809-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-5zt","title":"Design state.json v2 schema","description":"# Task: Design state.json v2 schema\n\n## Context\nPart of EPIC: Phase-Granular Progress Persistence\n\n## Critical Design Decision: Track Phase IDs, Not Numbers\n\n**Problem with tracking phase numbers:**\nIf we store `completed_phases: [1, 2, 3, 4, 5]` and later ACFS reorders phases or adds a new phase 3, the resume logic would skip the wrong phases.\n\n**Solution:** Track phase IDs (stable identifiers):\n```json\n{\n    \"schema_version\": 2,\n    \"completed_phases\": [\"user_setup\", \"apt_packages\", \"shell_setup\", \"cli_tools\", \"languages\"],\n    \"current_phase\": \"agents\",\n    ...\n}\n```\n\n## Full Schema\n\n```json\n{\n    \"schema_version\": 2,\n    \"version\": \"0.1.0\",\n    \"mode\": \"vibe\",\n    \"started_at\": \"2025-01-15T10:30:00Z\",\n    \"last_updated\": \"2025-01-15T10:42:00Z\",\n    \"completed_phases\": [\"user_setup\", \"apt_packages\", \"shell_setup\"],\n    \"current_phase\": \"cli_tools\",\n    \"current_step\": \"Installing ripgrep\",\n    \"failed_phase\": null,\n    \"failed_step\": null,\n    \"skipped_tools\": [\"ntm\", \"bv\"],\n    \"skipped_phases\": [\"postgres\", \"vault\"],\n    \"phase_durations\": {\n        \"user_setup\": 12,\n        \"apt_packages\": 45\n    }\n}\n```\n\n## Phase IDs (stable, never change meaning)\n- user_setup\n- apt_packages  \n- shell_setup\n- cli_tools\n- languages\n- tools\n- database\n- cloud\n- agents\n- stack\n- finalize\n\n## Backwards Compatibility\n- If schema_version missing or 1: treat as legacy, offer fresh start\n- Phase IDs are strings, won't conflict with old number-based format\n\n## Acceptance Criteria\n- Schema uses phase IDs not numbers\n- Documented in code comments\n- Backwards compatible with v1 detection\n- All fields have sensible defaults","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T12:42:39.486596-05:00","updated_at":"2025-12-21T14:39:43.137058-05:00","closed_at":"2025-12-21T14:39:43.137058-05:00","close_reason":"Already implemented in scripts/lib/state.sh. Schema v2 uses phase IDs, is documented, and has backwards compatibility."}
{"id":"agentic_coding_flywheel_setup-6fx","title":"cloud_db.sh: verify respects SKIP flags + optional installs","description":"scripts/lib/cloud_db.sh claims to respect SKIP_POSTGRES/SKIP_VAULT/SKIP_CLOUD in install_all_cloud_db, but verify_cloud_db still fails if those tools are intentionally skipped.","acceptance_criteria":"- With SKIP_POSTGRES=true, verify_cloud_db does not mark psql missing as failure.\n- With SKIP_VAULT=true, verify_cloud_db does not mark vault missing as failure.\n- With SKIP_CLOUD=true, verify_cloud_db does not mark cloud CLIs missing as failure.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-20T14:45:03.242319-05:00","updated_at":"2025-12-20T14:52:41.60688-05:00","closed_at":"2025-12-20T14:52:41.60688-05:00","close_reason":"Updated verify_cloud_db to honor SKIP_POSTGRES/SKIP_VAULT/SKIP_CLOUD so skips don't count as failures."}
{"id":"agentic_coding_flywheel_setup-75e","title":"Core infrastructure for acfs-update","description":"## What\nCreate the main acfs-update script skeleton with:\n- Argument parsing (categories, --yes, --dry-run, --verbose, --quiet, --continue/--abort-on-failure)\n- Logging infrastructure (to ~/.acfs/logs/updates/YYYY-MM-DD-HHMMSS.log)\n- Progress display and summary generation\n- Helper functions for version detection, before/after capture\n- Checksum verification helpers (for stack updates)\n\n## Why\nAll category-specific update implementations depend on this foundation. Must be solid and well-tested before building on top.\n\n## IMPORTANT: Execution Order\nCategories must run in a specific order at runtime (even if beads are implemented in parallel):\n1. system - apt updates may affect Python, libraries\n2. runtimes - bun, rust, uv depend on system packages\n3. shell - may use runtimes\n4. agents - use runtimes (bun for codex/gemini)\n5. stack - use runtimes (uv for mcp_agent_mail, cargo for some tools)\n6. cloud - use runtimes (bun for most CLIs)\n\n## Script Structure\n- Main entry point with arg parsing\n- Category dispatch (run selected categories in order)\n- Per-tool update wrapper with logging\n- Summary generation at end\n\n## Considerations\n- Script location: ~/.acfs/bin/acfs-update (added to PATH during install)\n- Logging must capture stdout/stderr from each update\n- Version detection varies by tool (--version, git describe, etc.)\n- For --dry-run: show what WOULD happen without doing it\n- For --yes: suppress all prompts, proceed automatically\n\n## Success Criteria\n- [ ] acfs-update --help shows usage\n- [ ] --dry-run mode works (no actual changes)\n- [ ] Log file created with timestamps\n- [ ] Summary shows \"X updated, Y skipped, Z failed\"\n- [ ] Categories run in correct order","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-21T13:25:14.89257-05:00","updated_at":"2025-12-21T15:08:16.127634-05:00","closed_at":"2025-12-21T15:08:16.127634-05:00","close_reason":"Implemented core update infrastructure: logging, version detection, new CLI flags, abort-on-failure support","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-75e","depends_on_id":"agentic_coding_flywheel_setup-x0l","type":"blocks","created_at":"2025-12-21T13:25:20.750551-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-75r","title":"EPIC: acfs doctor \u0026 Update Commands","description":"# Epic: acfs doctor \u0026 Update Commands\n\n## Overview\nBuild the diagnostic and update commands that help users verify and maintain their ACFS installation.\n\n## Background \u0026 Reasoning\nBeginners don't debug - they need clear \"is it working?\" feedback and simple fixes.\n\n### acfs doctor\nSingle command to verify entire installation:\n- Identity (user ubuntu, passwordless sudo)\n- Shell setup (zsh, plugins, theme)\n- All tools installed and working\n- Clear PASS/FAIL/WARN for each check\n\n### acfs update\nKeep everything current:\n- apt update + upgrade\n- Update bun globals (codex, gemini, vercel, etc.)\n- Optionally re-run tool installers\n\n## Doctor Output Spec\n\n```\nACFS Doctor v0.1.0\nUser: ubuntu ✅\nMode: vibe (passwordless sudo: enabled) ✅\nOS: Ubuntu 25.x ✅\n\nShell\n  PASS ✅ zsh installed (5.x)\n  PASS ✅ oh-my-zsh installed\n  ...\n\nDicklesworthstone stack\n  PASS ✅ ntm (available)\n  PASS ✅ slb (available)\n  ...\n\nSummary: 34 passed, 0 failed, 1 warning\nNext: run `onboard`\n```\n\n## JSON Mode\n`acfs doctor --json` outputs structured data for website integration:\n```json\n{\n  \"checks\": [\n    {\"id\": \"identity.user_is_ubuntu\", \"status\": \"pass\", ...}\n  ],\n  \"summary\": {\"pass\": 34, \"warn\": 1, \"fail\": 0}\n}\n```\n\n## Success Criteria\n- [ ] acfs doctor checks all ~40 tools\n- [ ] Each check has stable ID for website mapping\n- [ ] Exit code 0 = all pass, 1 = any fail\n- [ ] --json mode for automation\n- [ ] acfs update works without interaction\n- [ ] Clear fix suggestions for each failure","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-19T22:21:55.795457-05:00","updated_at":"2025-12-20T12:21:19.016509-05:00","closed_at":"2025-12-20T12:21:19.016509-05:00","close_reason":"All sub-tasks completed: 75r.1 (acfs doctor) and 75r.2 (acfs update). Both commands fully implemented with comprehensive options.","labels":["epic","tooling"]}
{"id":"agentic_coding_flywheel_setup-75r.1","title":"Implement acfs doctor command","description":"# Task: Implement acfs doctor Command\n\n## Description\nBuild the diagnostic command that verifies the entire ACFS installation.\n\n## Location\nInstall to: `~/.acfs/bin/acfs`\nSubcommand: `acfs doctor`\n\n## Output Format\n\n```\nACFS Doctor v0.1.0\nUser: ubuntu ✅\nMode: vibe (passwordless sudo: enabled) ✅\nOS: Ubuntu 25.x ✅\nWorkspace: /data/projects ✅\n\nShell\n  PASS ✅ zsh installed (zsh 5.x)\n  PASS ✅ oh-my-zsh installed\n  ...\n\nSummary: 34 passed, 0 failed, 1 warning\nNext: run `onboard`\n```\n\n## Check Structure\n\nEach check has:\n- id: Stable identifier for website mapping\n- label: Human-readable name\n- status: pass | warn | fail\n- details: Version or extra info\n- fix: Command to fix (on failure)\n\n## Implementation\n\n```bash\n#!/bin/bash\n\nrun_check() {\n    local id=\"$1\"\n    local label=\"$2\"\n    local check_cmd=\"$3\"\n    local fix_cmd=\"$4\"\n    \n    if eval \"$check_cmd\" \u0026\u003e/dev/null; then\n        echo \"PASS ✅ $label\"\n        echo \"{\\\"id\\\":\\\"$id\\\",\\\"status\\\":\\\"pass\\\"}\" \u003e\u003e \"$JSON_OUTPUT\"\n    else\n        echo \"FAIL ❌ $label\"\n        echo \"      Fix: $fix_cmd\"\n        echo \"{\\\"id\\\":\\\"$id\\\",\\\"status\\\":\\\"fail\\\",\\\"fix\\\":\\\"$fix_cmd\\\"}\" \u003e\u003e \"$JSON_OUTPUT\"\n        ((FAIL_COUNT++))\n    fi\n}\n\n# Run all checks\nrun_check \"identity.user_is_ubuntu\" \"Logged in as ubuntu\" \\\n    \"[[ \\$(whoami) == 'ubuntu' ]]\" \\\n    \"sudo -u ubuntu bash\"\n```\n\n## JSON Mode\n`acfs doctor --json` outputs:\n```json\n{\n  \"acfs_version\": \"0.1.0\",\n  \"checks\": [...],\n  \"summary\": {\"pass\": 34, \"warn\": 1, \"fail\": 0}\n}\n```\n\n## Exit Codes\n- 0: All pass (warnings OK)\n- 1: Any failure\n- 2: Doctor crashed\n\n## Acceptance Criteria\n- [ ] All ~40 checks implemented\n- [ ] Stable check IDs\n- [ ] --json mode works\n- [ ] Correct exit codes\n- [ ] Fix suggestions on failure\n- [ ] Summary at end","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:26:41.266691-05:00","updated_at":"2025-12-20T12:11:02.667771-05:00","closed_at":"2025-12-20T12:11:02.667771-05:00","close_reason":"scripts/lib/doctor.sh exists with 332 lines implementing comprehensive health checks","labels":["task","tooling"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-75r.1","depends_on_id":"agentic_coding_flywheel_setup-75r","type":"parent-child","created_at":"2025-12-19T22:26:41.268261-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-75r.2","title":"Implement acfs update command","description":"# Task: Implement acfs update Command\n\n## Description\nCreate command to update all ACFS-installed components.\n\n## What It Updates\n\n### System\n```bash\nsudo apt update \u0026\u0026 sudo apt upgrade -y \u0026\u0026 sudo apt autoremove -y\n```\n\n### Bun Globals\n```bash\nbun install -g @openai/codex@latest\nbun install -g @google/gemini-cli@latest\nbun install -g wrangler@latest\nbun install -g supabase@latest\nbun install -g vercel@latest\n```\n\n### Claude Code\n```bash\nclaude update\n```\n\n### Dicklesworthstone Stack\n- Check for updates to each tool\n- Re-run installers if --force flag\n\n## Flags\n- --apt-only: Only system packages\n- --agents-only: Only coding agents\n- --stack-only: Only Dicklesworthstone tools\n- --force: Re-run all installers even if up-to-date\n\n## Acceptance Criteria\n- [ ] Updates apt packages\n- [ ] Updates bun globals\n- [ ] Updates Claude Code\n- [ ] Optional stack update\n- [ ] Progress output\n- [ ] Summary of what was updated","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:38:14.55906-05:00","updated_at":"2025-12-20T12:20:44.214258-05:00","closed_at":"2025-12-20T12:20:44.214258-05:00","close_reason":"Implemented acfs update command with: apt updates, bun self-upgrade, agent updates (Claude/Codex/Gemini), cloud CLI updates (Wrangler/Supabase/Vercel), Rust/uv updates, optional stack updates. Supports --dry-run, --force, selective flags. Commit e6d310b.","labels":["task","tooling"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-75r.2","depends_on_id":"agentic_coding_flywheel_setup-75r","type":"parent-child","created_at":"2025-12-19T22:38:14.560845-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-7q1","title":"Wrap all phase functions with try_step calls","description":"# Task: Wrap all phase functions with try_step calls\n\n## Context\nPart of EPIC: Per-Phase Error Reporting (agentic_coding_flywheel_setup-fkf)\n\n## What to Do\nUpdate all install_phase_* functions to use try_step() for each operation:\n\n### Before\n```bash\ninstall_phase_languages() {\n    curl -fsSL https://bun.sh/install | bash\n    curl -fsSL https://sh.rustup.rs | sh -s -- -y\n    # ...\n}\n```\n\n### After\n```bash\ninstall_phase_languages() {\n    CURRENT_PHASE_NAME=\"Language Runtimes\"\n\n    if ! command -v bun \u0026\u003e/dev/null; then\n        try_step \"Installing Bun runtime\" \\\n            \"acfs_curl https://bun.sh/install | bash\" || return 1\n    fi\n\n    if ! command -v cargo \u0026\u003e/dev/null; then\n        try_step \"Installing Rust via rustup\" \\\n            \"acfs_curl https://sh.rustup.rs | sh -s -- -y\" || return 1\n    fi\n    # ...\n}\n```\n\n## Acceptance Criteria\n- All phases use try_step for each operation\n- Each step has descriptive name\n- Existing command skip logic preserved\n- return 1 on any step failure\n\n## Files to Modify\n- install.sh: All install_phase_* functions","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T12:44:02.642601-05:00","updated_at":"2025-12-21T15:02:12.698982-05:00","closed_at":"2025-12-21T15:02:12.698982-05:00","close_reason":"Wrapped all 10 phase functions with set_phase() and try_step() calls. Total 98 try_step calls now in install.sh. Phases: base_deps, normalize_user, setup_filesystem, setup_shell, install_cli_tools, install_languages, install_agents, install_cloud_db, install_stack, finalize","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-7q1","depends_on_id":"agentic_coding_flywheel_setup-qqo","type":"blocks","created_at":"2025-12-21T12:47:31.195934-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-7q1","depends_on_id":"agentic_coding_flywheel_setup-5zm","type":"blocks","created_at":"2025-12-21T12:47:31.390618-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-85l","title":"Wizard: setCompletedSteps should notify same-tab listeners","description":"apps/web/lib/wizardSteps.ts setCompletedSteps writes localStorage but does not emit same-tab change events; pages like launch-onboarding call setCompletedSteps directly, so Stepper/useCompletedSteps can be stale until reload. Make setCompletedSteps emitStepsChange and avoid double-emission in markStepComplete.","status":"closed","priority":2,"issue_type":"bug","assignee":"FuchsiaCreek","created_at":"2025-12-20T13:52:49.486053-05:00","updated_at":"2025-12-20T13:53:19.718399-05:00","closed_at":"2025-12-20T13:53:19.718399-05:00","close_reason":"Made setCompletedSteps emit same-tab change events so useCompletedSteps/Stepper update immediately; removed redundant emit in markStepComplete to avoid double notifications."}
{"id":"agentic_coding_flywheel_setup-88b","title":"security.sh: avoid printing hash on fetch failure","description":"scripts/lib/security.sh fetch_checksum currently can emit the SHA of empty input when curl fails (because sha256sum still runs). Change it to only emit a hash when fetch succeeds (preserve exact bytes with sentinel).","status":"closed","priority":2,"issue_type":"bug","assignee":"FuchsiaCreek","created_at":"2025-12-20T13:35:36.17546-05:00","updated_at":"2025-12-20T13:36:44.037785-05:00","closed_at":"2025-12-20T13:36:44.037785-05:00","close_reason":"Updated scripts/lib/security.sh fetch_checksum to only emit a checksum when curl fetch succeeds (preserves trailing newlines via sentinel), avoiding accidental empty-input hashes on network failure."}
{"id":"agentic_coding_flywheel_setup-8kk","title":"Replace default Next.js landing + metadata with ACFS wizard entry","description":"apps/web still has the default create-next-app landing page and metadata. Replace with an ACFS landing that links to the wizard (start at /wizard/os-selection) and update app metadata (title/description) to match ACFS.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T15:22:03.455898-05:00","updated_at":"2025-12-20T15:24:29.6171-05:00","closed_at":"2025-12-20T15:24:29.6171-05:00","close_reason":"Replaced create-next-app landing + metadata with ACFS landing that links to /wizard/os-selection; bun lint + type-check clean.","labels":["ux","web"]}
{"id":"agentic_coding_flywheel_setup-8mv","title":"Add --strict flag for legacy checksum behavior","description":"# Task: Add --strict flag for legacy checksum behavior\n\n## Context\nPart of EPIC: Checkpoint-Based Checksum Recovery (agentic_coding_flywheel_setup-tx7)\n\n## What to Do\nAdd --strict flag that restores the original behavior where ANY checksum mismatch aborts installation.\n\n### Behavior\n- Without --strict (default): Use new recovery flow\n- With --strict: All tools treated as critical, any mismatch aborts\n\n### Use Cases\n- Security-conscious users who want no exceptions\n- CI/CD environments where reproducibility matters\n- Auditing/compliance scenarios\n\n## Acceptance Criteria\n- --strict flag parsed in argument handling\n- When set, all tools treated as critical\n- Help text documents the flag\n- Default behavior is recovery flow\n\n## Files to Modify\n- install.sh: Argument parsing, pass flag to security functions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T12:44:39.830135-05:00","updated_at":"2025-12-21T15:04:39.956587-05:00","closed_at":"2025-12-21T15:04:39.956587-05:00","close_reason":"Added --strict flag to install.sh that sets ACFS_STRICT_MODE=true. When enabled, all tools are treated as CRITICAL and any checksum mismatch aborts installation. Updated header documentation.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-8mv","depends_on_id":"agentic_coding_flywheel_setup-v8a","type":"blocks","created_at":"2025-12-21T12:47:33.579339-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-8xx","title":"End-to-end test: acfs-update","description":"## What\nComprehensive testing of acfs-update:\n1. Test on fresh ACFS install (all tools present)\n2. Test on partial install (some tools missing)\n3. Test each category individually\n4. Test --dry-run mode\n5. Test --yes mode (non-interactive)\n6. Test failure handling (simulate failures)\n7. Test logging output\n\n## Test Scenarios\n- Fresh VPS with full ACFS install\n- Existing VPS with previous ACFS version\n- Missing tools (should skip gracefully)\n- Network failures (should report and continue)\n- Permission issues (should report and continue)\n\n## Considerations\n- Need a test VPS or Docker container\n- Some tests may need mocking (network failures)\n- Should test as both root and non-root user\n\n## Success Criteria\n- [ ] All categories update correctly\n- [ ] Dry-run shows accurate preview\n- [ ] Failures handled gracefully\n- [ ] Logs are comprehensive and useful\n- [ ] No regressions in existing functionality","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-21T13:27:10.04603-05:00","updated_at":"2025-12-21T15:38:12.190216-05:00","closed_at":"2025-12-21T15:38:12.190216-05:00","close_reason":"Created comprehensive Docker-based E2E test (tests/vm/test_acfs_update.sh) covering: --help, --dry-run, --quiet, --yes modes; category filters (--agents-only, --shell-only, --no-apt); log file creation; exit codes; missing tool handling; version display. Test follows same pattern as test_install_ubuntu.sh. Shellcheck clean.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-8xx","depends_on_id":"agentic_coding_flywheel_setup-csv","type":"blocks","created_at":"2025-12-21T13:27:35.23095-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-8z5","title":"Create report_skipped_tools() post-install summary","description":"# Task: Create report_skipped_tools() post-install summary\n\n## Context\nPart of EPIC: Checkpoint-Based Checksum Recovery (agentic_coding_flywheel_setup-tx7)\n\n## What to Do\nAfter installation completes, report any tools that were skipped:\n\n### Output\n```\n⚠ The following tools were skipped due to checksum mismatches:\n    → ntm: https://raw.githubusercontent.com/.../install.sh\n    → bv: https://raw.githubusercontent.com/.../install.sh\n\nYou can install these manually after verifying they are safe.\nOr wait for ACFS to update checksums and run: acfs update --stack\n```\n\n### Storage\n- SKIPPED_TOOLS array populated during install\n- Also saved to state.json for persistence\n\n## Acceptance Criteria\n- Only shown if SKIPPED_TOOLS is non-empty\n- Shows tool name and installer URL\n- Provides manual install command\n- Mentions acfs update as alternative\n\n## Files to Modify\n- install.sh: Add report at end of successful install","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T12:44:38.550459-05:00","updated_at":"2025-12-21T14:48:42.459331-05:00","closed_at":"2025-12-21T14:48:42.459331-05:00","close_reason":"Added comprehensive skipped tools reporting: record_skipped_tool() with reason and URL, report_skipped_tools() showing detailed summary with manual install commands and acfs update alternative, get_skipped_tools_json() for state persistence.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-8z5","depends_on_id":"agentic_coding_flywheel_setup-4jr","type":"blocks","created_at":"2025-12-21T12:47:33.367598-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-998","title":"Fix web build: commit missing Jargon component/dictionary","description":"apps/web/app/page.tsx imports @/components/jargon and @/lib/jargon but these files are missing from git (currently present only as untracked files). This breaks build/type-check/lint in a clean clone. Track the files, fix any lint/type issues, and ensure reduced-motion and keyboard accessibility are respected.","status":"closed","priority":1,"issue_type":"bug","assignee":"GreenDog","created_at":"2025-12-20T20:36:58.073784-05:00","updated_at":"2025-12-20T20:44:58.191838-05:00","closed_at":"2025-12-20T20:44:58.191838-05:00","close_reason":"Resolved on main: landing page + jargon component/dictionary now tracked and wired (see commit 1ef012c). Confirmed apps/web lint + type-check pass.","labels":["a11y","build","web"]}
{"id":"agentic_coding_flywheel_setup-9x2","title":"Wizard: Windows SSH key commands have broken backslashes","description":"apps/web/app/wizard/generate-ssh-key/page.tsx uses windowsCommand strings with single backslashes (e.g., /Users/jemanuel\\.ssh\\...), which are treated as JS escapes and drop the backslashes. Fix to use double-escaped backslashes so the copied command is valid on Windows.","status":"closed","priority":1,"issue_type":"bug","assignee":"FuchsiaCreek","created_at":"2025-12-20T14:03:29.105181-05:00","updated_at":"2025-12-20T14:04:03.163713-05:00","closed_at":"2025-12-20T14:04:03.163713-05:00","close_reason":"Fixed Windows command strings in generate-ssh-key step to properly escape backslashes (so copied commands use /Users/jemanuel\\.ssh\\... instead of dropping slashes)."}
{"id":"agentic_coding_flywheel_setup-9xt","title":"[ubu.1] Create ubuntu_upgrade.sh library","description":"# Create ubuntu_upgrade.sh Library\n\n## Purpose\nCore library implementing Ubuntu upgrade detection and execution logic.\n\n## File Location\n`scripts/lib/ubuntu_upgrade.sh`\n\n## Functions to Implement\n\n### Version Detection\n```bash\n# Get current Ubuntu version as comparable number (e.g., 2404 for 24.04)\nubuntu_get_version_number()\n\n# Get current Ubuntu version string (e.g., \"24.04\")\nubuntu_get_version_string()\n\n# Compare two version numbers (returns 0 if $1 \u003e= $2)\nubuntu_version_gte() { local v1=\"$1\" v2=\"$2\"; }\n```\n\n### Upgrade Path Calculation\n```bash\n# Get next available upgrade version (queries do-release-upgrade -c)\nubuntu_get_next_upgrade()\n\n# Calculate full upgrade path from current to target\n# Returns newline-separated list of versions\nubuntu_calculate_upgrade_path() { local target=\"$1\"; }\n\n# Get the latest available Ubuntu version\nubuntu_get_latest_available()\n```\n\n### Pre-upgrade Checks\n```bash\n# Run all pre-upgrade validations\n# Returns 0 if all checks pass, 1 with error details if not\nubuntu_preflight_checks()\n\n# Individual checks (called by ubuntu_preflight_checks)\nubuntu_check_disk_space()    # Need ~5GB free\nubuntu_check_network()       # Test connectivity\nubuntu_check_apt_state()     # No broken packages\nubuntu_check_not_docker()    # Upgrades don't work in containers\n```\n\n### Upgrade Execution\n```bash\n# Perform single-version upgrade\n# Returns 0 on success, 1 on failure\nubuntu_do_upgrade()\n\n# Prepare system before upgrade (apt update, dist-upgrade)\nubuntu_prepare_upgrade()\n\n# Setup resume mechanism for after reboot\nubuntu_setup_resume()\n\n# Cleanup resume mechanism after completion\nubuntu_cleanup_resume()\n```\n\n## Dependencies\n- Sources: logging.sh, os_detect.sh\n- External: do-release-upgrade, apt, lsb_release\n\n## Design Decisions\n\n### Why query do-release-upgrade instead of hardcoding?\nHardcoding version numbers (like \"25.10\") becomes stale. By querying\n`do-release-upgrade -c` (check mode), we always know the actual next\navailable upgrade. This future-proofs the code.\n\n### Why check disk space?\ndo-release-upgrade downloads hundreds of MB of packages and needs\nspace for temporary files. Running out of disk mid-upgrade is\ncatastrophic. We require 5GB free (conservative estimate).\n\n### Why not use unattended-upgrade?\nunattended-upgrade is for security patches within a version, not\nfor full distribution upgrades. do-release-upgrade is the official\ntool for version upgrades.\n\n## Testing Notes\n- Test on 22.04, 24.04, 24.10 base images\n- Verify upgrade path calculation is correct\n- Ensure preflight checks catch common issues","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T16:19:52.130051-05:00","updated_at":"2025-12-21T16:32:12.108731-05:00","closed_at":"2025-12-21T16:32:12.108731-05:00","close_reason":"Created ubuntu_upgrade.sh with all core functions: version detection, upgrade path calculation, preflight checks, and upgrade execution. All 20 functions implemented and tested."}
{"id":"agentic_coding_flywheel_setup-aa1","title":"Implement atomic state file writes","description":"# Task: Implement atomic state file writes\n\n## Context\nPart of EPIC: Phase-Granular Progress Persistence (agentic_coding_flywheel_setup-5uu)\n\n## Problem\nIf the system crashes or SSH disconnects DURING a state write, the state file could be corrupted (partial JSON). This would cause the installer to fail on resume.\n\n## Solution\nUse atomic write pattern: write to temp file, then mv (which is atomic on POSIX):\n\n```bash\nsave_state_atomic() {\n    local state_file=\"$ACFS_HOME/state.json\"\n    local temp_file\n    temp_file=\"$(mktemp)\"\n    \n    # Write to temp file\n    cat \u003e \"$temp_file\" \u003c\u003cEOF\n{...json...}\nEOF\n    \n    # Atomic move (rename is atomic on same filesystem)\n    mv \"$temp_file\" \"$state_file\"\n}\n```\n\n## Why This Matters\n- State file is the ONLY record of progress\n- Corrupted state = user loses all progress\n- This is a critical reliability feature\n\n## Acceptance Criteria\n- Write to temp file first, then mv\n- Temp file in same directory as target (ensures same filesystem)\n- Handle disk full errors gracefully\n- Test: interrupt mid-write, verify file is valid\n\n## Files to Modify\n- install.sh or scripts/lib/state.sh","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T12:49:57.530495-05:00","updated_at":"2025-12-21T14:40:05.332109-05:00","closed_at":"2025-12-21T14:40:05.332109-05:00","close_reason":"Enhanced state_write_atomic() with disk space pre-check, fsync for durability, robust temp file naming, and improved error codes (0=success, 1=disk error, 2=permission, 3=invalid args). All tests passing."}
{"id":"agentic_coding_flywheel_setup-afr","title":"Fix security verify TOCTOU + CommandCard storage sync","description":"Fix scripts/lib/security.sh verify_checksum to avoid double-fetch (TOCTOU) while preserving exact bytes; refactor apps/web/components/command-card.tsx to use shared userPreferences store for OS and a same-tab emitter for completion state (remove synthetic StorageEvent).","status":"closed","priority":1,"issue_type":"bug","assignee":"FuchsiaCreek","created_at":"2025-12-20T13:30:03.412412-05:00","updated_at":"2025-12-20T13:33:07.142143-05:00","closed_at":"2025-12-20T13:33:07.142143-05:00","close_reason":"Fixed scripts/lib/security.sh verify_checksum to avoid double-fetch (TOCTOU) while preserving trailing newlines; refactored apps/web/components/command-card.tsx to use userPreferences OS store and same-tab completion emitter."}
{"id":"agentic_coding_flywheel_setup-anq","title":"Modify verify_and_run() to use new checksum recovery flow","description":"# Task: Modify verify_and_run() to use new checksum recovery flow\n\n## Context\nPart of EPIC: Checkpoint-Based Checksum Recovery (agentic_coding_flywheel_setup-tx7)\n\n## Problem\nThe existing verify_and_run() in security.sh just aborts on mismatch. We have new handler logic but need to wire it in.\n\n## Current Code (security.sh ~line 143)\n```bash\nverify_checksum() {\n    # ... fetch and check ...\n    if [[ \"$actual\" != \"$expected\" ]]; then\n        log_error \"Checksum mismatch\"\n        return 1  # Just fails\n    fi\n}\n```\n\n## New Code\n```bash\nverify_checksum_with_recovery() {\n    # ... fetch and check ...\n    if [[ \"$actual\" != \"$expected\" ]]; then\n        handle_checksum_mismatch \"$name\" \"$expected\" \"$actual\" \"$url\"\n        local result=$?\n        case $result in\n            0) return 0 ;;  # Skip, continue\n            1) return 1 ;;  # Abort\n            2) ;;           # Proceed anyway (fall through)\n        esac\n    fi\n    # Execute\n}\n```\n\n## Acceptance Criteria\n- verify_and_run calls handle_checksum_mismatch on mismatch\n- Return codes handled correctly\n- Existing callers (fetch_and_run, etc.) updated\n- Tests verify all three paths work\n\n## Dependencies\nRequires: handle_checksum_mismatch() to exist\n\n## Files to Modify\n- scripts/lib/security.sh","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T12:50:39.231304-05:00","updated_at":"2025-12-21T15:01:21.489992-05:00","closed_at":"2025-12-21T15:01:21.489992-05:00","close_reason":"Verified implementation: handle_checksum_mismatch() (lines 623-714) and fetch_and_run_with_recovery() (lines 305-376) already implemented in security.sh. Functions handle P/S/A prompts, CRITICAL vs optional classification, batch mode via ACFS_BATCH_CHECKSUMS, non-interactive mode. Syntax validated.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-anq","depends_on_id":"agentic_coding_flywheel_setup-4jr","type":"blocks","created_at":"2025-12-21T12:51:29.074049-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-aqs","title":"Create run_deep_checks() with formatted output","description":"# Task: Create run_deep_checks() with formatted output\n\n## Context\nPart of EPIC: Enhanced Doctor with Functional Tests (agentic_coding_flywheel_setup-t9i)\n\n## What to Do\nCreate the main deep checks runner with proper formatting:\n\n### run_deep_checks() Function\n```bash\nrun_deep_checks() {\n    section \"Functional Tests (--deep)\"\n\n    check_with_status \"Claude Code auth\" check_claude_auth \\\n        \"Run: claude auth login\"\n\n    check_with_status \"Codex CLI auth\" check_codex_auth \\\n        \"Set OPENAI_API_KEY in ~/.zshrc.local\"\n\n    # ... more checks\n}\n```\n\n### check_with_status() Helper\nRuns check function and formats result:\n- Pass: ✔ green\n- Fail: ✖ red with fix hint\n- Skip: ○ gray \"Not installed\"\n- Info: ℹ blue \"Not configured (optional)\"\n\n### JSON Output\nWhen --json + --deep, include deep checks in JSON.\n\n## Acceptance Criteria\n- All deep checks run in sequence\n- Each check has status icon and fix hint\n- Summary: \"6/9 functional checks passed\"\n- JSON includes deep check results\n\n## Files to Modify\n- scripts/lib/doctor.sh","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T12:45:22.034393-05:00","updated_at":"2025-12-21T15:01:50.618634-05:00","closed_at":"2025-12-21T15:01:50.618634-05:00","close_reason":"Added deep checks summary counter and JSON output enhancement","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-aqs","depends_on_id":"agentic_coding_flywheel_setup-325","type":"blocks","created_at":"2025-12-21T12:47:35.31898-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-aqs","depends_on_id":"agentic_coding_flywheel_setup-azw","type":"blocks","created_at":"2025-12-21T12:47:35.503897-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-auf","title":"[ubu.3] Create systemd resume service","description":"# Create Systemd Resume Service\n\n## Purpose\nCreate a systemd service that runs after reboot to resume the upgrade process.\n\n## Files to Create\n\n### Service Template: scripts/templates/acfs-upgrade-resume.service\nStandard systemd oneshot service that:\n- Runs after network-online.target\n- Only runs if /var/lib/acfs/upgrade_state.json exists\n- Executes /var/lib/acfs/upgrade_resume.sh\n- Logs to journal\n\n### Resume Script: scripts/lib/upgrade_resume.sh\nScript that gets copied to /var/lib/acfs/ and runs after reboot:\n1. Sources required libraries from /var/lib/acfs/lib/\n2. Checks if more upgrades needed via state\n3. If complete: cleanup and launch continue_install.sh\n4. If not complete: run next upgrade and reboot\n\n## Service Lifecycle\n\n### Setup Phase (ubuntu_setup_resume)\n1. Create /var/lib/acfs/ directory structure\n2. Copy library files (logging.sh, ubuntu_upgrade.sh, state.sh)\n3. Copy upgrade_resume.sh script\n4. Generate continue_install.sh with original ACFS args\n5. Install systemd service file\n6. Enable service with systemctl\n\n### Cleanup Phase (ubuntu_cleanup_resume)  \n1. Disable systemd service\n2. Remove service file from /etc/systemd/system/\n3. Run systemctl daemon-reload\n4. Remove temporary files from /var/lib/acfs/\n5. Keep upgrade log for debugging\n\n## Why Systemd Over Cron @reboot?\n\n1. **Network ordering**: After=network-online.target ensures apt works\n2. **Reliability**: Systemd is the proper init system on Ubuntu\n3. **Observability**: journalctl -u acfs-upgrade-resume for debugging\n4. **Control**: Easy enable/disable without editing crontab\n\n## Security Notes\n\n- Service runs as root (required for apt and reboot)\n- All files in /var/lib/acfs/ are root-owned\n- Service self-removes after completion\n- No long-running privileged processes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T16:20:59.646625-05:00","updated_at":"2025-12-21T16:37:30.059458-05:00","closed_at":"2025-12-21T16:37:30.059458-05:00","close_reason":"Created systemd service template, upgrade_resume.sh script, MOTD update functions, and infrastructure setup/teardown functions. Full reboot-resume workflow implemented.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-auf","depends_on_id":"agentic_coding_flywheel_setup-9xt","type":"blocks","created_at":"2025-12-21T16:23:35.66045-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-auf","depends_on_id":"agentic_coding_flywheel_setup-2yd","type":"blocks","created_at":"2025-12-21T16:23:36.000091-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-axx","title":"Fix update flow + correct workspace fix hints","description":"- scripts/lib/update.sh currently exits on first failed update because run_cmd returns non-zero under set -e; should continue and summarize failures.\n- scripts/lib/doctor.sh + scripts/lib/smoke_test.sh suggest chowning /data (not /data/projects) which doesn't fix writability.","acceptance_criteria":"- acfs update continues running all update steps even if one fails; final exit code reflects FAIL_COUNT.\n- doctor/smoke_test workspace fix hints correctly chown /data/projects (and handle missing /etc/os-release without noisy errors).","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-20T14:16:52.910887-05:00","updated_at":"2025-12-20T14:25:29.646034-05:00","closed_at":"2025-12-20T14:25:29.646034-05:00","close_reason":"Fixed update.sh counter/return semantics; corrected doctor/smoke workspace fix hints; improved doctor OS handling + JSON escaping."}
{"id":"agentic_coding_flywheel_setup-azw","title":"Implement database and cloud CLI functional tests","description":"# Task: Implement database and cloud CLI functional tests\n\n## Context\nPart of EPIC: Enhanced Doctor with Functional Tests (agentic_coding_flywheel_setup-t9i)\n\n## What to Do\nCreate functional tests for databases and cloud CLIs:\n\n### PostgreSQL Tests\n- check_postgres_connection(): psql -c \"SELECT 1\"\n- check_postgres_role(): Verify ubuntu role exists\n\n### Cloud CLI Tests\n- check_vault_configured(): VAULT_ADDR set (info status if not)\n- check_wrangler_auth(): wrangler whoami\n- check_supabase_auth(): Access token exists and not expired\n- check_vercel_auth(): vercel whoami\n\n### Status Codes\n- 0: Pass\n- 1: Fail (with fix suggestion)\n- 2: Skip (not installed)\n- 3: Info (not configured, but optional)\n\n## Acceptance Criteria\n- Each cloud CLI has auth check\n- PostgreSQL connection and role verified\n- Status codes used consistently\n- Timeout on external calls (prevent hangs)\n\n## Files to Modify\n- scripts/lib/doctor.sh: Add cloud/db check functions","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T12:45:20.261596-05:00","updated_at":"2025-12-21T14:59:50.118089-05:00","closed_at":"2025-12-21T14:59:50.118089-05:00","close_reason":"Implemented check_postgres_connection(), check_postgres_role(), and enhanced cloud CLI checks","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-azw","depends_on_id":"agentic_coding_flywheel_setup-01s","type":"blocks","created_at":"2025-12-21T12:47:35.134842-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-bq3","title":"Ubuntu Auto-Upgrade Feature","description":"# Ubuntu Auto-Upgrade Feature\n\n## Overview\nAutomatically detect Ubuntu version and upgrade to the latest stable release (25.10) before running the main ACFS installation. The entire process should be **fully automated and non-interactive**.\n\n## Problem Statement\nMany cloud providers (OVH, Contabo, Hetzner) default to older Ubuntu versions (22.04, 24.04). ACFS works best on the latest Ubuntu, and some packages may not be available on older versions. Currently, ACFS just warns about old versions but doesn't help upgrade.\n\n## Solution\nAdd a pre-installation phase that:\n1. Detects current Ubuntu version\n2. Calculates upgrade path to target version\n3. Automatically performs sequential do-release-upgrade operations\n4. Handles reboots with automatic resume via systemd service\n5. Continues ACFS installation after reaching target version\n\n## Design Philosophy\n- **Fully automated**: No user interaction required once started\n- **Resilient**: Handle reboots, network issues, and failures gracefully\n- **Observable**: Comprehensive logging for debugging\n- **Opt-out available**: Users can skip with --skip-ubuntu-upgrade\n\n## Default Behavior\nWith the standard one-liner:\n```bash\ncurl -fsSL .../install.sh | bash -s -- --yes --mode vibe\n```\nThe installer will:\n1. Detect Ubuntu version\n2. If below 25.10, automatically upgrade (no prompts)\n3. Reboot as needed\n4. Resume and continue upgrading until at target\n5. Proceed with ACFS installation\n\n## Opt-out\n```bash\ncurl -fsSL .../install.sh | bash -s -- --yes --mode vibe --skip-ubuntu-upgrade\n```\n\n## Technical Constraints\n1. Ubuntu only allows upgrading to NEXT version (no skipping)\n   - 22.04 → 24.04 (LTS-to-LTS is special case)\n   - 24.04 → 24.10 → 25.04 → 25.10 (sequential)\n2. Each upgrade requires a reboot\n3. do-release-upgrade takes 30-60 minutes per version\n4. SSH sessions will disconnect during reboot (users must reconnect)\n5. Need systemd service for automatic resume after reboot\n\n## Success Criteria\n- [ ] Detects Ubuntu version accurately\n- [ ] Calculates correct upgrade path\n- [ ] Performs upgrade non-interactively\n- [ ] Creates systemd service for post-reboot resume\n- [ ] Chains multiple upgrades without manual intervention\n- [ ] Resumes ACFS installation after final upgrade\n- [ ] Cleans up systemd service after completion\n- [ ] Handles errors with clear logging\n- [ ] Works across SSH disconnection/reconnection","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-21T16:18:52.892435-05:00","updated_at":"2025-12-21T16:19:28.542304-05:00"}
{"id":"agentic_coding_flywheel_setup-c61","title":"Define session export JSON schema","description":"# Task: Define session export JSON schema\n\n## Context\nPart of EPIC: Agent Session Sharing and Replay (agentic_coding_flywheel_setup-0sb)\n\n## What to Do\nDesign the JSON schema for exported agent sessions.\n\n## Schema (inline in export code)\n\n```typescript\n// In scripts/lib/session.sh or equivalent\n// Schema documented here, not as separate file\n\ninterface SessionExport {\n    schema_version: 1;\n    exported_at: string;  // ISO8601\n    session_id: string;\n    agent: \"claude-code\" | \"codex\" | \"gemini\";\n    model: string;\n    summary: string;\n    duration_minutes: number;\n    stats: {\n        turns: number;\n        files_created: number;\n        files_modified: number;\n        commands_run: number;\n    };\n    outcomes: Array\u003c{\n        type: \"file_created\" | \"file_modified\" | \"command_run\";\n        path?: string;\n        description: string;\n    }\u003e;\n    key_prompts: string[];\n    sanitized_transcript: Array\u003c{\n        role: \"user\" | \"assistant\";\n        content: string;\n        timestamp: string;\n    }\u003e;\n}\n```\n\n## Key Design Decisions\n\n1. **Schema lives in code, not separate file**\n   - AGENTS.md: \"bar for adding files is very high\"\n   - Schema is simple enough to document inline\n   - TypeScript interface provides validation\n\n2. **Version field for evolution**\n   - `schema_version: 1` allows future changes\n   - Importers can handle version differences\n\n3. **Sanitization-aware**\n   - Fields designed for post-sanitization data\n   - No raw command outputs (may contain secrets)\n\n4. **Focused on value**\n   - `outcomes` shows what happened\n   - `key_prompts` shows how (for learning)\n   - Not a raw dump of everything\n\n## Validation\n```bash\nvalidate_session_export() {\n    local file=\"$1\"\n    \n    # Check required fields exist\n    jq -e \".schema_version and .session_id and .agent\" \"$file\" \u003e/dev/null || {\n        log_error \"Invalid session export: missing required fields\"\n        return 1\n    }\n    \n    # Check version\n    local version=$(jq -r \".schema_version\" \"$file\")\n    [[ \"$version\" == \"1\" ]] || {\n        log_warn \"Session version $version may not be fully compatible\"\n    }\n    \n    return 0\n}\n```\n\n## Acceptance Criteria\n- [ ] Schema defined as TypeScript interface (in code comments)\n- [ ] Validation function checks required fields\n- [ ] Version field present for future evolution\n- [ ] NO separate schema.json file\n- [ ] NO separate docs file (documented in bead + code)\n\n## Files to Modify (NOT create)\n- scripts/lib/session.sh - add validation and schema comments","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T12:46:36.450112-05:00","updated_at":"2025-12-21T15:40:24.438595-05:00","closed_at":"2025-12-21T15:40:24.438595-05:00","close_reason":"Created scripts/lib/session.sh with: (1) TypeScript interface as detailed code comments, (2) validate_session_export function checking required fields, (3) schema_version field for evolution, (4) helper functions for getting schema version/summary/agent. All acceptance criteria met."}
{"id":"agentic_coding_flywheel_setup-coj","title":"Create GitHub Action for daily checksum monitoring","description":"# Task: Create GitHub Action for daily checksum monitoring\n\n## Purpose\nAutomatically detect when upstream installer scripts change and create PRs to update checksums.\n\n## Critical Addition: Verify Stability Before PR\n\n**Problem:** Upstream scripts might change multiple times in a day during a release.\n**Solution:** Verify checksum is stable across 2 checks before creating PR.\n\n## Workflow Design\n\n```yaml\nname: Monitor Upstream Checksums\non:\n  schedule:\n    - cron: \"0 6 * * *\"   # 6 AM UTC daily\n    - cron: \"0 18 * * *\"  # 6 PM UTC daily (stability check)\n  workflow_dispatch:       # Manual trigger\n\njobs:\n  check-checksums:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      \n      - name: Fetch current checksums\n        id: current\n        run: |\n          ./scripts/lib/security.sh --verify --json \u003e current.json\n          \n      - name: Check for changes\n        id: changes\n        run: |\n          # Parse JSON output\n          changed=$(jq -r \".changed | length\" current.json)\n          echo \"changed_count=$changed\" \u003e\u003e $GITHUB_OUTPUT\n          \n          if [[ \"$changed\" -gt 0 ]]; then\n            echo \"changed=true\" \u003e\u003e $GITHUB_OUTPUT\n            jq -r \".changed[].name\" current.json \u003e changed_tools.txt\n          else\n            echo \"changed=false\" \u003e\u003e $GITHUB_OUTPUT\n          fi\n          \n      - name: Check stability (only if changes detected)\n        if: steps.changes.outputs.changed == true\n        id: stability\n        run: |\n          # Load previous run checksums from cache\n          if [[ -f \".checksum-cache/previous.json\" ]]; then\n            prev_checksums=$(jq -r \".checksums\" .checksum-cache/previous.json)\n            curr_checksums=$(jq -r \".checksums\" current.json)\n            \n            if [[ \"$prev_checksums\" == \"$curr_checksums\" ]]; then\n              echo \"stable=true\" \u003e\u003e $GITHUB_OUTPUT\n              echo \"Checksums stable across 2 runs - safe to PR\"\n            else\n              echo \"stable=false\" \u003e\u003e $GITHUB_OUTPUT\n              echo \"Checksums changed since last run - waiting for stability\"\n            fi\n          else\n            echo \"stable=false\" \u003e\u003e $GITHUB_OUTPUT\n            echo \"First run with changes - caching for stability check\"\n          fi\n          \n          # Cache current state\n          mkdir -p .checksum-cache\n          cp current.json .checksum-cache/previous.json\n          \n      - name: Update checksums file\n        if: steps.changes.outputs.changed == true \u0026\u0026 steps.stability.outputs.stable == true\n        run: |\n          ./scripts/lib/security.sh --update-checksums \u003e checksums.yaml\n          \n      - name: Create Pull Request\n        if: steps.changes.outputs.changed == true \u0026\u0026 steps.stability.outputs.stable == true\n        uses: peter-evans/create-pull-request@v5\n        with:\n          title: \"chore(security): update upstream checksums\"\n          body: |\n            ## Upstream Checksum Updates\n            \n            The following installer checksums have changed:\n            $(cat changed_tools.txt | sed \"s/^/- /\")\n            \n            ### Stability Verified\n            ✅ Checksums stable across 2 consecutive checks (12 hours apart)\n            \n            ### Action Required\n            Please review the upstream changes before merging:\n            $(cat changed_tools.txt | while read tool; do\n              url=$(jq -r \".installers.$tool.url\" checksums.yaml)\n              echo \"- [$tool]($url)\"\n            done)\n            \n            ---\n            🤖 Auto-generated by checksum monitoring workflow\n          branch: auto/update-checksums\n          labels: security, automated\n```\n\n## Stability Check Logic\n\n```\nRun 1 (6 AM): Detects bun checksum changed\n  → Cache new checksum\n  → No PR yet\n\nRun 2 (6 PM): Same bun checksum as cached\n  → Stable = true\n  → Create PR\n\nRun 2 (6 PM): Different bun checksum than cached  \n  → Stable = false\n  → Update cache\n  → Wait for next run\n```\n\n## Dependencies\n- Depends on: JSON output mode (agentic_coding_flywheel_setup-ss3)\n- Creates: Auto-generated PRs\n\n## Acceptance Criteria\n- [ ] Runs twice daily (12 hours apart)\n- [ ] Stability check requires 2 matching runs\n- [ ] Only creates PR when checksums are stable\n- [ ] PR body lists changed tools with links\n- [ ] Manual trigger available for testing","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T12:45:53.040595-05:00","updated_at":"2025-12-21T14:55:17.637256-05:00","closed_at":"2025-12-21T14:55:17.637256-05:00","close_reason":"GitHub Action workflow created for daily checksum monitoring with stability checking","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-coj","depends_on_id":"agentic_coding_flywheel_setup-ss3","type":"blocks","created_at":"2025-12-21T12:47:37.794807-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-csv","title":"Wire acfs-update into install.sh and PATH","description":"## What\nIntegrate acfs-update into the ACFS installation process:\n1. Copy acfs-update script to ~/.acfs/bin/\n2. Ensure ~/.acfs/bin is in PATH (already done via acfs.zshrc)\n3. Create 'acfs' wrapper script that supports subcommands (acfs update, acfs doctor, etc.)\n\n## Technical Details\n- Script lives at ~/.acfs/bin/acfs-update\n- May want 'acfs' wrapper: acfs update -\u003e acfs-update, acfs doctor -\u003e acfs-doctor\n- install.sh copies script during finalize phase\n- Script should be executable (chmod +x)\n\n## Considerations\n- Should we have acfs-update standalone or as 'acfs update' subcommand?\n- Subcommand approach is more elegant but requires wrapper script\n- For v1, standalone acfs-update is simpler\n\n## Decision\nv1: Standalone acfs-update script\nv2: Add 'acfs' wrapper with subcommands\n\n## Success Criteria\n- [ ] acfs-update installed to ~/.acfs/bin/\n- [ ] Executable and in PATH after install\n- [ ] Works immediately after fresh install","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:27:08.593655-05:00","updated_at":"2025-12-21T15:22:28.551425-05:00","closed_at":"2025-12-21T15:22:28.551425-05:00","close_reason":"Wired acfs-update into install.sh finalize phase with proper permissions and PATH linking","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-csv","depends_on_id":"agentic_coding_flywheel_setup-u5z","type":"blocks","created_at":"2025-12-21T13:27:34.053226-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-csv","depends_on_id":"agentic_coding_flywheel_setup-3mp","type":"blocks","created_at":"2025-12-21T13:27:34.225526-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-csv","depends_on_id":"agentic_coding_flywheel_setup-db0","type":"blocks","created_at":"2025-12-21T13:27:34.394293-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-csv","depends_on_id":"agentic_coding_flywheel_setup-hby","type":"blocks","created_at":"2025-12-21T13:27:34.559188-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-csv","depends_on_id":"agentic_coding_flywheel_setup-obi","type":"blocks","created_at":"2025-12-21T13:27:34.725276-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-csv","depends_on_id":"agentic_coding_flywheel_setup-3ht","type":"blocks","created_at":"2025-12-21T13:27:34.897036-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-csv","depends_on_id":"agentic_coding_flywheel_setup-pom","type":"blocks","created_at":"2025-12-21T13:27:35.061635-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-csv","depends_on_id":"agentic_coding_flywheel_setup-d0g","type":"blocks","created_at":"2025-12-21T13:32:19.749545-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-cxr","title":"[ubu.11] Implement error recovery and graceful degradation","description":"# Implement Error Recovery and Graceful Degradation\n\n## Purpose\nHandle upgrade failures gracefully and provide recovery paths. This is CRITICAL - a failed upgrade can leave the system in an unusable state.\n\n## Failure Modes and Recovery\n\n### 1. Network Failure During Package Download\n**Detection**: apt-get returns error 100 or timeout\n**Recovery**:\n```bash\nubuntu_retry_with_backoff() {\n  local cmd=\"$1\"\n  local max_retries=5\n  local delay=30\n  \n  for i in $(seq 1 $max_retries); do\n    if eval \"$cmd\"; then\n      return 0\n    fi\n    \n    log_warn \"Attempt $i failed, retrying in ${delay}s...\"\n    sleep $delay\n    delay=$((delay * 2))  # Exponential backoff\n  done\n  \n  return 1\n}\n```\n\n### 2. Disk Full During Upgrade\n**Detection**: apt-get returns ENOSPC error\n**Recovery**:\n```bash\nubuntu_emergency_cleanup() {\n  log_warn \"Attempting emergency disk cleanup...\"\n  \n  # Clear apt cache\n  apt-get clean\n  \n  # Remove old kernels (keep current + previous)\n  apt-get autoremove -y\n  \n  # Clear journal logs over 100MB\n  journalctl --vacuum-size=100M\n  \n  # Report remaining space\n  df -h / | tail -1\n}\n```\n\n### 3. Interrupted dpkg\n**Detection**: `/var/lib/dpkg/lock-frontend` exists, dpkg --configure fails\n**Recovery**:\n```bash\nubuntu_fix_dpkg() {\n  log_warn \"Fixing interrupted dpkg...\"\n  \n  # Wait for any running apt\n  while fuser /var/lib/dpkg/lock-frontend \u003e/dev/null 2\u003e\u00261; do\n    sleep 5\n  done\n  \n  # Configure any unpacked packages\n  dpkg --configure -a\n  \n  # Fix broken dependencies\n  apt-get -f install -y\n}\n```\n\n### 4. do-release-upgrade Failure\n**Detection**: do-release-upgrade returns non-zero\n**Recovery**:\n```bash\nubuntu_recover_upgrade() {\n  local error_code=\"$1\"\n  \n  case \"$error_code\" in\n    1)\n      # General failure - try fixing deps\n      apt-get -f install -y\n      apt-get dist-upgrade -y\n      ;;\n    *)\n      log_error \"do-release-upgrade failed with code $error_code\"\n      log_info \"Manual intervention may be required\"\n      ;;\n  esac\n}\n```\n\n### 5. Reboot Fails / System Does Not Come Back\n\n**Detection**: Cannot detect from same system\n**Mitigation**:\n- State file preserves progress\n- User can SSH back and check status\n- Resume service will restart upgrade\n\n**User Recovery**:\n```\nIf system fails to boot:\n1. Boot from recovery mode (hold SHIFT during boot)\n2. Select \"root shell\"\n3. Run: dpkg --configure -a \u0026\u0026 apt-get -f install\n4. Reboot normally\n```\n\n## Graceful Degradation\n\nIf upgrade cannot proceed, allow ACFS to continue on current version:\n\n```bash\nubuntu_upgrade_with_fallback() {\n  if \\! ubuntu_do_upgrade; then\n    log_error \"Ubuntu upgrade failed\"\n    \n    # Check if system is still functional\n    if apt-get update \u0026\u003e/dev/null; then\n      log_warn \"System is functional. Continuing ACFS on current Ubuntu version.\"\n      log_warn \"Some features may not work optimally.\"\n      \n      # Mark upgrade as skipped, not failed\n      state_upgrade_skip \"upgrade_failed_graceful_degradation\"\n      \n      # Continue with ACFS installation\n      return 0\n    else\n      log_error \"System may be in inconsistent state. Manual recovery needed.\"\n      return 1\n    fi\n  fi\n}\n```\n\n## Error Logging\n\nAll errors should be logged with context:\n```bash\nubuntu_log_error() {\n  local component=\"$1\"\n  local message=\"$2\"\n  local timestamp=$(date -Iseconds)\n  \n  echo \"[$timestamp] ERROR [$component] $message\" \u003e\u003e /var/log/acfs/upgrade.log\n  \n  # Also save to state for resume debugging\n  state_upgrade_set_error \"$component: $message\"\n}\n```\n\n## Post-Failure Diagnostics\n\nCreate diagnostic dump on failure:\n```bash\nubuntu_create_diagnostic_dump() {\n  local dump_file=\"/var/log/acfs/upgrade_diagnostic_$(date +%Y%m%d_%H%M%S).txt\"\n  \n  {\n    echo \"=== ACFS Upgrade Diagnostic Dump ===\"\n    echo \"Timestamp: $(date)\"\n    echo \"\"\n    echo \"=== Ubuntu Version ===\"\n    cat /etc/os-release\n    echo \"\"\n    echo \"=== Disk Space ===\"\n    df -h\n    echo \"\"\n    echo \"=== Memory ===\"\n    free -h\n    echo \"\"\n    echo \"=== dpkg Status ===\"\n    dpkg --audit\n    echo \"\"\n    echo \"=== APT History (last 50 lines) ===\"\n    tail -50 /var/log/apt/history.log\n    echo \"\"\n    echo \"=== ACFS State ===\"\n    cat /var/lib/acfs/upgrade_state.json 2\u003e/dev/null || echo \"No state file\"\n    echo \"\"\n    echo \"=== Last 100 lines of upgrade log ===\"\n    tail -100 /var/log/acfs/upgrade.log 2\u003e/dev/null || echo \"No upgrade log\"\n  } \u003e \"$dump_file\"\n  \n  log_info \"Diagnostic dump saved to: $dump_file\"\n}\n```\n\n## Priority: P1 (Critical)\n\nThis task is P1 because error handling is what separates a robust tool from a fragile script. Users will encounter failures - the question is whether they can recover.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T16:25:49.431838-05:00","updated_at":"2025-12-21T16:42:00.726784-05:00","closed_at":"2025-12-21T16:42:00.726784-05:00","close_reason":"Added error recovery functions: ubuntu_retry_with_backoff, ubuntu_emergency_cleanup, ubuntu_fix_dpkg, ubuntu_recover_failed_upgrade, ubuntu_create_diagnostic_dump, ubuntu_upgrade_with_fallback for graceful degradation.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-cxr","depends_on_id":"agentic_coding_flywheel_setup-0ge","type":"blocks","created_at":"2025-12-21T16:26:42.710018-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-d09","title":"Handle corrupted or incompatible state files","description":"# Task: Handle corrupted or incompatible state files\n\n## Context\nPart of EPIC: Phase-Granular Progress Persistence (agentic_coding_flywheel_setup-5uu)\n\n## Scenarios to Handle\n\n### 1. Corrupted JSON\n```bash\n# User has: {\"completed_phases\": [1, 2, 3 (truncated)\n# Expected: Detect, warn, offer to start fresh\n```\n\n### 2. Schema v1 (old format)\n```bash\n# User has: {\"installed_at\": \"...\", \"version\": \"0.1.0\"}\n# Expected: Migrate to v2, preserve what we can\n```\n\n### 3. Future schema (v3+)\n```bash\n# User downgraded ACFS but has newer state\n# Expected: Warn about version mismatch, offer fresh start\n```\n\n### 4. Missing required fields\n```bash\n# User has: {} or {\"foo\": \"bar\"}\n# Expected: Treat as invalid, offer fresh start\n```\n\n## Implementation\n```bash\nvalidate_state() {\n    # Check JSON syntax\n    # Check schema_version field\n    # Check required fields exist\n    # Return 0 if valid, 1 if should start fresh\n}\n```\n\n## Acceptance Criteria\n- Invalid JSON detected and handled\n- Version mismatch detected and handled\n- User prompted before discarding state\n- Clear log message for debugging\n\n## Files to Modify\n- install.sh or scripts/lib/state.sh","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T12:49:58.931984-05:00","updated_at":"2025-12-21T14:45:41.787522-05:00","closed_at":"2025-12-21T14:45:41.787522-05:00","close_reason":"Added state_validate(), state_handle_invalid(), state_backup_and_remove(), state_ensure_valid() to scripts/lib/state.sh. Handles corrupted JSON, missing fields, future schema, and v1 migration.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-d09","depends_on_id":"agentic_coding_flywheel_setup-uxc","type":"blocks","created_at":"2025-12-21T12:51:28.609593-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-d0g","title":"Implement Dicklesworthstone stack updates (checksum-aware)","description":"## What\nImplement the 'stack' category for acfs-update with SECURE checksum verification.\n\nTools to update:\n- NTM (Named Tmux Manager)\n- MCP Agent Mail\n- UBS (Ultimate Bug Scanner)\n- BV (Beads Viewer)\n- CASS (Coding Agent Session Search)\n- CM (CASS Memory System)\n- CAAM (Coding Agent Account Manager)\n- SLB (Simultaneous Launch Button)\n- BD (Beads CLI) - the task tracker itself\n\n## SECURITY: Checksum-Aware Update Flow\nUnlike the \"bypass checksums\" approach, we MUST verify checksums to prevent executing compromised scripts:\n\n1. Check if tool is installed (binary exists)\n2. If not installed: skip (acfs-update doesn't install new tools)\n3. If installed:\n   a. Fetch installer script from GitHub\n   b. Calculate SHA256 checksum\n   c. Compare to checksums.yaml:\n      - MATCH: Run installer safely (known-good script)\n      - MISMATCH: Script changed upstream. Options:\n        * Show warning with URL to review changes\n        * If --yes: proceed (user accepts risk)\n        * If interactive: prompt [S]kip / [P]roceed / [V]iew diff\n        * Default: Skip and continue with other tools\n\n## Why This Matters\nBypassing checksums would allow an attacker who compromises a GitHub repo to execute arbitrary code on all users who run `acfs-update`. The tradeoff of prompting on upstream changes is worth the security.\n\n## Special Cases\n- MCP Agent Mail: git pull + uv sync in ~/mcp_agent_mail (no installer re-run)\n- BD (Beads): Check where installed, use appropriate update method\n\n## Success Criteria\n- [ ] All 9 stack tools update correctly\n- [ ] Checksum verification works\n- [ ] User prompted on checksum mismatch (unless --yes)\n- [ ] MCP Agent Mail git+uv flow works\n- [ ] Skips uninstalled tools\n- [ ] Version changes logged","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:32:07.801083-05:00","updated_at":"2025-12-21T15:13:32.430411-05:00","closed_at":"2025-12-21T15:13:32.430411-05:00","close_reason":"Already implemented in scripts/lib/update.sh:update_stack() with checksum verification via update_run_verified_installer for all 8 stack tools","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-d0g","depends_on_id":"agentic_coding_flywheel_setup-75e","type":"blocks","created_at":"2025-12-21T13:32:19.582864-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-d7c","title":"[ubu.8] Update documentation and README","description":"# Update Documentation and README\n\n## Purpose\nDocument the Ubuntu auto-upgrade feature for users and developers.\n\n## README.md Updates\n\nAdd new section covering:\n- Ubuntu version requirements (25.x target)\n- Automatic upgrade behavior description\n- Expected timeline (1-3 hours for full upgrade chain)\n- SSH reconnection notes\n- How to skip with --skip-ubuntu-upgrade\n- How to monitor upgrade progress via logs\n\n## AGENTS.md Updates\n\nAdd OS requirements to Third-Party Tools section noting auto-upgrade behavior.\n\n## Developer Documentation\n\nCreate docs/ubuntu-upgrade.md covering:\n- Architecture overview\n- State machine diagram\n- File locations during upgrade\n- Debugging failed upgrades\n- Manual recovery steps\n\n## Changelog Entry\n\nAdd entry for automatic Ubuntu upgrade feature with all new flags.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T16:23:16.303897-05:00","updated_at":"2025-12-21T16:23:16.303897-05:00","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-d7c","depends_on_id":"agentic_coding_flywheel_setup-dwh","type":"blocks","created_at":"2025-12-21T16:23:37.273514-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-db0","title":"Implement shell tool updates (omz, p10k, plugins, atuin, zoxide)","description":"## What\nImplement the 'shell' category for acfs-update:\n- Oh-My-Zsh: Run $ZSH/tools/upgrade.sh (non-interactive)\n- Powerlevel10k: git pull --ff-only in $ZSH_CUSTOM/themes/powerlevel10k\n- zsh-autosuggestions: git pull --ff-only in plugin dir\n- zsh-syntax-highlighting: git pull --ff-only in plugin dir\n- Atuin: Use atuin self-update if available, else reinstall\n- Zoxide: Reinstall via official installer\n\n## Git-Based Updates (omz, p10k, plugins)\n- Use git pull --ff-only to avoid merge conflicts\n- If fast-forward fails: warn and skip (user has local changes)\n- OMZ has its own upgrade script that handles prompts\n\n## Installer-Based Updates (Atuin, Zoxide)\nThese use curl|sh installers like the stack tools:\n1. Atuin: Try `atuin self-update` first (if available)\n   - If no self-update: fetch installer, verify checksum, run\n2. Zoxide: Fetch installer, verify checksum against checksums.yaml, run\n\nFor checksum mismatches: same flow as stack tools (warn, prompt, skip/proceed)\n\n## Considerations\n- ZSH_CUSTOM defaults to $ZSH/custom if not set\n- DISABLE_UPDATE_PROMPT=true for OMZ non-interactive\n- Some users may have customized themes/plugins - respect that\n\n## Success Criteria\n- [ ] All shell tools update without prompts (in --yes mode)\n- [ ] Git-based updates handle conflicts gracefully\n- [ ] Atuin/Zoxide checksum verification works\n- [ ] Before/after versions logged\n- [ ] Skips missing components","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:26:10.463809-05:00","updated_at":"2025-12-21T15:18:10.575757-05:00","closed_at":"2025-12-21T15:18:10.575757-05:00","close_reason":"Implemented shell tool updates: omz, p10k, zsh plugins, atuin, zoxide","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-db0","depends_on_id":"agentic_coding_flywheel_setup-75e","type":"blocks","created_at":"2025-12-21T13:27:25.018434-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-dcy","title":"[codex.8] Audit web app for incorrect codex auth guidance","description":"## Goal\nCheck apps/web/ for any incorrect guidance about codex-cli authentication.\n\n## Files to Check\nBased on grep results:\n- apps/web/lib/jargon.ts\n- apps/web/app/wizard/run-installer/page.tsx\n- apps/web/lib/flywheel.ts\n- apps/web/app/workflow/page.tsx\n- apps/web/app/page.tsx\n\n## What to Look For\n1. Any mention of OPENAI_API_KEY for codex\n2. Incorrect auth flow descriptions\n3. Wizard steps that suggest API key setup\n\n## Updates Needed\n1. Replace API key guidance with OAuth flow description\n2. Update any wizard steps about codex setup\n3. Ensure jargon/definitions are correct\n\n## Lower Priority Because\nThe web app is less critical than the installer scripts - users who hit the web app will eventually run the installer which (after fixes) will give correct guidance.\n\n## Acceptance Criteria\n1. No incorrect OPENAI_API_KEY references for codex in web app\n2. Correct OAuth flow described if mentioned","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T16:26:24.840054-05:00","updated_at":"2025-12-21T16:26:24.840054-05:00","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-dcy","depends_on_id":"agentic_coding_flywheel_setup-ua5","type":"blocks","created_at":"2025-12-21T16:26:36.94908-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-dfc","title":"Fix wizard layout heading causing mobile E2E failures","description":"Playwright mobile projects fail because WizardLayout renders a hidden (md:block) \u003ch1\u003e step title before page content. Tests use page.locator('h1').first(), which resolves to the hidden layout heading on mobile. Also results in multiple h1s per page. Fix by removing or demoting layout heading, ensuring a single visible h1 per wizard page, and update tests if needed.","status":"closed","priority":1,"issue_type":"bug","assignee":"GreenDog","created_at":"2025-12-20T21:03:08.330927-05:00","updated_at":"2025-12-20T21:30:35.67678-05:00","closed_at":"2025-12-20T21:30:35.67678-05:00","close_reason":"Already fixed on main: apps/web/app/wizard/layout.tsx no longer renders a hidden \u003ch1\u003e step title; only the step indicator remains, so mobile h1 selector mismatch is resolved.","labels":["a11y","ci","e2e","web"]}
{"id":"agentic_coding_flywheel_setup-dvt","title":"EPIC: Comprehensive unit coverage (no mocks) + E2E logging","description":"# Goal\nEstablish real-data, no-mock unit coverage and complete E2E integration scripts with detailed, human-readable logging.\n\n# Why\n- Current tests are partial (installer E2E + web Playwright). No full unit coverage across core Bash libs or manifest tooling.\n- E2E logs exist but are not standardized or granular enough for fast diagnosis.\n\n# Success Criteria\n- Unit coverage exists for manifest parser/generator, selection resolver, contract/security/preflight libs with real fixtures (no mocks/fakes).\n- E2E scripts cover bootstrap + selection + resume flows with structured logs and artifacts.\n- Tests are deterministic, diffable, and runnable locally + in CI.\n\n# Notes\n- \"No mocks/fakes\" means: use real manifests, real generated scripts, real flags; avoid stubbing core behaviors.\n- Logging should be timestamped, sectioned, and include command echo + exit codes.\n","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-21T16:25:13.75871-05:00","updated_at":"2025-12-21T16:25:13.75871-05:00","labels":["qa","tests"]}
{"id":"agentic_coding_flywheel_setup-dvt.1","title":"Define coverage matrix + real fixtures catalog","description":"# Scope\nCreate a concrete coverage matrix that maps each core component to a test type, and standardize a catalog of **real** fixtures used by unit tests.\n\n# Deliverables\n- Coverage matrix table (component → test type → owner → status).\n- Fixture catalog list (real manifest YAMLs, generated scripts, seed state files) with storage location and usage notes.\n\n# Detailed comments\n- Components to include: `packages/manifest` (schema/parser/generator), `scripts/lib` (install_helpers, contract, security, preflight, logging), `install.sh` selection/introspection, `tests/vm` E2E.\n- Fixtures must be real (valid YAMLs and generated outputs), not synthetic mocks.\n- Ensure fixtures are minimal but realistic; avoid brittle snapshots.\n\n# Acceptance criteria\n- Matrix is stored in repo (likely `docs/tests/coverage_matrix.md`).\n- Fixture catalog references actual files committed in repo.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T16:25:21.951298-05:00","updated_at":"2025-12-21T16:25:21.951298-05:00","labels":["qa","tests"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-dvt.1","depends_on_id":"agentic_coding_flywheel_setup-dvt","type":"parent-child","created_at":"2025-12-21T16:25:21.953283-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-dvt.2","title":"Unit tests: manifest parser/generator using real fixtures","description":"# Scope\nAdd unit tests for `packages/manifest` (schema, parser, dependency resolution, generator outputs) using real YAML fixtures.\n\n# Detailed comments\n- Use real `acfs.manifest.yaml` plus a curated set of small, valid fixtures (no mocks).\n- Cover schema validation (new fields), dependency closure, cycle detection, and deterministic module ordering.\n- Validate generated `manifest_index.sh` content matches fixture expectations (IDs, phases, deps, defaults).\n\n# Acceptance criteria\n- Tests run via `bun test` (or existing harness) with real fixtures.\n- Failures are actionable (clear assertions and output).\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T16:25:28.350421-05:00","updated_at":"2025-12-21T16:25:28.350421-05:00","labels":["manifest","tests"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-dvt.2","depends_on_id":"agentic_coding_flywheel_setup-dvt","type":"parent-child","created_at":"2025-12-21T16:25:28.352603-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-dvt.2","depends_on_id":"agentic_coding_flywheel_setup-dvt.1","type":"blocks","created_at":"2025-12-21T16:26:03.792033-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-dvt.3","title":"Unit tests: installer libs (selection/contract/security/preflight)","description":"# Scope\nAdd unit tests for core bash libs in `scripts/lib` using real scripts and fixtures.\n\n# Detailed comments\n- Selection: exercise `acfs_resolve_selection` with real `manifest_index.sh` and real CLI-style arrays (no stubs).\n- Contract: verify `acfs_require_contract` errors and required env function checks.\n- Security: verify checksum loading + verify mode outputs without mocking network (use local fixture URLs / file:// if needed).\n- Preflight: run against a local container or controlled env where checks are real and deterministic.\n\n# Acceptance criteria\n- Tests are runnable locally (shell-based harness or bats/shellspec only if approved), and outputs are clear.\n- No fake implementations of the core logic; use real scripts + fixtures.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T16:25:35.797864-05:00","updated_at":"2025-12-21T16:25:35.797864-05:00","labels":["installer","tests"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-dvt.3","depends_on_id":"agentic_coding_flywheel_setup-dvt","type":"parent-child","created_at":"2025-12-21T16:25:35.800903-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-dvt.3","depends_on_id":"agentic_coding_flywheel_setup-dvt.1","type":"blocks","created_at":"2025-12-21T16:26:07.886827-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-dvt.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.5.4","type":"blocks","created_at":"2025-12-21T16:26:10.852357-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-dvt.4","title":"E2E logging harness for tests/vm (timestamps, sections, artifacts)","description":"# Scope\nStandardize and enhance logging for `tests/vm` scripts so integration runs are diagnosable and diffable.\n\n# Detailed comments\n- Create a shared logging helper (timestamped sections, command echo, exit codes, duration).\n- Capture installer logs and key artifacts (state.json, log files) per run.\n- Ensure logs go to stderr with clean stdout for machine parsing.\n\n# Acceptance criteria\n- `tests/vm/test_install_ubuntu.sh` and `tests/vm/test_acfs_update.sh` use the harness.\n- Log output includes clear phase headers and final summary block.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T16:25:42.721475-05:00","updated_at":"2025-12-21T16:25:42.721475-05:00","labels":["e2e","logging","tests"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-dvt.4","depends_on_id":"agentic_coding_flywheel_setup-dvt","type":"parent-child","created_at":"2025-12-21T16:25:42.72327-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-dvt.4","depends_on_id":"agentic_coding_flywheel_setup-dvt.1","type":"blocks","created_at":"2025-12-21T16:26:14.703717-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-dvt.5","title":"E2E: installer bootstrap + selection + resume coverage","description":"# Scope\nExpand integration coverage for installer flows using **real** scripts and flags.\n\n# Detailed comments\n- Cover curl|bash bootstrap path, offline simulation, and manifest index integrity checks.\n- Cover selection flags: `--only`, `--only-phase`, `--skip`, `--no-deps`, `--print-plan` with expected outputs.\n- Cover resume/state flows across interruptions and version mismatches.\n- Ensure tests verify deterministic plan ordering from `manifest_index.sh`.\n\n# Acceptance criteria\n- E2E scripts exercise all selection semantics (including error cases).\n- Logs clearly show plan generation and any skip/dependency errors.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T16:25:49.542767-05:00","updated_at":"2025-12-21T16:25:49.542767-05:00","labels":["e2e","installer","tests"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-dvt.5","depends_on_id":"agentic_coding_flywheel_setup-dvt","type":"parent-child","created_at":"2025-12-21T16:25:49.545206-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-dvt.5","depends_on_id":"agentic_coding_flywheel_setup-dvt.4","type":"blocks","created_at":"2025-12-21T16:26:19.575552-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-dvt.5","depends_on_id":"agentic_coding_flywheel_setup-mjt.6.1","type":"blocks","created_at":"2025-12-21T16:26:23.595295-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-dvt.5","depends_on_id":"agentic_coding_flywheel_setup-mjt.6.2","type":"blocks","created_at":"2025-12-21T16:26:26.640828-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-dvt.5","depends_on_id":"agentic_coding_flywheel_setup-mjt.5.4","type":"blocks","created_at":"2025-12-21T16:26:29.794687-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-dvt.6","title":"E2E: web wizard runner script with detailed logs/artifacts","description":"# Scope\nCreate a repeatable E2E runner for `apps/web` Playwright tests with richer logs and artifacts.\n\n# Detailed comments\n- Provide a script that boots `bun run dev` (or preview build) and runs Playwright with retries.\n- Capture screenshots/videos/traces per failure with clear file names.\n- Emit structured, timestamped logs summarizing pass/fail by step.\n\n# Acceptance criteria\n- One command runs the full wizard E2E suite and outputs a concise summary.\n- Artifacts are stored in a predictable folder for CI upload.\n","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T16:25:56.782071-05:00","updated_at":"2025-12-21T16:25:56.782071-05:00","labels":["e2e","tests","web"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-dvt.6","depends_on_id":"agentic_coding_flywheel_setup-dvt","type":"parent-child","created_at":"2025-12-21T16:25:56.785025-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-dvt.6","depends_on_id":"agentic_coding_flywheel_setup-dvt.1","type":"blocks","created_at":"2025-12-21T16:26:34.528541-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-dwh","title":"[ubu.7] Add upgrade tests and validation","description":"# Add Upgrade Tests and Validation\n\n## Purpose\nCreate tests to validate upgrade functionality works correctly across different scenarios.\n\n## Test Scenarios\n\n### Unit Tests (scripts/tests/ubuntu_upgrade_test.sh)\n\n1. **Version Detection**\n   - Parse various /etc/os-release formats\n   - Handle missing VERSION_ID gracefully\n   - Convert versions to comparable numbers correctly\n\n2. **Upgrade Path Calculation**\n   - 24.04 → 25.10: should return [24.10, 25.04, 25.10]\n   - 25.04 → 25.10: should return [25.10]\n   - 25.10 → 25.10: should return [] (no upgrade needed)\n   - 22.04 → 25.10: should handle LTS hop (22.04 → 24.04 → ...)\n\n3. **Preflight Checks**\n   - Mock insufficient disk space\n   - Mock Docker environment\n   - Mock broken apt state\n   - Mock network failure\n\n### Integration Tests (Docker-based)\n\nFor each base version (22.04, 24.04, 24.10):\n\n1. **Detection Test**\n   - Start container with base version\n   - Run version detection\n   - Verify correct version reported\n\n2. **Path Calculation Test**\n   - Verify upgrade path is calculated correctly\n   - Test with different target versions\n\n3. **Preflight Test**\n   - Verify all checks run\n   - Verify container detection works (should block upgrade)\n\n### Manual Testing Checklist\n\nFull upgrade tests require actual VMs (not containers):\n\n- [ ] Fresh 24.04 LTS → 25.10: Full chain upgrade\n- [ ] Fresh 24.10 → 25.10: Partial chain upgrade\n- [ ] Resume after reboot works correctly\n- [ ] State persists across reboots\n- [ ] Systemd service cleans up properly\n- [ ] ACFS installation continues after upgrade\n- [ ] SSH reconnection works (user can reconnect)\n- [ ] Logs are comprehensive and useful\n\n### CI Considerations\n\nFull upgrade tests cannot run in CI (take hours, need real VMs).\nCI should run:\n- Unit tests (fast)\n- Container-based detection tests (fast)\n- Preflight check tests (fast)\n\nReal upgrade testing is manual QA before releases.\n\n## Test Utilities\n\n### Mock Functions for Unit Tests\n```bash\n# Override version detection for testing\n_test_set_os_version() {\n  export _TEST_OS_VERSION=\"$1\"\n}\n\n# Override do-release-upgrade check mode\n_test_set_next_upgrade() {\n  export _TEST_NEXT_UPGRADE=\"$1\"\n}\n```\n\n### Test Runner\n```bash\n#\\!/usr/bin/env bash\n# scripts/tests/run_upgrade_tests.sh\n\nsource scripts/lib/ubuntu_upgrade.sh\nsource scripts/tests/ubuntu_upgrade_test.sh\n\nrun_unit_tests\necho \"Unit tests: $(count_passed)/$(count_total) passed\"\n```\n\n## Validation Script\n\nCreate validation script for manual QA:\n```bash\n#\\!/usr/bin/env bash\n# scripts/validate_upgrade.sh\n\necho \"=== ACFS Ubuntu Upgrade Validation ===\"\necho \"\"\n\n# Version checks\necho \"1. Version Detection:\"\nubuntu_get_version_string \u0026\u0026 echo \"   OK: $(ubuntu_get_version_string)\"\n\n# Path calculation\necho \"2. Upgrade Path to 25.10:\"\nubuntu_calculate_upgrade_path \"25.10\"\n\n# Preflight summary\necho \"3. Preflight Checks:\"\nubuntu_preflight_checks \u0026\u0026 echo \"   All checks passed\" || echo \"   Some checks failed\"\n\n# State check\necho \"4. Upgrade State:\"\nstate_upgrade_get_stage || echo \"   No upgrade in progress\"\n\necho \"\"\necho \"Validation complete.\"\n```","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T16:22:37.270301-05:00","updated_at":"2025-12-21T16:22:37.270301-05:00","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-dwh","depends_on_id":"agentic_coding_flywheel_setup-nb4","type":"blocks","created_at":"2025-12-21T16:23:37.074079-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-e88","title":"Create monorepo directory structure","description":"# Task: Create Monorepo Directory Structure\n\n## Description\nSet up the complete directory structure as specified in AGENTS.md:\n- apps/web/ - Next.js 16 wizard website\n- packages/manifest/ - Manifest parser and generators\n- packages/installer/ - Installer helper scripts\n- packages/onboard/ - Onboard TUI source\n- acfs/ - Config files copied to ~/.acfs on VPS\n- scripts/lib/ - Installer library functions\n- scripts/providers/ - VPS provider guides\n- scripts/sync/ - Sync scripts for vendored content\n- tests/vm/ - VM-based installer tests\n\n## Technical Details\n- Use bun workspaces for packages\n- Ensure proper .gitkeep files for empty dirs\n- Add appropriate README.md in each major directory\n\n## Reasoning\nA clear, well-documented structure helps both humans and AI agents navigate the codebase efficiently. The structure is designed to separate concerns:\n- Website is in apps/ (deployable to Vercel)\n- Reusable packages in packages/\n- VPS-side configs in acfs/\n- Build/install tooling in scripts/\n\n## Acceptance Criteria\n- [ ] All directories created per AGENTS.md\n- [ ] README.md in each major directory explaining its purpose\n- [ ] .gitkeep in empty directories\n\n## Considerations\n- Don't create files that aren't needed yet\n- Structure should be obvious to someone new to the project","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:20:23.040049-05:00","updated_at":"2025-12-19T23:24:12.559741-05:00","closed_at":"2025-12-19T23:24:12.559741-05:00","close_reason":"Monorepo directory structure created: apps/web, packages/{installer,manifest,onboard}","labels":["infrastructure","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-e88","depends_on_id":"agentic_coding_flywheel_setup-fac","type":"blocks","created_at":"2025-12-19T22:20:23.041903-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-eli","title":"Research CASS session data format and API","description":"# Task: Research CASS session data format and API\n\n## Context\nPart of EPIC: Agent Session Sharing and Replay (agentic_coding_flywheel_setup-0sb)\n\n## Why This Comes First\nBefore we can export sessions, we need to understand how CASS stores them:\n- What format is the session data?\n- What commands does CASS expose?\n- What fields are available for export?\n- Are there multiple session types (Claude vs Codex vs Gemini)?\n\n## Research Questions\n1. Run 'cass --help' and document available commands\n2. Run 'cass list' and examine output format\n3. Run 'cass get \u003csession_id\u003e --json' and examine structure\n4. Check if CASS stores sessions per-agent or unified\n5. Identify what data is NOT stored (we can't export what doesn't exist)\n\n## Deliverables\n- Document CASS CLI commands and their output\n- Example session data structure\n- List of exportable fields\n- Any limitations or gaps discovered\n\n## Acceptance Criteria\n- CASS API documented\n- Session format understood\n- Export schema can be designed based on actual data\n- Gaps identified for follow-up\n\n## Notes\nThis is research, not implementation. Output is documentation that informs subsequent tasks.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T12:51:13.705596-05:00","updated_at":"2025-12-21T15:52:01.46799-05:00","closed_at":"2025-12-21T15:52:01.46799-05:00","close_reason":"Research complete. Documented CASS session format, CLI commands, search/export APIs, session storage locations, and identified 7 limitations. Created docs/cass-session-format-research.md."}
{"id":"agentic_coding_flywheel_setup-epc","title":"[codex.1] Fix doctor.sh codex auth detection","description":"## Goal\nUpdate scripts/lib/doctor.sh to correctly detect codex-cli authentication via OAuth tokens instead of checking for OPENAI_API_KEY.\n\n## Current (Incorrect) Behavior\nThe check_codex_auth() function currently:\n1. Checks for OPENAI_API_KEY environment variable\n2. Looks for OPENAI_API_KEY in ~/.zshrc.local\n3. Looks for OPENAI_API_KEY in /data/projects/.envrc\n4. Reports \"pass\" if any of these exist\n\n## Correct Behavior\nShould instead:\n1. Check for ~/.codex/auth.json (or similar OAuth token file)\n2. Optionally verify the token isn't expired\n3. Report \"pass\" if OAuth credentials exist\n4. Suggest running \"codex auth\" if not authenticated\n\n## Technical Notes\n- Need to verify the actual path where codex-cli stores OAuth tokens\n- The token file location may vary by OS/version\n- Common locations: ~/.codex/, ~/.config/codex/, ~/.local/share/codex/\n\n## Files to Modify\n- scripts/lib/doctor.sh: Update check_codex_auth() function\n\n## Acceptance Criteria\n1. No mention of OPENAI_API_KEY in codex auth check\n2. Correctly detects OAuth authentication\n3. Provides helpful guidance for unauthenticated users\n4. Regenerate scripts/generated/doctor_checks.sh after changes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T16:25:35.325519-05:00","updated_at":"2025-12-21T16:37:13.931458-05:00","closed_at":"2025-12-21T16:37:13.931458-05:00","close_reason":"Fixed check_codex_auth to detect OAuth tokens in ~/.codex/auth.json instead of checking OPENAI_API_KEY env var. Also cleaned up redundant shell redirects.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-epc","depends_on_id":"agentic_coding_flywheel_setup-ua5","type":"blocks","created_at":"2025-12-21T16:26:35.68967-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-epc","depends_on_id":"agentic_coding_flywheel_setup-wy1","type":"blocks","created_at":"2025-12-21T16:26:37.126029-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-fac","title":"EPIC: Project Foundation \u0026 Infrastructure","description":"# Epic: Project Foundation \u0026 Infrastructure\n\n## Overview\nSet up the foundational infrastructure for the ACFS project, including repo structure, tooling, and development environment.\n\n## Background \u0026 Reasoning\nBefore any feature development can begin, we need a solid foundation:\n- Proper monorepo structure for website + installer + onboard\n- Consistent tooling (bun, TypeScript, linting)\n- CI/CD pipeline for quality gates\n- Documentation standards\n\n## Success Criteria\n- [ ] All directory structure matches AGENTS.md spec\n- [ ] bun workspace configured properly\n- [ ] CI runs on every PR\n- [ ] shellcheck passes on all bash scripts\n\n## Dependencies\nNone - this is the foundation\n\n## Considerations\n- Keep structure minimal initially, add complexity only when needed\n- Prefer convention over configuration\n- Make it easy for agents to understand and navigate\n\n## Relationship to Project Goals\nThis enables all subsequent development by providing a consistent, well-documented codebase structure that both humans and AI agents can work with effectively.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:19:59.763401-05:00","updated_at":"2025-12-19T23:24:12.701537-05:00","closed_at":"2025-12-19T23:24:12.701537-05:00","close_reason":"Foundation complete: directory structure, install.sh, library scripts, configs all created","labels":["epic","infrastructure"]}
{"id":"agentic_coding_flywheel_setup-fed","title":"EPIC: Module Manifest System","description":"# Epic: Module Manifest System\n\n## Overview\nCreate the module manifest system (acfs.manifest.yaml) that serves as single source of truth for all installed tools.\n\n## Background \u0026 Reasoning\nWithout a manifest, we'd have:\n- Scattered install logic\n- No way to generate doctor checks automatically\n- Website and installer out of sync\n- Hard to add/update tools\n\nThe manifest provides:\n- Canonical list of all tools\n- Install commands\n- Verify commands\n- Dependencies between modules\n- Metadata for website display\n\n## Manifest Structure\n\n```yaml\nversion: 1\nname: agentic_coding_flywheel_setup\nid: acfs\n\ndefaults:\n  user: ubuntu\n  workspace_root: /data/projects\n  mode: vibe\n\nmodules:\n  - id: stack.ntm\n    description: Named tmux manager (agent cockpit)\n    category: stack\n    priority: 1\n    install:\n      - curl -fsSL https://... | bash\n    verify:\n      - ntm --help\n    aliases:\n      - ntm\n    docs_url: https://github.com/Dicklesworthstone/ntm\n```\n\n## Generated Outputs\n1. **Website**: Tools checklist on status page\n2. **Installer**: Module installation scripts\n3. **Doctor**: Check definitions with IDs\n4. **Documentation**: Auto-generated tool reference\n\n## Success Criteria\n- [ ] Complete manifest covering all 40+ tools\n- [ ] Parser library in packages/manifest\n- [ ] Generator for website content\n- [ ] Generator for installer modules\n- [ ] Generator for doctor checks\n- [ ] CI validates manifest syntax\n\n## Considerations\n- Keep YAML human-readable\n- Use consistent IDs across the project\n- Document the schema thoroughly\n- Version the manifest format","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-19T22:21:39.336054-05:00","updated_at":"2025-12-20T12:55:29.319623-05:00","closed_at":"2025-12-20T12:55:29.319623-05:00","close_reason":"EPIC COMPLETE: All 3 children closed. Created manifest system with acfs.manifest.yaml, TypeScript parser library, and installer generator producing 13 scripts.","labels":["epic","manifest"]}
{"id":"agentic_coding_flywheel_setup-fed.1","title":"Create acfs.manifest.yaml with all modules","description":"# Task: Create Complete Module Manifest\n\n## Description\nCreate the canonical manifest file with all 40+ tool definitions.\n\n## File: acfs.manifest.yaml\n\n## Structure\n\n```yaml\nversion: 1\nname: agentic_coding_flywheel_setup\nid: acfs\n\ndefaults:\n  user: ubuntu\n  workspace_root: /data/projects\n  mode: vibe\n  \ncategories:\n  - id: base\n    name: System Fundamentals\n    priority: 1\n  - id: shell\n    name: Shell Environment\n    priority: 2\n  # ... etc\n\nmodules:\n  # Base system\n  - id: base.curl\n    description: HTTP client\n    category: base\n    install: [sudo apt-get install -y curl]\n    verify: [curl --version]\n    \n  # ... 40+ modules\n```\n\n## Module Categories\n\n1. **base** - System packages (curl, git, jq, etc.)\n2. **users** - User/permissions setup\n3. **shell** - zsh, oh-my-zsh, plugins, theme\n4. **cli** - Modern CLI tools (lsd, bat, fzf, etc.)\n5. **lang** - Language runtimes (bun, uv, rust, go)\n6. **tools** - Dev tools (atuin, tmux, ast-grep)\n7. **db** - Databases (postgres18)\n8. **cloud** - Cloud CLIs (vault, wrangler, supabase, vercel)\n9. **agents** - Coding agents (claude, codex, gemini)\n10. **stack** - Dicklesworthstone tools (8 tools)\n\n## Each Module Contains\n- id: Stable identifier\n- description: Short description\n- category: Category reference\n- install: List of install commands\n- verify: List of verify commands\n- aliases: Optional shell aliases\n- docs_url: Documentation link\n- dependencies: Other module IDs\n\n## Acceptance Criteria\n- [ ] All 40+ modules defined\n- [ ] Valid YAML syntax\n- [ ] All verify commands documented\n- [ ] Dependencies specified\n- [ ] Categories organized logically","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:26:11.851933-05:00","updated_at":"2025-12-20T12:11:00.620729-05:00","closed_at":"2025-12-20T12:11:00.620729-05:00","close_reason":"acfs.manifest.yaml exists with 287 lines covering all tools","labels":["manifest","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-fed.1","depends_on_id":"agentic_coding_flywheel_setup-fed","type":"parent-child","created_at":"2025-12-19T22:26:11.853698-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-fed.2","title":"Build manifest parser library (packages/manifest)","description":"# Task: Build Manifest Parser Library\n\n## Description\nCreate a TypeScript library to parse and work with acfs.manifest.yaml.\n\n## Location\n`packages/manifest/`\n\n## Exports\n\n```typescript\n// Parse manifest\nexport function parseManifest(yamlPath: string): Manifest;\n\n// Types\nexport interface Manifest {\n  version: number;\n  name: string;\n  id: string;\n  defaults: ManifestDefaults;\n  categories: Category[];\n  modules: Module[];\n}\n\nexport interface Module {\n  id: string;\n  description: string;\n  category: string;\n  install: string[];\n  verify: string[];\n  aliases?: string[];\n  docs_url?: string;\n  dependencies?: string[];\n}\n\n// Utilities\nexport function getModulesByCategory(manifest: Manifest, category: string): Module[];\nexport function getModuleDependencies(manifest: Manifest, moduleId: string): Module[];\nexport function validateManifest(manifest: Manifest): ValidationResult;\n```\n\n## Features\n- YAML parsing with proper error messages\n- Schema validation\n- Dependency cycle detection\n- Type-safe access\n\n## Dependencies\n- yaml (parsing)\n- zod (validation)\n\n## Acceptance Criteria\n- [ ] Parses valid manifest\n- [ ] Rejects invalid manifest with clear errors\n- [ ] Type definitions exported\n- [ ] Utilities work correctly\n- [ ] Unit tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:26:23.533183-05:00","updated_at":"2025-12-20T12:52:26.631736-05:00","closed_at":"2025-12-20T12:52:26.631736-05:00","close_reason":"Completed manifest parser library with types, schema, parser, utils, and exports. All tests pass.","labels":["manifest","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-fed.2","depends_on_id":"agentic_coding_flywheel_setup-fed","type":"parent-child","created_at":"2025-12-19T22:26:23.53483-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-fed.3","title":"Create manifest-to-installer generator","description":"# Task: Manifest-to-Installer Generator\n\n## Description\nGenerate installer module scripts from acfs.manifest.yaml.\n\n## Purpose\nThe manifest is the single source of truth. The installer shouldn't\nduplicate this information - it should be generated.\n\n## What It Generates\n\n### For each module category, generate:\n```bash\n# scripts/generated/install_\u003ccategory\u003e.sh\n# Auto-generated from acfs.manifest.yaml - DO NOT EDIT\n\ninstall_base() {\n    log_step \"Installing base.curl\"\n    sudo apt-get install -y curl\n    verify \"curl --version\"\n    \n    log_step \"Installing base.git\"\n    # ... etc\n}\n```\n\n### For doctor checks:\n```bash\n# scripts/generated/doctor_checks.sh\nCHECKS=(\n    \"identity.user_is_ubuntu|Logged in as ubuntu|[[ \\$(whoami) == 'ubuntu' ]]\"\n    # ... etc\n)\n```\n\n## Implementation\n- packages/manifest/generate.ts\n- Reads acfs.manifest.yaml\n- Outputs to scripts/generated/\n\n## CI Integration\n- Run generator on manifest changes\n- Fail if generated files differ (ensure they're committed)\n\n## Acceptance Criteria\n- [ ] Generator script works\n- [ ] Installer modules generated\n- [ ] Doctor checks generated\n- [ ] CI validates generated files","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:38:38.206152-05:00","updated_at":"2025-12-20T12:55:41.728724-05:00","closed_at":"2025-12-20T12:55:41.728724-05:00","close_reason":"Generator working: 11 category installers + doctor_checks.sh + install_all.sh generated from manifest","labels":["manifest","task"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-fed.3","depends_on_id":"agentic_coding_flywheel_setup-fed","type":"parent-child","created_at":"2025-12-19T22:38:38.208032-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-fkf","title":"EPIC: Per-Phase Error Reporting","description":"# Epic: Per-Phase Error Reporting\n\n## Overview\nReplace generic 'installation failed' with structured error reports showing exactly which phase/step failed and how to fix it.\n\n## Problem Statement\nWhen installation fails, users see only 'ACFS installation failed' with no indication of which phase (1-10), what step, what the error was, or how to fix it.\n\n## Business Impact\n- Users can self-diagnose (reduces support burden)\n- 'Phase 6' is actionable; 'failed' is not\n- Most failures have known fixes (network, rate limits, deps)\n\n## Technical Approach\n1. Add CURRENT_PHASE, CURRENT_STEP, LAST_ERROR globals\n2. Create try_step() wrapper for individual operations\n3. Build ERROR_PATTERNS map with known fixes\n4. Create report_failure() with structured output\n5. Log JSON failure report for programmatic use\n\n## Success Criteria\n- Failure reports show phase number, step name, error excerpt\n- Suggested fixes shown for common error patterns\n- Full log path and resume command included\n- JSON structured log for tooling\n\n## Dependencies\n- Depends on: EPIC: Phase-Granular Progress Persistence (for state tracking)\n\n## Files to Modify\n- install.sh: Error tracking, try_step wrapper, report_failure\n- scripts/lib/errors.sh (new): Error patterns database\n\n## Reference\nSee: docs/ROADMAP_INSTALLER_RELIABILITY.md Section 3","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-21T12:40:42.022477-05:00","updated_at":"2025-12-21T15:03:47.660701-05:00","closed_at":"2025-12-21T15:03:47.660701-05:00","close_reason":"All child tasks closed: qqo (error_tracking.sh with try_step), 5zm (report.sh with report_failure), vwv (errors.sh with ERROR_PATTERNS), 7q1 (98 try_step calls in install.sh). Per-phase error reporting fully implemented.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-fkf","depends_on_id":"agentic_coding_flywheel_setup-5uu","type":"blocks","created_at":"2025-12-21T12:47:31.562865-05:00","created_by":"daemon"}],"comments":[{"id":3,"issue_id":"agentic_coding_flywheel_setup-fkf","author":"jemanuel","text":"FYI: created `agentic_coding_flywheel_setup-mjt` (Manifest-Driven Installer Integration). This work will refactor `install.sh` to source generated installers + manifest_index and will touch selection semantics (`--only/--skip/--print-plan`) and curl|bash bootstrap (single archive).\n\nPlease keep this epic’s work compatible with your scope:\n- orchestration/state/error-reporting/preflight remains install.sh + scripts/lib owned\n- generated scripts stay source-safe (no top-level side effects)","created_at":"2025-12-21T18:50:07Z"}]}
{"id":"agentic_coding_flywheel_setup-g29","title":"Fix shellcheck + typecheck for generator outputs","description":"ShellCheck and TS type-check were failing due to generator using import.meta.path, and generated scripts triggering SC1091/SC2034. Fix generator, logging shim, and generated scripts so CI passes.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-20T13:05:22.156507-05:00","updated_at":"2025-12-20T13:05:58.659374-05:00","closed_at":"2025-12-20T13:05:58.659374-05:00","close_reason":"Fix generator type errors + make generated scripts ShellCheck-clean (SC1091/SC2034)","labels":["ci","manifest"]}
{"id":"agentic_coding_flywheel_setup-hao","title":"[codex.3] Document OpenAI account types distinction","description":"## Goal\nAdd clear documentation explaining the difference between OpenAI API accounts and ChatGPT accounts.\n\n## Why This Matters\nMany users are confused because OpenAI has TWO distinct account/auth systems:\n\n### 1. OpenAI API Account\n- **Purpose**: Programmatic API access (for developers building apps)\n- **Auth**: OPENAI_API_KEY environment variable\n- **Billing**: Pay-per-token, separate API billing\n- **Where**: platform.openai.com\n- **What uses it**: OpenAI SDK, custom applications\n- **NOT used by**: codex-cli\n\n### 2. ChatGPT Account (Pro/Plus/Teams)\n- **Purpose**: Consumer chat interface and coding tools\n- **Auth**: OAuth via web browser (email/password or SSO)\n- **Billing**: Monthly subscription\n- **Where**: chat.openai.com\n- **What uses it**: ChatGPT website, codex-cli, mobile app\n- **Used by**: codex-cli!\n\n## Documentation to Create/Update\n1. Add section to README.md or create docs/agent-auth.md\n2. Update acfs/onboard/lessons/04_agents_login.md with clarification\n3. Consider adding to wizard website (apps/web/)\n\n## Key Points to Document\n1. codex-cli uses ChatGPT account, NOT API key\n2. No OPENAI_API_KEY needed for codex-cli\n3. Authentication flow: run \"codex auth\" → browser opens → login → done\n4. May need to enable device access in ChatGPT settings\n5. caam can backup/restore codex credentials just like claude/gemini\n\n## Acceptance Criteria\n1. Clear explanation of the two account types\n2. Explicit statement that codex-cli uses ChatGPT, not API\n3. Step-by-step auth guide for codex-cli\n4. Reference to ChatGPT security settings if needed","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-21T16:25:37.395114-05:00","updated_at":"2025-12-21T16:42:19.003942-05:00","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-hao","depends_on_id":"agentic_coding_flywheel_setup-ua5","type":"blocks","created_at":"2025-12-21T16:26:36.053709-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-hby","title":"Implement AI agent updates (claude, codex, gemini)","description":"## What\nImplement the 'agents' category for acfs-update:\n- Claude Code: claude update (built-in) or reinstall via official installer\n- Codex CLI: bun update -g @openai/codex\n- Gemini CLI: bun update -g @google/gemini-cli\n\n## Technical Details\n- Claude Code has native update: ~/.local/bin/claude update\n- If claude update fails, fall back to reinstall via installer\n- Codex/Gemini are bun global packages - simple bun update\n\n## Considerations\n- Claude update may require re-authentication after major updates\n- Codex/Gemini updates are quick (just npm package updates)\n- Must use target user's bun, not root's\n\n## Success Criteria\n- [ ] All agents update correctly\n- [ ] Fallback to reinstall works for Claude\n- [ ] Version changes logged\n- [ ] Authentication state preserved where possible","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:26:12.067763-05:00","updated_at":"2025-12-21T15:14:53.146714-05:00","closed_at":"2025-12-21T15:14:53.146714-05:00","close_reason":"Implemented version tracking for all agents, Claude update fallback to reinstall","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-hby","depends_on_id":"agentic_coding_flywheel_setup-75e","type":"blocks","created_at":"2025-12-21T13:27:25.187073-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-hi7","title":"Review misc_coding_agent_tips_and_scripts and integrate relevant automation","description":"## Goal\nReview `https://github.com/Dicklesworthstone/misc_coding_agent_tips_and_scripts` (ignore the moonlight tip) and fold the best practices into ACFS in a way that is:\n- automated where safe (installer defaults / ~/.acfs assets)\n- documented where automation isn’t appropriate\n\n## Scope ideas (examples)\n- shell ergonomics that help agent workflows\n- git safety patterns (non-destructive defaults, guardrails)\n- tmux/terminal workflows\n\n## Constraints\n- Do not add “file sprawl”; integrate into existing modules/assets when possible.\n- Do not introduce external-contributor posture.\n\n## Deliverables\n- A short decision log of what was adopted vs rejected (and why).\n- Concrete changes in installer/assets/docs where appropriate.\n\n## Acceptance criteria\n- At least 3 high-value tips integrated (excluding moonlight).\n- No breaking changes to default install flow.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T14:53:24.838062-05:00","updated_at":"2025-12-21T15:43:50.225994-05:00","closed_at":"2025-12-21T15:43:50.225994-05:00","close_reason":"Integrated 2 high-value tips: (1) Git Safety Guard Hook - Python PreToolUse hook blocking destructive git/filesystem commands, (2) PATH Conflict Detection - doctor.sh now warns about bun/npm shadowing native Claude installs. Rejected: Beads guide (already integrated), Moonlight (excluded), Claude install fix (already handled by acfs.zshrc PATH ordering).","labels":["agents","docs","installer","ux"]}
{"id":"agentic_coding_flywheel_setup-hii","title":"Create VERSION file and version management","description":"# Task: Create VERSION File and Version Management\n\n## Description\nSet up version management for ACFS releases.\n\n## VERSION File\nRoot of repo: `VERSION`\n```\n0.1.0\n```\n\n## Version Format\nSemantic versioning: MAJOR.MINOR.PATCH\n- MAJOR: Breaking changes to installer\n- MINOR: New features\n- PATCH: Bug fixes\n\n## Version Usage\n\n### In installer\n```bash\nACFS_VERSION=$(curl -fsSL .../VERSION)\n```\n\n### In acfs doctor\n```\nACFS Doctor v0.1.0\n```\n\n### In website\nShow version in footer\n\n### In manifest\n```yaml\nversion: 1\nacfs_version: 0.1.0\n```\n\n## Release Process\n1. Update VERSION file\n2. Update CHANGELOG.md\n3. Tag release: `git tag v0.1.0`\n4. Push: `git push --tags`\n\n## Acceptance Criteria\n- [ ] VERSION file created\n- [ ] All components read version correctly\n- [ ] Version shown in doctor output\n- [ ] Version shown on website","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:27:50.115466-05:00","updated_at":"2025-12-20T12:10:59.74241-05:00","closed_at":"2025-12-20T12:10:59.74241-05:00","close_reason":"VERSION file exists with 0.1.0","labels":["infrastructure","task"]}
{"id":"agentic_coding_flywheel_setup-itb","title":"[ubu.12] Add snapshot recommendation and safety warnings","description":"# Add Snapshot Recommendation and Safety Warnings\n\n## Purpose\nOS upgrades are one-way operations. Users should be clearly warned and encouraged to snapshot before proceeding.\n\n## Pre-Upgrade Warning Message\n\nDisplay before starting any upgrade:\n```bash\nubuntu_show_upgrade_warning() {\n  local current=$(ubuntu_get_version_string)\n  local target=\"$TARGET_UBUNTU_VERSION\"\n  local path=$(ubuntu_calculate_upgrade_path \"$target\")\n  local hops=$(echo \"$path\" | wc -w)\n  local estimated_time=$((hops * 45))\n  \n  cat \u003c\u003cEOF\n\n╔══════════════════════════════════════════════════════════════════╗\n║           ACFS Ubuntu Upgrade - READ CAREFULLY                   ║\n╠══════════════════════════════════════════════════════════════════╣\n║                                                                  ║\n║  Current version:  Ubuntu $current                              ║\n║  Target version:   Ubuntu $target                               ║\n║  Upgrade path:     $path                                        ║\n║  Estimated time:   ~${estimated_time} minutes                   ║\n║                                                                  ║\n╠══════════════════════════════════════════════════════════════════╣\n║  ⚠️  IMPORTANT:                                                  ║\n║                                                                  ║\n║  • OS upgrades CANNOT be undone                                  ║\n║  • System will reboot $hops time(s)                              ║\n║  • SSH sessions will disconnect during reboots                   ║\n║  • Reconnect after each reboot to monitor progress               ║\n║                                                                  ║\n╠══════════════════════════════════════════════════════════════════╣\n║  🔒 RECOMMENDED: Take a snapshot BEFORE proceeding               ║\n║                                                                  ║\n║  Most cloud providers support snapshots:                         ║\n║  • Hetzner:  Cloud Console → Snapshots                          ║\n║  • OVH:      Control Panel → VPS → Snapshot                     ║\n║  • Contabo:  Customer Panel → Snapshots                         ║\n║  • AWS:      EC2 → Snapshots → Create Snapshot                  ║\n║  • DigitalOcean: Droplets → Snapshots                           ║\n║                                                                  ║\n╚══════════════════════════════════════════════════════════════════╝\n\nEOF\n}\n```\n\n## Provider-Specific Snapshot Instructions\n\nCreate quick-reference file for common providers:\n```bash\n# Included in /var/lib/acfs/snapshot_instructions.txt\n\n## Hetzner Cloud\n1. Log into cloud.hetzner.com\n2. Select your server\n3. Click \"Snapshots\" in the sidebar\n4. Click \"Create Snapshot\"\n5. Wait for completion (usually 1-5 minutes)\n\n## OVH VPS\n1. Log into ovh.com control panel\n2. Navigate to your VPS\n3. Click \"Snapshot\" in the menu\n4. Click \"Take a snapshot\"\n\n## Contabo\n1. Log into my.contabo.com\n2. Select your VPS\n3. Go to \"Snapshots\"\n4. Click \"Create Snapshot\"\n\n## AWS EC2\n1. Open EC2 Console\n2. Select your instance\n3. Actions → Image and templates → Create image\n4. Or use: aws ec2 create-snapshot --volume-id \u003cvol-id\u003e\n\n## DigitalOcean\n1. Open Droplets dashboard\n2. Click on your Droplet\n3. Go to \"Snapshots\" tab\n4. Click \"Take Snapshot\"\n```\n\n## Confirmation for Interactive Mode\n\nFor users not using --yes:\n```bash\nubuntu_confirm_upgrade() {\n  if [[ \"$YES_MODE\" == \"true\" ]]; then\n    log_info \"Auto-confirmed (--yes mode)\"\n    return 0\n  fi\n  \n  ubuntu_show_upgrade_warning\n  \n  echo \"\"\n  echo \"Have you taken a snapshot? (Recommended but not required)\"\n  echo \"\"\n  \n  read -p \"Proceed with Ubuntu upgrade? [y/N] \" response\n  if [[ ! \"$response\" =~ ^[Yy] ]]; then\n    log_info \"Upgrade cancelled by user\"\n    return 1\n  fi\n  \n  return 0\n}\n```\n\n## Non-Interactive Mode\n\nWhen running with --yes, still show warning but proceed:\n```bash\n# In --yes mode, warning is informational only\nubuntu_show_upgrade_warning\nlog_warn \"Proceeding automatically (--yes mode)\"\nlog_warn \"If you need to abort, press Ctrl+C within 10 seconds\"\nsleep 10\n```\n\n## Rollback Information\n\nProvide clear guidance that there is NO rollback:\n```bash\nubuntu_explain_no_rollback() {\n  cat \u003c\u003cEOF\n\nNOTE: Ubuntu upgrades cannot be rolled back.\n\nIf the upgrade fails or causes issues:\n1. If you have a snapshot: Restore it\n2. If not: Manual troubleshooting required\n   - Run: dpkg --configure -a\n   - Run: apt-get -f install\n   - Check: /var/log/acfs/upgrade.log for errors\n\nFor catastrophic failures:\n1. Boot from recovery mode\n2. Or reinstall from scratch (snapshot recommended!)\n\nEOF\n}\n```\n\n## Why This Matters\n\nMany users:\n- Are on cheap VPS with no automatic backups\n- Do not realize OS upgrades are destructive\n- Cannot easily recover if something goes wrong\n\nClear communication reduces support burden and user frustration.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T16:26:29.252775-05:00","updated_at":"2025-12-21T16:41:59.623985-05:00","closed_at":"2025-12-21T16:41:59.623985-05:00","close_reason":"Added ubuntu_show_upgrade_warning with snapshot instructions for common cloud providers, ubuntu_confirm_upgrade for interactive confirmation.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-itb","depends_on_id":"agentic_coding_flywheel_setup-lhe","type":"blocks","created_at":"2025-12-21T16:26:42.902845-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-ixt","title":"Fix set -e crash in onboard status progress bar","description":"`onboard status` used `seq 1 0` in command substitution under `set -euo pipefail`, which can cause the script to exit when progress is 0. Replace with safe loops; also make common counter increments `+= 1` so scripts remain safe when sourced under set -e.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-20T15:04:33.527609-05:00","updated_at":"2025-12-20T15:07:15.994218-05:00","closed_at":"2025-12-20T15:07:15.994218-05:00","close_reason":"Fix onboard status progress bar set -e crash (seq 1 0) by using safe loops; also swap remaining ++ counters to += 1 for set -e safety.","labels":["onboard","reliability"]}
{"id":"agentic_coding_flywheel_setup-kgf","title":"Update README with new features documentation","description":"# Task: Update README with new features documentation\n\n## Context\nAll epics need user-facing documentation in the existing README.\n\n## Features to Document\n\n### 1. Resume Capability\n- Explain that install now resumes automatically\n- --force-reinstall flag for fresh install\n- Silent resume by default (no prompts)\n\n### 2. Pre-Flight Check\n- Optional `./scripts/preflight.sh` command\n- What it checks (disk, memory, network, apt locks)\n- How to interpret pass/warn/fail output\n\n### 3. Better Error Messages\n- Explain structured error output format\n- Where to find logs\n- Common fixes in ERROR_PATTERNS\n\n### 4. Checksum Recovery\n- Batched mismatch handling\n- CRITICAL vs RECOMMENDED tool behavior\n- Manual install for skipped tools\n\n### 5. Enhanced Doctor\n- `acfs doctor --deep` flag\n- What functional tests check (auth, databases)\n- Intentional skip vs missing tool distinction\n\n## Sections to Update (NOT add new)\n- Quick Install → mention resume behavior\n- Troubleshooting → error patterns, preflight\n- Doctor section → --deep flag, output format\n\n## What NOT to Add\n- Contributing section (AGENTS.md: \"Remove any mention of contributing/contributors\")\n- Separate new sections for each feature (integrate into existing)\n\n## Acceptance Criteria\n- [ ] All new features documented\n- [ ] Examples provided\n- [ ] Integrated into existing sections\n- [ ] No new \"Contributing\" section\n- [ ] Concise - users should READ the README, not skim it\n\n## Files to Modify\n- README.md (only)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T12:51:56.158321-05:00","updated_at":"2025-12-21T15:10:06.802722-05:00","closed_at":"2025-12-21T15:10:06.802722-05:00","close_reason":"Documented resume capability, pre-flight check, and doctor --deep in README","comments":[{"id":6,"issue_id":"agentic_coding_flywheel_setup-kgf","author":"jemanuel","text":"Heads up: manifest-driven installer epic  will add new user-facing flags () and recommend curl|bash installs pin to tags/SHA via archive bootstrap. Coordinate README edits with this.","created_at":"2025-12-21T18:50:08Z"},{"id":7,"issue_id":"agentic_coding_flywheel_setup-kgf","author":"jemanuel","text":"Heads up: manifest-driven installer epic agentic_coding_flywheel_setup-mjt will add user-facing flags (--only/--skip/--print-plan) and recommend curl|bash installs pin to tags/SHA via archive bootstrap. Coordinate README edits with this.","created_at":"2025-12-21T18:50:34Z"}]}
{"id":"agentic_coding_flywheel_setup-kgf.1","title":"Add Mermaid architecture diagram to README","description":"## Goal\nAdd a GitHub-rendering Mermaid diagram to `README.md` that explains ACFS at a glance.\n\n## Diagram requirements\n- Must render on github.com (```mermaid fenced block).\n- Show the major components and how they connect:\n  - `apps/web` (Next.js wizard; no backend; state via URL/localStorage)\n  - `install.sh` orchestrator\n  - `scripts/lib/*` shared libs (logging/security/state/etc)\n  - `acfs.manifest.yaml` (single source of truth)\n  - `packages/manifest` generator (produces `scripts/generated/*`)\n  - `scripts/generated/*` (module installers + `manifest_index` + doctor checks)\n  - `acfs/` assets copied to `~/.acfs/`\n  - `acfs doctor` (current + future generated checks)\n\n## Acceptance criteria\n- `README.md` includes the diagram in an existing section (no new big section sprawl).\n- Diagram matches the real flow: manifest → generator → generated scripts, and `install.sh` sources libs + generated scripts.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T14:52:45.373642-05:00","updated_at":"2025-12-21T15:11:13.68329-05:00","closed_at":"2025-12-21T15:11:13.68329-05:00","close_reason":"Already implemented - comprehensive Mermaid architecture diagram exists at README.md lines 126-190 (One-Page System Data Flow) covering all requested components: apps/web, install.sh, scripts/lib/*, acfs.manifest.yaml, packages/manifest, scripts/generated/*, acfs/, and acfs doctor","labels":["docs","readme","ux"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-kgf.1","depends_on_id":"agentic_coding_flywheel_setup-kgf","type":"parent-child","created_at":"2025-12-21T14:52:45.379171-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-kgf.2","title":"Document Vault secrets posture (install + usage)","description":"## Goal\nDocument that ACFS includes HashiCorp Vault for secrets management, and explain the intended “default beginner” posture vs advanced usage.\n\n## Why\n- Users need a consistent story for secrets (agent keys, DB creds, API tokens).\n- Vault is listed as part of the stack; README should make it explicit and non-confusing.\n\n## Scope\n- README only (integrate into existing sections).\n- Clarify whether Vault is installed by default vs opt-in.\n- Link the idea of “secrets management” to the broader ACFS goals (reproducible infra + agent workflow).\n\n## Acceptance criteria\n- README explicitly mentions Vault as the recommended secrets tool.\n- README clarifies installation default (enabled-by-default vs opt-in) and how to verify it’s present.\n- README avoids implying external contributions or PR workflow.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T14:52:53.147283-05:00","updated_at":"2025-12-21T15:13:58.112745-05:00","closed_at":"2025-12-21T15:13:58.112745-05:00","close_reason":"Already documented in README Cloud/DB section: Vault installed by default, --skip-vault to skip, CLI only (no server config)","labels":["docs","readme","secrets"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-kgf.2","depends_on_id":"agentic_coding_flywheel_setup-kgf","type":"parent-child","created_at":"2025-12-21T14:52:53.149053-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-kgf.2","depends_on_id":"agentic_coding_flywheel_setup-mjt.3.4","type":"related","created_at":"2025-12-21T14:53:43.160539-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-kgf.3","title":"Clarify Supabase IPv4 limitation + pooler usage","description":"## Goal\nAdd a clear warning/guide in `README.md` about Supabase connectivity from a VPS:\n- Unless you pay for Supabase features that provide direct IPv4 access, you may not be able to connect directly to your Postgres instance over IPv4.\n- In that case you must use the public Supabase pooler (and configure apps accordingly).\n\n## Why\nThis is a common “it works locally but not on the VPS” failure mode, and beginners will get stuck.\n\n## Acceptance criteria\n- README includes a concise, accurate note in an existing DB/Supabase section.\n- Mentions the recommended workaround (public pooler) and the practical implication (connection string/host/port differences).\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T14:53:00.457619-05:00","updated_at":"2025-12-21T15:14:18.86116-05:00","closed_at":"2025-12-21T15:14:18.86116-05:00","close_reason":"Already documented in README Cloud/DB section: IPv6-only Supabase warning with pooler workaround","labels":["cloud","db","docs","readme"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-kgf.3","depends_on_id":"agentic_coding_flywheel_setup-kgf","type":"parent-child","created_at":"2025-12-21T14:53:00.462195-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-kgf.3","depends_on_id":"agentic_coding_flywheel_setup-3ht","type":"related","created_at":"2025-12-21T14:53:37.555109-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-kgf.4","title":"Add README guidance: prefer native Claude Code install/update","description":"## Goal\nDocument the recommended way to install and update Claude Code in ACFS.\n\n## Key points to clarify\n- ACFS should prefer the official/native Claude Code installation method (not a random package manager build).\n- Updates should use Claude Code’s native update mechanism when available; fall back to reinstall only if needed.\n\n## Acceptance criteria\n- README mentions the preferred install/update pathway for Claude Code.\n- Avoids confusing users with multiple competing install methods.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T14:53:07.842-05:00","updated_at":"2025-12-21T15:12:43.589181-05:00","closed_at":"2025-12-21T15:12:43.589181-05:00","close_reason":"Added install/update guidance in README AI Coding Agents section explaining native mechanisms","labels":["agents","docs","readme"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-kgf.4","depends_on_id":"agentic_coding_flywheel_setup-kgf","type":"parent-child","created_at":"2025-12-21T14:53:07.845425-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-kgf.4","depends_on_id":"agentic_coding_flywheel_setup-hby","type":"related","created_at":"2025-12-21T14:53:14.236065-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-kwa","title":"Fail-fast remote curl|bash invocations in install.sh","description":"Several remote installer invocations in install.sh run via subshells without pipefail (e.g., oh-my-zsh uses sh -c with curl output, and multiple run_as_target bash -c \"curl ... | sh\"). If curl fails, the subshell can still return success and the installer continues. Fix by running these under bash with set -euo pipefail and passing args safely, so download/exec failures abort correctly.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-20T15:17:16.089137-05:00","updated_at":"2025-12-20T15:20:45.480511-05:00","closed_at":"2025-12-20T15:20:45.480511-05:00","close_reason":"Wrap remote installer subshells with set -euo pipefail so curl failures abort; also make stack remote installer helper pass args safely and avoid masking download errors.","labels":["installer","reliability"]}
{"id":"agentic_coding_flywheel_setup-kwk","title":"Vendor NTM command_palette.md for onboarding","description":"# Task: Vendor NTM Command Palette\n\n## Description\nCopy and maintain a local version of NTM's command_palette.md for use in onboarding.\n\n## Background\nThe onboard TUI needs to show NTM's prompt palette to users. Rather than fetch it live (requires internet), we vendor a copy.\n\n## Implementation\n\n### Vendor Location\n`acfs/onboard/docs/ntm/command_palette.md`\n\n### Sync Script\n`scripts/sync/sync_ntm_palette.sh`\n\n```bash\n#!/bin/bash\n# Sync NTM command palette from upstream\n\nSOURCE=\"https://raw.githubusercontent.com/Dicklesworthstone/ntm/main/command_palette.md\"\nDEST=\"acfs/onboard/docs/ntm/command_palette.md\"\n\ncurl -fsSL \"$SOURCE\" \u003e \"$DEST\"\necho \"Synced command_palette.md\"\n```\n\n### Install Location\nDeployed to: `~/.acfs/docs/ntm/command_palette.md`\n\n### Onboard Integration\nIn Mission 6, show the palette using:\n- bat (pretty) if available\n- less as fallback\n\n## Acceptance Criteria\n- [ ] Sync script works\n- [ ] Palette included in installer\n- [ ] Displayed in onboard Mission 6\n- [ ] Readable over SSH","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:28:15.931606-05:00","updated_at":"2025-12-20T12:22:39.515282-05:00","closed_at":"2025-12-20T12:22:39.515282-05:00","close_reason":"Vendored NTM command_palette.md to acfs/onboard/docs/ntm/. Added sync script scripts/sync/sync_ntm_palette.sh with --check mode. Commit 2a09af8.","labels":["onboard","task"]}
{"id":"agentic_coding_flywheel_setup-l2w","title":"Harden sync_ntm_palette.sh: HTTPS-only curl + single-fetch hashing","description":"scripts/sync/sync_ntm_palette.sh currently uses plain curl -fsSL and may fetch the remote file twice when computing the hash. Align with scripts/lib/security.sh (HTTPS-only curl args + enforce_https) and compute remote hash from a single fetch.","status":"closed","priority":2,"issue_type":"task","assignee":"GreenDog","created_at":"2025-12-20T20:46:02.630169-05:00","updated_at":"2025-12-20T20:51:03.294991-05:00","closed_at":"2025-12-20T20:51:03.294991-05:00","close_reason":"Resolved on main: sync_ntm_palette.sh now uses scripts/lib/security.sh for HTTPS-only curl + single-fetch hashing (commit d683f1f). Shellcheck clean.","labels":["scripts","security"]}
{"id":"agentic_coding_flywheel_setup-lbo","title":"doctor: include user tool dirs in PATH","description":"scripts/lib/doctor.sh relies on PATH-only lookups, so running `acfs doctor` in a non-zshrc environment (fresh ssh, bash shell, etc.) can falsely report missing tools that are installed under ~/.local/bin, ~/.bun/bin, ~/.cargo/bin, etc. Make doctor self-contained by prepending common ACFS install dirs to PATH before checks (and optionally improve version detection for commands like go/tmux).","status":"closed","priority":1,"issue_type":"bug","assignee":"FuchsiaCreek","created_at":"2025-12-20T17:46:21.82316-05:00","updated_at":"2025-12-20T18:18:48.406739-05:00","closed_at":"2025-12-20T18:18:48.406739-05:00","close_reason":"doctor self-contained PATH + version handling"}
{"id":"agentic_coding_flywheel_setup-lhe","title":"[ubu.10] Add user communication and progress tracking","description":"# Add User Communication and Progress Tracking\n\n## Purpose\nProvide visibility to users during the multi-reboot upgrade process, especially when they SSH back in.\n\n## Problem\nWhen a user SSH reconnects during/after an upgrade:\n1. They have no idea what state the system is in\n2. They might run install.sh again (could conflict)\n3. They might try to use apt (could fail during upgrade)\n\n## Solutions\n\n### 1. MOTD (Message of the Day) Update\n\nCreate temporary MOTD during upgrade:\n```bash\nubuntu_set_upgrade_motd() {\n  cat \u003e /etc/motd.d/99-acfs-upgrade \u003c\u003cEOF\n═══════════════════════════════════════════════════════════════\n  ACFS Ubuntu Upgrade in Progress\n═══════════════════════════════════════════════════════════════\n\n  Original version: $ORIGINAL_VERSION\n  Target version:   $TARGET_VERSION\n  Current step:     $CURRENT_STEP\n  \n  Progress: $COMPLETED_HOPS / $TOTAL_HOPS upgrades complete\n  \n  To check status:  cat /var/lib/acfs/upgrade_state.json | jq .\n  To view logs:     tail -f /var/log/acfs/upgrade.log\n  \n  DO NOT run apt or install.sh while upgrade is in progress.\n  \n═══════════════════════════════════════════════════════════════\nEOF\n}\n\nubuntu_clear_upgrade_motd() {\n  rm -f /etc/motd.d/99-acfs-upgrade\n}\n```\n\n### 2. Lock File to Prevent Concurrent Runs\n\nPrevent install.sh from running during upgrade:\n```bash\nACFS_UPGRADE_LOCK=\"/var/run/acfs-upgrade.lock\"\n\nubuntu_acquire_lock() {\n  if [[ -f \"$ACFS_UPGRADE_LOCK\" ]]; then\n    local pid=$(cat \"$ACFS_UPGRADE_LOCK\")\n    if kill -0 \"$pid\" 2\u003e/dev/null; then\n      log_error \"Another upgrade is in progress (PID: $pid)\"\n      return 1\n    fi\n    # Stale lock file\n    rm -f \"$ACFS_UPGRADE_LOCK\"\n  fi\n  echo $$ \u003e \"$ACFS_UPGRADE_LOCK\"\n}\n\nubuntu_release_lock() {\n  rm -f \"$ACFS_UPGRADE_LOCK\"\n}\n```\n\n### 3. Status Check Command\n\nCreate simple status script:\n```bash\n# /var/lib/acfs/check_upgrade_status.sh\n#!/usr/bin/env bash\nif [[ -f /var/lib/acfs/upgrade_state.json ]]; then\n  echo \"ACFS Ubuntu Upgrade Status\"\n  echo \"==========================\"\n  cat /var/lib/acfs/upgrade_state.json | jq -r \"\n    \\\"Original: \\\" + .ubuntu_upgrade.original_version,\n    \\\"Target: \\\" + .ubuntu_upgrade.target_version,\n    \\\"Current: \\\" + ((.ubuntu_upgrade.completed_upgrades | length | tostring) + \\\"/\\\" + (.ubuntu_upgrade.upgrade_path | length | tostring)),\n    \\\"Stage: \\\" + .ubuntu_upgrade.current_stage\n  \"\nelse\n  echo \"No upgrade in progress\"\nfi\n```\n\n### 4. Pre-Reboot Warning\n\nGive users time to read before reboot:\n```bash\nubuntu_warn_reboot() {\n  log_warn \"╔══════════════════════════════════════════════════════════╗\"\n  log_warn \"║  System will reboot in 30 seconds for Ubuntu upgrade     ║\"\n  log_warn \"║                                                          ║\"\n  log_warn \"║  Your SSH session will disconnect.                       ║\"\n  log_warn \"║  Wait 2-3 minutes, then reconnect.                       ║\"\n  log_warn \"║  The upgrade will continue automatically.                ║\"\n  log_warn \"╚══════════════════════════════════════════════════════════╝\"\n  \n  for i in {30..1}; do\n    echo -ne \"\\rRebooting in $i seconds... \"\n    sleep 1\n  done\n  echo \"\"\n}\n```\n\n### 5. Progress Estimation\n\nShow time estimates:\n```bash\nubuntu_show_progress() {\n  local current_hop=\"$1\"\n  local total_hops=\"$2\"\n  local minutes_per_hop=45\n  \n  local remaining_hops=$((total_hops - current_hop + 1))\n  local remaining_minutes=$((remaining_hops * minutes_per_hop))\n  \n  log_info \"Progress: Upgrade $current_hop of $total_hops\"\n  log_info \"Estimated time remaining: ~${remaining_minutes} minutes\"\n}\n```\n\n## Integration Points\n\n1. Set MOTD at start of upgrade phase\n2. Clear MOTD when upgrade completes\n3. Lock file acquired before upgrade, released after\n4. Status script created during setup, removed during cleanup\n5. Pre-reboot warning shown before each reboot","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T16:25:18.337553-05:00","updated_at":"2025-12-21T16:40:19.26302-05:00","closed_at":"2025-12-21T16:40:19.26302-05:00","close_reason":"Added lock file functions (upgrade_acquire_lock, upgrade_release_lock), progress display (upgrade_show_progress), reboot countdown warning (upgrade_warn_reboot), and status check script (upgrade_create_status_script). MOTD already implemented.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-lhe","depends_on_id":"agentic_coding_flywheel_setup-9xt","type":"blocks","created_at":"2025-12-21T16:26:42.324328-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-lhe","depends_on_id":"agentic_coding_flywheel_setup-2yd","type":"blocks","created_at":"2025-12-21T16:26:42.526199-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-lz1","title":"Add timeout handling and caching to deep doctor checks","description":"# Task: Add timeout handling and caching to deep doctor checks\n\n## Purpose\nPrevent deep checks from hanging indefinitely and avoid redundant slow operations.\n\n## Timeout Strategy\n\n### Per-Check Timeout: 15 seconds\n**Rationale:**\n- Most API health checks respond in \u003c2s\n- Database connections should establish in \u003c5s  \n- 15s is generous but prevents indefinite hangs\n- Total deep check runtime capped at reasonable duration\n\n```bash\nDEEP_CHECK_TIMEOUT=15  # seconds\n\nrun_with_timeout() {\n    local timeout=\"$1\"\n    local description=\"$2\"\n    shift 2\n    \n    local result\n    result=$(timeout \"$timeout\" \"$@\" 2\u003e\u00261)\n    local status=$?\n    \n    if ((status == 124)); then\n        echo \"TIMEOUT\"\n        log_warn \"$description timed out after ${timeout}s\"\n        return 124\n    fi\n    \n    echo \"$result\"\n    return $status\n}\n\n# Usage\ncheck_postgres_deep() {\n    local result\n    result=$(run_with_timeout $DEEP_CHECK_TIMEOUT \"PostgreSQL connection\" \\\n        psql -h localhost -U postgres -c \"SELECT 1\" 2\u003e\u00261)\n    \n    case $? in\n        0)   echo \"[✓] PostgreSQL: responding\" ;;\n        124) echo \"[?] PostgreSQL: check timed out\" ;;\n        *)   echo \"[✗] PostgreSQL: $result\" ;;\n    esac\n}\n```\n\n### Caching Strategy\nCache successful deep check results to avoid redundant slow operations:\n\n```bash\nCACHE_DIR=\"${XDG_CACHE_HOME:-$HOME/.cache}/acfs\"\nCACHE_TTL=300  # 5 minutes\n\ncache_result() {\n    local key=\"$1\"\n    local value=\"$2\"\n    mkdir -p \"$CACHE_DIR\"\n    echo \"$value\" \u003e \"$CACHE_DIR/$key\"\n}\n\nget_cached_result() {\n    local key=\"$1\"\n    local cache_file=\"$CACHE_DIR/$key\"\n    \n    if [[ -f \"$cache_file\" ]]; then\n        local age=$(($(date +%s) - $(stat -c %Y \"$cache_file\" 2\u003e/dev/null || stat -f %m \"$cache_file\")))\n        if ((age \u003c CACHE_TTL)); then\n            cat \"$cache_file\"\n            return 0\n        fi\n    fi\n    return 1\n}\n\ncheck_with_cache() {\n    local key=\"$1\"\n    local description=\"$2\"\n    shift 2\n    \n    # Try cache first\n    local cached\n    if cached=$(get_cached_result \"$key\"); then\n        echo \"$cached (cached)\"\n        return 0\n    fi\n    \n    # Run actual check\n    local result\n    result=$(\"$@\")\n    local status=$?\n    \n    # Cache if successful\n    ((status == 0)) \u0026\u0026 cache_result \"$key\" \"$result\"\n    \n    echo \"$result\"\n    return $status\n}\n```\n\n## Deep Checks to Implement\n\n| Check | Command | Timeout | Cacheable |\n|-------|---------|---------|-----------|\n| PostgreSQL | `psql -c \"SELECT 1\"` | 15s | No |\n| Redis | `redis-cli ping` | 15s | No |\n| Claude auth | `claude --version` | 15s | Yes (5min) |\n| GitHub auth | `gh auth status` | 15s | Yes (5min) |\n| Cloudflare auth | `wrangler whoami` | 15s | Yes (5min) |\n| npm registry | `npm ping` | 15s | Yes (5min) |\n\n## Output Format for Timeout\n```\n[?] PostgreSQL: check timed out (15s)\n```\nUse `[?]` indicator (unknown) rather than `[✗]` (failed) for timeouts.\n\n## Dependencies\n- Depends on: Deep checks implementation (agentic_coding_flywheel_setup-aqs)\n- Used by: --deep flag (agentic_coding_flywheel_setup-01s)\n\n## Acceptance Criteria\n- [ ] 15s timeout per check (not 30s - too long)\n- [ ] Timeout indicated with [?] not [✗]\n- [ ] Cache TTL of 5 minutes for auth checks\n- [ ] Cache invalidation on explicit --no-cache flag\n- [ ] Total deep check time logged","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T12:51:12.646632-05:00","updated_at":"2025-12-21T15:05:26.961623-05:00","closed_at":"2025-12-21T15:05:26.961623-05:00","close_reason":"Added timeout handling and caching to deep doctor checks: run_with_timeout() helper with 15s default, cache_result/get_cached_result for 5-min TTL, --no-cache flag, elapsed time tracking in JSON output","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-lz1","depends_on_id":"agentic_coding_flywheel_setup-aqs","type":"blocks","created_at":"2025-12-21T12:51:29.518804-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mg9","title":"Add --resume and --force-reinstall CLI flags","description":"# Task: Add --resume and --force-reinstall CLI flags\n\n## Context\nPart of EPIC: Phase-Granular Progress Persistence (agentic_coding_flywheel_setup-5uu)\n\n## What to Do\nAdd new command-line flags to install.sh:\n\n### --resume\n- Explicit intent to resume from checkpoint\n- Default behavior when state.json exists\n- Skips resume confirmation prompt in non-interactive mode\n\n### --force-reinstall\n- Ignores existing state.json\n- Starts fresh installation from phase 1\n- Clears state file before starting\n\n### --reset-state\n- Deletes state.json and exits\n- For debugging/recovery purposes\n- Does not run installation\n\n## Acceptance Criteria\n- Flags parsed correctly in argument handling\n- --force-reinstall clears state before install\n- --resume is default when state exists\n- --reset-state only removes state and exits\n- Help text updated with new flags\n\n## Implementation Notes\nUpdate the existing flag parsing loop in install.sh around line 35-43\n\n## Files to Modify\n- install.sh: Argument parsing and help text","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T12:42:42.685179-05:00","updated_at":"2025-12-21T14:45:28.771417-05:00","closed_at":"2025-12-21T14:45:28.771417-05:00","close_reason":"CLI flags already implemented: --resume, --force-reinstall, --reset-state, --interactive. Added export statements to fix shellcheck warnings and ensure state.sh can access the flags.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mg9","depends_on_id":"agentic_coding_flywheel_setup-yaj","type":"blocks","created_at":"2025-12-21T12:47:28.129688-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt","title":"EPIC: Manifest-Driven Installer Integration (Single Source of Truth)","description":"## Why this epic exists\nToday ACFS effectively has **two universes**:\n- **Universe A (reference only):** `acfs.manifest.yaml` → generator → `scripts/generated/*`\n- **Universe B (reality):** `install.sh` contains hand-maintained install logic\n\nThat split creates ongoing drift, duplicated effort, and bugs that only show up on real machines.\n\nThis epic makes the manifest the *actual* single source of truth for what gets installed, how it’s installed, and how it’s verified.\n\n## Goal (end state)\n- `acfs.manifest.yaml` is canonical for:\n  - selection (defaults / only / skip)\n  - ordering (phase + deps)\n  - install behavior (run_as, verified upstream installers, optional)\n  - verification (doctor existence checks)\n- `scripts/generated/*` is **the** module-install implementation used by the installer.\n- `install.sh` becomes a thin orchestrator:\n  - bootstraps a self-consistent repo snapshot in `curl|bash` mode (single archive)\n  - sources libs + generated installers (local files only)\n  - handles orchestration-only steps (user normalization, phase framing, UX)\n  - computes selection once (dependency closure) and then executes deterministically\n\n## Non-goals\n- Rewriting the installer in TypeScript / requiring Bun before base packages.\n- Supporting non-Ubuntu targets.\n- Turning ACFS into an “open contributor” project (internal-only posture remains).\n\n## Security \u0026 reliability invariants\n- No `source \u003c(curl ...)`.\n- Verified installers only: remote scripts must be HTTPS + SHA256 verified via `checksums.yaml`.\n- Generated scripts are libraries: safe to source, no side effects at import.\n- No “set -e landmines”: generated module functions must explicitly catch/handle failures so optional modules cannot kill the whole run.\n- `curl|bash` bootstrap must be atomic and validated (`bash -n` before sourcing) with a coherence check (manifest SHA).\n\n## UX invariants\n- `--only` should be safe by default (dependency closure).\n- `--skip` must fail early if it creates a broken plan (skipping required deps).\n- Defaults must be explicit (`enabled_by_default`) so we can add tools without surprising beginners.\n\n## Deliverables\n- Manifest schema vNext (category/tags/defaults/run_as/verified_installer/deps)\n- Deterministic `manifest_index.sh` (and optional JSON) generated from manifest\n- install.sh refactor: archive bootstrap + manifest-driven selection + generated installer execution\n- Test coverage: offline “simulate curl|bash bootstrap”, selection safety tests, existing Docker integration tests\n- Docs: internal maintainer workflow + user-facing flag documentation (integrated into existing README sections)\n\n## Coordination with existing open epics\nThis epic touches `install.sh`, but must remain compatible with:\n- Preflight validation\n- State/resume + phase wrappers\n- Structured error reporting / try_step\n- Checksum recovery UX\n\nThose efforts should remain orchestrator/lib-owned so they survive migration.\n","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-21T13:47:13.453531-05:00","updated_at":"2025-12-21T13:47:13.453531-05:00","labels":["architecture","installer","manifest"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt","depends_on_id":"agentic_coding_flywheel_setup-0ok","type":"related","created_at":"2025-12-21T13:49:50.301283-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt","depends_on_id":"agentic_coding_flywheel_setup-5uu","type":"related","created_at":"2025-12-21T13:49:50.450417-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt","depends_on_id":"agentic_coding_flywheel_setup-fkf","type":"related","created_at":"2025-12-21T13:49:50.596866-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt","depends_on_id":"agentic_coding_flywheel_setup-tx7","type":"related","created_at":"2025-12-21T13:49:50.737149-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt","depends_on_id":"agentic_coding_flywheel_setup-t9i","type":"related","created_at":"2025-12-21T13:49:50.879617-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.1","title":"Phase 0: Spec freeze + cross-epic harmonization","description":"## Purpose\nLock down the behavioral contracts (selection semantics, bootstrap invariants, module runtime contract) so implementation work is deterministic and doesn’t churn.\n\n## Why this matters\nWe have multiple open reliability epics that touch `install.sh`. If we don’t freeze contracts now, we’ll create repeated merge conflicts and inconsistent UX.\n\n## Outputs\n- A crisp, testable spec for:\n  - selection + dependency closure (inputs/outputs/error semantics)\n  - tags/categories/defaults strategy\n  - curl|bash bootstrap contract + env vars\n  - generated module function contract (run_as + strict-mode safety)\n\n## Acceptance criteria\n- Decisions recorded in `PLAN_TO_HAVE_SINGLE_SOURCE_OF_TRUTH_MANIFEST.md`.\n- A concrete “golden path” CLI story that matches the wizard flows.\n- A minimal “expert debugging” story (`--no-deps`, `--print-plan`).\n","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T13:47:13.621348-05:00","updated_at":"2025-12-21T15:44:52.169492-05:00","closed_at":"2025-12-21T15:44:52.169492-05:00","close_reason":"Added golden path CLI stories (Stories 1-5) and expert debugging stories (D1-D5) to PLAN_TO_HAVE_SINGLE_SOURCE_OF_TRUTH_MANIFEST.md. Phase 0 spec freeze complete - unblocks mjt.1.2","labels":["architecture","manifest","planning"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.1","depends_on_id":"agentic_coding_flywheel_setup-mjt","type":"parent-child","created_at":"2025-12-21T13:47:13.621726-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.1.1","title":"Define module taxonomy (categories/tags/defaults)","description":"## Goal\nDefine a coherent taxonomy that supports:\n- human comprehension (website wizard, docs)\n- deterministic generation (file layout)\n- selection and filtering (defaults, legacy skip flags)\n\n## Decisions to make\n- Canonical `category` set (e.g., base/shell/cli/lang/agents/cloud/stack/acfs)\n- Canonical `tags` set (e.g., lang,runtime,cloud,db,secrets,agent,ux,critical,recommended)\n- Default install policy:\n  - what is `enabled_by_default: true`\n  - what is opt-in (enabled_by_default false)\n\n## Constraints\n- Must preserve existing wizard flows.\n- Must keep “beginner default install” stable and unsurprising.\n\n## Output\n- A short table in the plan doc mapping:\n  - legacy flags → tags/modules\n  - category → wizard step(s)\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:19.143465-05:00","updated_at":"2025-12-21T15:38:56.364844-05:00","closed_at":"2025-12-21T15:38:56.364844-05:00","close_reason":"Documented module taxonomy in PLAN_TO_HAVE_SINGLE_SOURCE_OF_TRUTH_MANIFEST.md. Defined 8 canonical categories, 10 tags, enabled_by_default policy, legacy flag mappings, and category→wizard step mappings.","labels":["manifest","planning"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.1.1","depends_on_id":"agentic_coding_flywheel_setup-mjt.1","type":"parent-child","created_at":"2025-12-21T13:49:19.148024-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.1.1","depends_on_id":"agentic_coding_flywheel_setup-v8a","type":"blocks","created_at":"2025-12-21T14:09:58.391953-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.1.2","title":"Define selection contract (deps, skips, plan output)","description":"## Goal\nFreeze selection semantics so generator + installer implement deterministically.\n\n## Why this matters\nSelection is the installer’s control plane. If selection semantics drift, we get:\n- surprising installs (defaults not explicit)\n- unsafe partial installs (`--only` without deps)\n- confusing resumes (state says resume but selection changes the plan)\n- wizard/docs drift (flags no longer map to the same behavior)\n\n## Inputs (CLI)\n### Filters\n- `--only \u003cid[,id...]\u003e` (module IDs)\n- `--only-phase \u003cn[,n...]\u003e` (phase numbers)\n- `--skip \u003cid[,id...]\u003e` (module IDs)\n- (optional schema support, if we choose): `--only-tag`, `--skip-tag`, `--skip-category`\n\n### Plan / introspection\n- `--list-modules`\n- `--print-plan` (human diffable; stable ordering)\n\n### Expert debugging\n- `--no-deps` (disables dependency closure; MUST print a prominent warning)\n\n### Legacy wrappers\n- Existing `--skip-*` flags (exact list comes from `mjt.2.2`) become pure selection shims.\n\n## Outputs\n- Effective run set (fast membership test):\n  - `ACFS_EFFECTIVE_RUN[module_id]=1` (assoc array)\n- Deterministic ordered plan (execution order):\n  - `ACFS_EFFECTIVE_PLAN=(module_id...)` (filter of `ACFS_MODULES_IN_ORDER`)\n\nNice-to-have diagnostics (improves debuggability):\n- `ACFS_PLAN_REASON[module_id]=\"default|only|phase|dep|legacy_flag\"`\n\n## Semantics (explicit rules)\n- **Defaults:** starting set is `enabled_by_default` modules.\n- **`--only`:** replaces defaults with the explicit set, then expands dependencies unless `--no-deps`.\n- **`--only-phase`:** selects all modules in those phases, then expands dependencies unless `--no-deps`.\n- **Dependency closure:** must be deterministic and stable.\n- **`--skip`:** removes modules from the effective set.\n  - If the skip removes a required dependency, it MUST fail early with an actionable error.\n- **Unknown module IDs / phases:** MUST fail early.\n\n## Interaction with reliability epics (must not regress)\n- `--print-plan` and `--list-modules` MUST NOT mutate state.json.\n- Resume/state integration:\n  - Selection should compute the *full effective plan*.\n  - Resume logic chooses starting point within that plan.\n  - If flags materially change what would run, `--print-plan` should make this obvious.\n- Preflight integration:\n  - Introspection (`--print-plan`, `--list-modules`) should not require preflight/network.\n\n## Output required in plan doc\nAdd concrete “golden path” examples:\n- default install\n- `--only lang.bun` expands deps\n- `--only lang.bun --no-deps` warns loudly\n- `--only lang.bun --skip base.system` fails early\n- legacy flags produce the same plan as current behavior\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:19.314478-05:00","updated_at":"2025-12-21T15:41:27.810944-05:00","closed_at":"2025-12-21T15:41:27.810944-05:00","close_reason":"Documented selection contract in PLAN doc. Defined CLI flags, selection algorithm, output structures (ACFS_EFFECTIVE_RUN, ACFS_EFFECTIVE_PLAN), 7 golden path examples, error messages, and implementation locations.","labels":["installer","planning"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.1.2","depends_on_id":"agentic_coding_flywheel_setup-mjt.1","type":"parent-child","created_at":"2025-12-21T13:49:19.315046-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.1.2","depends_on_id":"agentic_coding_flywheel_setup-mjt.1.1","type":"blocks","created_at":"2025-12-21T13:49:19.778591-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.1.2","depends_on_id":"agentic_coding_flywheel_setup-mg9","type":"related","created_at":"2025-12-21T14:49:10.330584-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.1.3","title":"Define curl|bash archive bootstrap contract","description":"## Goal\nFreeze the `curl | bash` bootstrap contract so installs are self-consistent, atomic, and debuggable.\n\n## Non‑negotiables\n- Never `source \u003c(curl ...)`.\n- Bootstrap a **single repo snapshot** (GitHub archive for one ref) to prevent mixed-ref installs.\n- Download → validate → extract → validate scripts → only then `source`.\n\n## Required env vars (minimum)\n- `ACFS_REPO_OWNER`\n- `ACFS_REPO_NAME`\n- `ACFS_REF` (branch | tag | sha)\n\nOptional knobs (if we want them):\n- `ACFS_BOOTSTRAP_DIR` (override mktemp)\n- `ACFS_KEEP_BOOTSTRAP=1` (keep extracted tree for debugging)\n\n## What must be available after bootstrap\nBootstrap must provide **every file that install.sh may source or execute** during a run.\n\nMinimum recommended extraction set:\n- `scripts/lib/**`\n- `scripts/generated/**`\n- `scripts/preflight.sh` (Phase 0 preflight path; see `agentic_coding_flywheel_setup-0ok`)\n- `acfs/**` (assets deployed to `~/.acfs/`)\n- `checksums.yaml`\n- `acfs.manifest.yaml`\n\nDecision to make (for future-proofing):\n- Extract a minimal allowlist (smaller surface area), OR\n- Extract `scripts/**` to avoid “forgot to add new runtime script” failures.\n\n## Validation rules\n- `bash -n` on every extracted `.sh` that will be sourced.\n- Coherence check:\n  - compute `sha256(acfs.manifest.yaml)`\n  - compare to `ACFS_MANIFEST_SHA256` from `scripts/generated/manifest_index.sh`\n  - mismatch =\u003e hard abort (“bootstrap mismatch: mixed ref or stale generated output”).\n\n## Atomicity rules\n- Download archive to a temp file first.\n- Only after successful extraction + validation do we point `ACFS_LIB_DIR`, `ACFS_GENERATED_DIR`, etc at the extracted tree.\n\n## Failure modes (must be documented)\n- network failure / partial download\n- extraction failure\n- `bash -n` failure (corrupt script)\n- manifest/index mismatch (mixed ref)\n\n## Output\n- Add pseudocode + explicit failure messages to `PLAN_TO_HAVE_SINGLE_SOURCE_OF_TRUTH_MANIFEST.md`.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:19.472773-05:00","updated_at":"2025-12-21T15:43:32.366778-05:00","closed_at":"2025-12-21T15:43:32.366778-05:00","close_reason":"Documented bootstrap contract in PLAN doc. Defined env vars, 9-step bootstrap sequence with pseudocode, extraction set, 6 failure modes, atomicity guarantees, and debug mode.","labels":["installer","planning","security"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.1.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.1","type":"parent-child","created_at":"2025-12-21T13:49:19.473175-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.1.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.1.2","type":"blocks","created_at":"2025-12-21T13:49:19.929569-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.1.3","depends_on_id":"agentic_coding_flywheel_setup-0iq","type":"related","created_at":"2025-12-21T14:49:18.539374-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.1.4","title":"Define generated module function runtime contract","description":"## Goal\nFreeze the contract between `install.sh` (orchestrator) and generated module functions.\n\n## Core principles\n- **Generated scripts are libraries:** safe to `source` (no side effects at import).\n- **Contract validation happens at call-time:** each module function calls `acfs_require_contract` at entry.\n- **Orchestrator owns reliability UX:** resume/state, phase framing, and structured error reporting live in `install.sh` + `scripts/lib/*`.\n- **Modules are deterministic units:** they run install/verify and return a status code; they do not `exit`.\n\n## Required behaviors inside every generated module function\n1) **Local identity + contract check**\n- `local module_id=\"...\"`\n- `acfs_require_contract \"module:${module_id}\" || return 1`\n\n2) **Selection check (no side effects if filtered)**\n- `if ! should_run_module \"$module_id\" \"$module_phase\"; then ...; return 0; fi`\n\n3) **Idempotency / installed_check runs even in dry-run**\n- installed_check MUST be side-effect-free.\n- If already installed: log + return 0.\n\n4) **DRY_RUN semantics**\n- In `DRY_RUN=true`, modules must:\n  - print what they *would* do\n  - avoid side effects\n  - still run installed_check and show current state\n\n5) **Strict-mode safety (no “set -e landmines”)**\n- Every risky step (verified installer call, install command block, verify command) must be wrapped so failures do not unexpectedly terminate the entire installer.\n\n## Return code + skip tracking semantics\n- **Non-optional module:**\n  - install failure =\u003e return 1\n  - verify failure =\u003e return 1\n- **Optional module:**\n  - failures degrade gracefully =\u003e return 0\n  - MUST log a warning and MUST record a skip reason in a way that surfaces in:\n    - end-of-install skipped tools report (`agentic_coding_flywheel_setup-8z5`)\n    - doctor output “Intentionally Skipped” section (`agentic_coding_flywheel_setup-qup`)\n\n## Verified installer execution\n- Remote installers MUST be invoked via shared verified pathways (e.g., `acfs_run_verified_upstream_script_as_*`).\n- Generated code must never inline `curl | bash`.\n\n## Output\n- Add a minimal “module template” snippet to `PLAN_TO_HAVE_SINGLE_SOURCE_OF_TRUTH_MANIFEST.md` that future maintainers can copy.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:19.630865-05:00","updated_at":"2025-12-21T15:46:30.413241-05:00","closed_at":"2025-12-21T15:46:30.413241-05:00","close_reason":"Documented module runtime contract in PLAN doc. Defined module function structure (6 sections), entry requirements, contract validation, selection check, idempotency check, DRY_RUN semantics, return codes, failure handling, verified installer execution, strict-mode safety, skip tracking, naming conventions.","labels":["generator","planning"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.1.4","depends_on_id":"agentic_coding_flywheel_setup-mjt.1","type":"parent-child","created_at":"2025-12-21T13:49:19.631256-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.1.4","depends_on_id":"agentic_coding_flywheel_setup-mjt.1.2","type":"blocks","created_at":"2025-12-21T13:49:20.072461-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.1.4","depends_on_id":"agentic_coding_flywheel_setup-8z5","type":"related","created_at":"2025-12-21T14:49:28.665251-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.1.4","depends_on_id":"agentic_coding_flywheel_setup-qup","type":"related","created_at":"2025-12-21T14:49:31.839452-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.2","title":"Phase 1: Gap analysis + inventory","description":"## Purpose\nProduce a complete, auditable mapping from today’s installer reality to the manifest model.\n\n## What to inventory\n- Every install.sh phase function and what it installs\n- What is truly orchestration-only vs a manifest module\n- All CLI flags used by the wizard/docs (and what they should map to)\n- Runtime assets that must be present in curl|bash bootstrap mode (`acfs/**`, templates, lessons)\n\n## Deliverable\n- `docs/manifest-gap-analysis.md` describing:\n  - module mapping\n  - orchestration-only inventory\n  - flag→tag/module mapping proposal\n  - missing/ambiguous manifest items\n\n## Acceptance criteria\n- A future maintainer can answer: “Where does this behavior live?” in \u003c60 seconds.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:47:13.785469-05:00","updated_at":"2025-12-21T15:32:12.0884-05:00","closed_at":"2025-12-21T15:32:12.0884-05:00","close_reason":"All children complete: mjt.2.1 (phase mapping), mjt.2.2 (CLI flags), mjt.2.3 (runtime assets). Full gap analysis in docs/manifest-gap-analysis.md","labels":["docs","installer","manifest"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.2","depends_on_id":"agentic_coding_flywheel_setup-mjt","type":"parent-child","created_at":"2025-12-21T13:47:13.785825-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.2","depends_on_id":"agentic_coding_flywheel_setup-mjt.1","type":"related","created_at":"2025-12-21T14:07:42.21812-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.2.1","title":"Produce install.sh ↔ manifest module mapping (docs/manifest-gap-analysis.md)","description":"## Goal\nCreate a complete mapping so future refactors don’t lose behavior.\n\n## What to capture\n- For each install.sh phase:\n  - what it installs\n  - what checks it uses for idempotency\n  - what user context it assumes\n- For each manifest module:\n  - whether it’s currently installed by install.sh\n  - gaps (missing install, missing verify, missing checksum)\n\n## Output\n- `docs/manifest-gap-analysis.md` with tables:\n  - phase → category → module ids\n  - orchestration-only inventory\n  - “manifest has it, installer doesn’t” list\n  - “installer does it, manifest doesn’t” list\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:20.238152-05:00","updated_at":"2025-12-21T15:27:09.762016-05:00","closed_at":"2025-12-21T15:27:09.762016-05:00","close_reason":"Created docs/manifest-gap-analysis.md with comprehensive phase-to-module mapping, gaps inventory, and recommendations","labels":["docs","installer","manifest"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.2.1","depends_on_id":"agentic_coding_flywheel_setup-mjt.2","type":"parent-child","created_at":"2025-12-21T13:49:20.238525-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.2.2","title":"Inventory wizard/docs CLI flags and map to module/tags","description":"## Goal\nPreserve user-facing behavior while replacing internal implementation.\n\n## What to inventory\n- Flags currently documented in README and used in website wizard\n- Any implicit flows (e.g., vibe vs safe mode)\n\n## Output\n- A mapping proposal:\n  - legacy flag → tag/module selection\n  - default sets for wizard “modes”\n\n## Acceptance criteria\n- No behavior drift in wizard flows after refactor.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:20.401588-05:00","updated_at":"2025-12-21T15:30:01.740224-05:00","closed_at":"2025-12-21T15:30:01.740224-05:00","close_reason":"Added CLI flags inventory and wizard mode defaults mapping to docs/manifest-gap-analysis.md","labels":["docs","installer"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.2.2","depends_on_id":"agentic_coding_flywheel_setup-mjt.2","type":"parent-child","created_at":"2025-12-21T13:49:20.40196-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.2.2","depends_on_id":"agentic_coding_flywheel_setup-mjt.2.1","type":"blocks","created_at":"2025-12-21T13:49:20.708868-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.2.3","title":"Inventory runtime assets required for curl|bash bootstrap","description":"## Goal\nEnsure `curl | bash` mode bootstraps everything required to complete an install (and to run Phase 0 preflight).\n\n## Why this matters\nThe new archive bootstrap is only reliable if it’s also *complete*. Missing runtime files turn into confusing failures (“file not found”) that look like bugs.\n\n## Inventory checklist\n- `acfs/**` assets deployed to `~/.acfs/` (zsh/tmux/onboard lessons)\n- `scripts/lib/**` (installer libraries)\n- `scripts/generated/**` (generated module installers + manifest_index)\n- `scripts/preflight.sh` (Phase 0 preflight; see `agentic_coding_flywheel_setup-0ok`)\n- Any other non-lib scripts that `install.sh` directly executes/sources (avoid surprises)\n- Root-level runtime config needed for coherence/security:\n  - `checksums.yaml`\n  - `acfs.manifest.yaml`\n  - (optional but useful) `VERSION`\n\n## Output\n- A minimal extraction allowlist (paths/prefixes) with rationale.\n- A maintainer note: if you add a new runtime asset or top-level script used by the installer, you must update the allowlist (or choose a broader prefix like `scripts/**`).\n\n## Acceptance criteria\n- A future maintainer can confidently answer: “If I add a new script that install.sh executes, will curl|bash installs still work?”\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:20.561163-05:00","updated_at":"2025-12-21T15:32:06.172319-05:00","closed_at":"2025-12-21T15:32:06.172319-05:00","close_reason":"Added runtime assets inventory to docs/manifest-gap-analysis.md - 12 core assets + 8 lessons + bootstrap order","labels":["installer","security"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.2.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.2","type":"parent-child","created_at":"2025-12-21T13:49:20.5615-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.2.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.2.1","type":"blocks","created_at":"2025-12-21T13:49:20.850022-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.3","title":"Phase 2: Manifest schema vNext + migrate acfs.manifest.yaml","description":"## Purpose\nUpgrade the manifest from “doc-like list of commands” to a schema that can drive generation and safe execution.\n\n## Key schema additions\n- `category`, `phase`\n- `run_as` (target_user/root/current)\n- `verified_installer` (tool/runner/args)\n- `installed_check` (run_as + command)\n- `optional`, `enabled_by_default`\n- `tags`, `dependencies`\n- `generated: false` + `notes:` for orchestration-only or prose\n\n## Acceptance criteria\n- Schema validated by parser; invalid manifests fail fast with clear messages.\n- All existing modules migrated with explicit intent (no prose-in-install).\n- Dependency + phase rules enforced (no future-phase deps).\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:47:14.011582-05:00","updated_at":"2025-12-21T15:57:11.561443-05:00","closed_at":"2025-12-21T15:57:11.561443-05:00","close_reason":"All child tasks completed: schema vNext implemented, validation added, manifest migrated, verified_installers with checksums coverage, docs written.","labels":["generator","manifest"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.3","depends_on_id":"agentic_coding_flywheel_setup-mjt","type":"parent-child","created_at":"2025-12-21T13:47:14.011979-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.2","type":"blocks","created_at":"2025-12-21T13:47:14.972234-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.1","type":"blocks","created_at":"2025-12-21T14:07:42.387548-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.3.1","title":"Implement schema vNext fields in packages/manifest (Zod + TS types)","description":"## Goal\nMake schema changes explicit and validated.\n\n## Work\n- Update Zod schema to add fields:\n  - category, phase\n  - run_as\n  - verified_installer\n  - installed_check\n  - optional, enabled_by_default\n  - tags, dependencies\n  - generated, notes\n- Update TS types to match.\n\n## Acceptance criteria\n- Parsing fails fast with actionable errors.\n- Schema refinement enforces: generated modules must have install steps or verified_installer.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:21.013325-05:00","updated_at":"2025-12-21T15:28:40.630742-05:00","closed_at":"2025-12-21T15:28:40.630742-05:00","close_reason":"Completed","labels":["generator","manifest"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.3.1","depends_on_id":"agentic_coding_flywheel_setup-mjt.3","type":"parent-child","created_at":"2025-12-21T13:49:21.013665-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.3.2","title":"Add manifest validation: deps exist, no cycles, no future-phase deps","description":"## Goal\nPrevent generation of impossible or dangerous execution plans.\n\n## Validation\n- Dependency existence check\n- Cycle detection (fail fast with cycle path)\n- Phase ordering rule: deps must be same or earlier phase\n\n## Acceptance criteria\n- Errors are actionable (module IDs + dependency edges listed).\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:21.176503-05:00","updated_at":"2025-12-21T15:42:47.517699-05:00","closed_at":"2025-12-21T15:42:47.517699-05:00","close_reason":"Implemented dependency validation, cycle detection, and phase ordering validation with 15 tests","labels":["generator","manifest"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.3.2","depends_on_id":"agentic_coding_flywheel_setup-mjt.3","type":"parent-child","created_at":"2025-12-21T13:49:21.176841-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.3.2","depends_on_id":"agentic_coding_flywheel_setup-mjt.3.1","type":"blocks","created_at":"2025-12-21T13:49:21.982689-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.3.3","title":"Add function name collision + reserved-name validation","description":"## Goal\nPrevent silent overwrites / confusing behavior in generated bash.\n\n## Rules\n- No duplicate generated function names across modules.\n- No collisions with a reserved list of orchestrator function names.\n\n## Acceptance criteria\n- Generator fails fast with a clear rename suggestion.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:21.342998-05:00","updated_at":"2025-12-21T15:51:53.378758-05:00","closed_at":"2025-12-21T15:51:53.378758-05:00","close_reason":"Added validateFunctionNameUniqueness() and validateReservedNames() to validate.ts. 25 tests passing. Prevents silent function overwrites in generated bash.","labels":["generator","manifest"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.3.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.3","type":"parent-child","created_at":"2025-12-21T13:49:21.343401-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.3.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.3.1","type":"blocks","created_at":"2025-12-21T13:49:22.130973-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.3.4","title":"Migrate acfs.manifest.yaml: phases/categories/run_as/installed_check","description":"## Goal\nMigrate `acfs.manifest.yaml` from implicit conventions to explicit intent so generation + selection can be correct and stable.\n\n## Migration checklist (schema vNext)\nFor **every** module, set:\n- `phase` (1–10) OR mark as orchestration-only (`generated: false`)\n- `category` (used for grouping/layout; not ordering)\n- `run_as` (`target_user` | `root` | `current`)\n- `installed_check` (side-effect-free; correct `run_as`)\n- `verify` commands (correct `run_as`, stable and idempotent)\n- `optional` and `enabled_by_default`\n- `tags` (for wizard/legacy flag mapping)\n- `dependencies` (for safe `--only` and deterministic ordering)\n\nFor orchestration-only behavior:\n- set `generated: false`\n- move any prose out of `install:` into `notes:` (no prose-in-install)\n\n## Alignment constraints\n- Phase numbering must match the existing installer UX framing (Phases 1–10).\n- Defaults must stay beginner-safe (don’t surprise users by adding lots of new tools to the default set).\n- `optional` should align with the CRITICAL vs RECOMMENDED classification work (`agentic_coding_flywheel_setup-v8a`).\n\n## Acceptance criteria\n- No modules left “unassigned” (every module is either generated + complete, or explicitly orchestration-only).\n- install/verify semantics are unambiguous and runnable under the declared `run_as`.\n- No prose inside `install:` for generated modules.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:21.51209-05:00","updated_at":"2025-12-21T15:50:31.065524-05:00","closed_at":"2025-12-21T15:50:31.065524-05:00","close_reason":"Migrated all 30 modules to schema vNext. Added phase, category, run_as, installed_check, optional, enabled_by_default, tags, and dependencies to every module. Moved orchestration-only modules to generated: false. Cloud/db tools now opt-in.","labels":["manifest"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.3.4","depends_on_id":"agentic_coding_flywheel_setup-mjt.3","type":"parent-child","created_at":"2025-12-21T13:49:21.512468-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.3.4","depends_on_id":"agentic_coding_flywheel_setup-mjt.3.2","type":"blocks","created_at":"2025-12-21T13:49:22.273791-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.3.5","title":"Migrate remote installers to verified_installer + validate checksums.yaml coverage","description":"## Goal\nEnsure all remote installer execution is routed through checksum-verified pathways.\n\n## Why this matters\nThe manifest becomes executable code. Any raw `curl | bash` inside a module turns a “single source of truth” into a security liability.\n\n## Work\n1) Identify modules that execute remote scripts (directly or indirectly), e.g.:\n- `curl -fsSL \u003curl\u003e | bash`\n- `curl ... | sh`\n- any pattern that downloads an installer script and executes it\n\n2) Migrate those modules to:\n```yaml\nverified_installer:\n  tool: \u003ckey-in-checksums-yaml\u003e\n  runner: bash|sh\n  args: []\n```\n\n3) Enforce coverage:\n- Every `verified_installer.tool` must exist in `checksums.yaml`.\n- Generation must fail fast on missing entries.\n\n4) Ensure optionality/criticality composes with checksum recovery UX:\n- CRITICAL tools should remain non-optional (abort on mismatch).\n- RECOMMENDED tools can be optional and integrate with the checksum recovery flow (`agentic_coding_flywheel_setup-tx7`).\n\n## Acceptance criteria\n- No raw `curl | bash` remains in generated installers.\n- Generator produces a hard failure if a verified installer lacks a checksum entry.\n- The only way a remote script executes during install is via shared verified functions in `scripts/lib/security.sh`.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:21.674116-05:00","updated_at":"2025-12-21T15:56:44.747114-05:00","closed_at":"2025-12-21T15:56:44.747114-05:00","close_reason":"Verified_installer now read from manifest. Generator validates checksums.yaml coverage. No raw curl|bash in generated output.","labels":["manifest","security"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.3.5","depends_on_id":"agentic_coding_flywheel_setup-mjt.3","type":"parent-child","created_at":"2025-12-21T13:49:21.674472-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.3.5","depends_on_id":"agentic_coding_flywheel_setup-mjt.3.4","type":"blocks","created_at":"2025-12-21T13:49:22.422883-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.3.6","title":"Document schema vNext (internal maintainer reference)","description":"## Goal\nPrevent future drift by making the schema discoverable.\n\n## Scope\n- Document each schema field:\n  - meaning\n  - allowed values\n  - examples\n  - common mistakes\n\n## Notes\n- Keep it internal-facing (no contributor language).\n","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-21T13:49:21.838095-05:00","updated_at":"2025-12-21T15:56:32.770341-05:00","closed_at":"2025-12-21T15:56:32.770341-05:00","close_reason":"Complete documentation for schema vNext. Created docs/MANIFEST_SCHEMA_VNEXT.md with: field reference tables, 4 comprehensive examples (standard, verified_installer, orchestration-only, optional), validation rules with error examples, maintainer workflows, file locations.","labels":["docs","manifest"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.3.6","depends_on_id":"agentic_coding_flywheel_setup-mjt.3","type":"parent-child","created_at":"2025-12-21T13:49:21.838439-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.3.6","depends_on_id":"agentic_coding_flywheel_setup-mjt.3.1","type":"blocks","created_at":"2025-12-21T13:49:22.567661-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.4","title":"Phase 3: Generator enhancements (module functions + manifest_index)","description":"## Purpose\nMake generator output production-grade for real install.sh consumption.\n\n## Key outputs\n- `scripts/generated/manifest_index.sh` (deterministic, data-only)\n- Generated module functions that:\n  - call `acfs_require_contract` at function entry\n  - are safe under orchestrator strict-mode\n  - execute install/verify under the correct run_as shell helper\n  - handle optional module failures without killing the whole run\n\n## Acceptance criteria\n- Generated scripts remain source-safe (no top-level side effects).\n- Deterministic generation: no timestamps; stable ordering.\n- Generator fails fast on collisions/reserved names.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:47:14.192678-05:00","updated_at":"2025-12-21T16:05:49.316502-05:00","closed_at":"2025-12-21T16:05:49.316502-05:00","close_reason":"All 6 children completed: manifest_index.sh, acfs_require_contract, strict-mode safety, run_as_*_shell heredocs, runner allowlist, --validate/--diff CLI.","labels":["generator","manifest"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.4","depends_on_id":"agentic_coding_flywheel_setup-mjt","type":"parent-child","created_at":"2025-12-21T13:47:14.193026-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.4","depends_on_id":"agentic_coding_flywheel_setup-mjt.3","type":"blocks","created_at":"2025-12-21T13:47:15.124757-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.4.1","title":"Generate scripts/generated/manifest_index.sh (data-only, deterministic)","description":"## Goal\nGenerate a deterministic, Bash-native index for selection + ordering so the installer never has to parse YAML at runtime.\n\n## Why this matters\n- YAML parsing in Bash is brittle and slow.\n- Selection needs dependency closure and deterministic ordering.\n- We need a stable interface between:\n  - `acfs.manifest.yaml` (source of truth)\n  - generator (canonical transform)\n  - install.sh selection engine (runtime)\n\n## Hard requirements\n### 1) Data-only + source-safe\n- No contract validation.\n- No side effects beyond `declare` statements.\n- Safe to `source` before env detection and before parsing args.\n\n### 2) Deterministic output\n- No timestamps.\n- Stable ordering.\n- Same manifest input → identical output.\n\n### 3) Include manifest coherence fingerprint\n- `ACFS_MANIFEST_SHA256=\"...\"` (sha256 of `acfs.manifest.yaml`)\n- Used by curl|bash bootstrap coherence checks.\n\n## Required declarations (minimum viable)\n- `ACFS_MANIFEST_SHA256=\"...\"`\n- `ACFS_MODULES_IN_ORDER=(...)` (phase 1→10, topo-sorted within phase)\n- `declare -A ACFS_MODULE_PHASE=([id]=N ...)`\n- `declare -A ACFS_MODULE_DEPS=([id]=\"a,b,c\" ...)`\n- `declare -A ACFS_MODULE_FUNC=([id]=\"install_x_y\" ...)`\n\n## Recommended declarations (to prevent drift)\n- `declare -A ACFS_MODULE_CATEGORY=([id]=\"lang\" ...)`\n- `declare -A ACFS_MODULE_TAGS=([id]=\"lang,runtime\" ...)`\n- `declare -A ACFS_MODULE_DEFAULT=([id]=\"1|0\" ...)` (enabled_by_default)\n\n## Optional helper functions\nIf we want to keep `install.sh` small, we can include source-safe helper functions (no side effects) such as:\n- `acfs_manifest_list_modules`\n- `acfs_manifest_print_plan` (data-only printing)\n\n## Acceptance criteria\n- File is sourceable even with no installer env set.\n- Supports dependency closure + plan printing without additional manifest parsing.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:22.729653-05:00","updated_at":"2025-12-21T15:33:30.998948-05:00","closed_at":"2025-12-21T15:33:30.998948-05:00","close_reason":"Completed","labels":["generator","manifest"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.4.1","depends_on_id":"agentic_coding_flywheel_setup-mjt.4","type":"parent-child","created_at":"2025-12-21T13:49:22.729999-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.4.2","title":"Emit acfs_require_contract calls at module entry (no source-time validation)","description":"## Goal\nKeep generated scripts source-safe while still enforcing runtime correctness.\n\n## Acceptance criteria\n- Every generated module function begins with:\n  - `local module_id=...`\n  - `acfs_require_contract \"module:${module_id}\" || return 1`\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:22.89687-05:00","updated_at":"2025-12-21T15:34:20.9083-05:00","closed_at":"2025-12-21T15:34:20.9083-05:00","close_reason":"Completed","labels":["generator","installer"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.4.2","depends_on_id":"agentic_coding_flywheel_setup-mjt.4","type":"parent-child","created_at":"2025-12-21T13:49:22.897219-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.4.2","depends_on_id":"agentic_coding_flywheel_setup-mjt.4.1","type":"blocks","created_at":"2025-12-21T13:49:23.701998-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.4.3","title":"Make generated modules strict-mode safe (no implicit set -e landmines)","description":"## Goal\nMake generated module functions safe under orchestrator strict-mode (`set -euo pipefail`) so optional modules cannot accidentally terminate the whole run.\n\n## Why this matters\nEven if generated scripts don’t set strict mode, they will be sourced into an orchestrator that does. A single unguarded failure (e.g., a verify command returning non-zero) can abort the entire installer.\n\n## Requirements\n- Wrap all high-risk steps explicitly:\n  - verified installer invocation\n  - install command blocks\n  - verify command blocks\n- Failure handling must be explicit and consistent:\n  - non-optional =\u003e `log_error` + `return 1`\n  - optional =\u003e `log_warn` + record skip reason + `return 0`\n\n## DRY_RUN compatibility\n- Installed checks must still run to show current state.\n- Install/verify side effects must not run when `DRY_RUN=true`.\n\n## Acceptance criteria\n- Generated functions never rely on implicit `set -e` behavior.\n- Optional module failure does not terminate the full install.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:23.057624-05:00","updated_at":"2025-12-21T15:41:18.861879-05:00","closed_at":"2025-12-21T15:41:18.861879-05:00","close_reason":"Completed","labels":["generator","installer"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.4.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.4","type":"parent-child","created_at":"2025-12-21T13:49:23.058021-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.4.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.4.2","type":"blocks","created_at":"2025-12-21T13:49:23.848082-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.4.4","title":"Generate install execution via run_as_*_shell heredocs for all run_as modes","description":"## Goal\nEnsure module `install:` commands run in the correct user context and support multi-line scripts, pipes, and heredocs without fragile quoting.\n\n## Requirements\n- **Execution context mapping** (no ad-hoc `bash -lc`):\n  - `run_as: target_user` → `run_as_target_shell` heredoc\n  - `run_as: root` → `run_as_root_shell` heredoc\n  - `run_as: current` → `run_as_current_shell` heredoc\n\n- **Heredoc safety**\n  - Use a single-quoted heredoc delimiter so the *outer* shell does not expand variables.\n  - Use a delimiter derived from module id (sanitized) to avoid collisions.\n\n- **Strict-mode inside the executed shell**\n  - The run_as helpers should enforce `set -euo pipefail` inside the executed shell so pipelines fail correctly.\n\n## Acceptance criteria\n- Generator never emits `bash -lc \u003cquoted\u003e` for module install steps.\n- Multi-line scripts with pipes behave predictably (pipe failures bubble up as failures).\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:23.222792-05:00","updated_at":"2025-12-21T16:01:38.869752-05:00","closed_at":"2025-12-21T16:01:38.869752-05:00","close_reason":"Generator now emits run_as_*_shell heredocs for all install commands. Single-quoted delimiters prevent expansion. Dry-run shows run_as mode.","labels":["generator"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.4.4","depends_on_id":"agentic_coding_flywheel_setup-mjt.4","type":"parent-child","created_at":"2025-12-21T13:49:23.226499-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.4.4","depends_on_id":"agentic_coding_flywheel_setup-mjt.4.2","type":"blocks","created_at":"2025-12-21T13:49:24.002171-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.4.5","title":"Whitelist verified_installer runners (bash/sh) and validate args quoting","description":"## Goal\nPrevent command injection via manifest-controlled fields (`verified_installer.runner`, `verified_installer.args`).\n\n## Requirements\n- Runner allowlist (generation-time validation):\n  - allow only `bash` and `sh` (expand only if we have a concrete need)\n- Arguments must be emitted with deterministic, correct quoting:\n  - no string concatenation that can break out of quotes\n  - stable output across runs\n\n## Acceptance criteria\n- Invalid runner values fail generation with an actionable error.\n- A malicious arg string in the manifest cannot alter the generated script structure.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:23.391538-05:00","updated_at":"2025-12-21T16:03:12.251942-05:00","closed_at":"2025-12-21T16:03:12.251942-05:00","close_reason":"Runner allowlist (bash/sh only) added to both schema.ts and validate.ts. Tests pass.","labels":["generator","security"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.4.5","depends_on_id":"agentic_coding_flywheel_setup-mjt.4","type":"parent-child","created_at":"2025-12-21T13:49:23.391949-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.4.5","depends_on_id":"agentic_coding_flywheel_setup-mjt.4.2","type":"blocks","created_at":"2025-12-21T13:49:24.144076-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.4.6","title":"Generator UX: add --validate and --diff workflows","description":"## Goal\nMake it easy for maintainers to keep generated outputs in sync.\n\n## Requirements\n- `--validate`: checks manifest vs checksums + schema invariants\n- `--diff`: prints what generated outputs would change\n\n## Acceptance criteria\n- CI can run validate/diff modes to enforce drift checks.\n","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-21T13:49:23.557623-05:00","updated_at":"2025-12-21T16:03:58.809568-05:00","closed_at":"2025-12-21T16:03:58.809568-05:00","close_reason":"Added --help, --validate, and --diff CLI modes. CI-friendly validation. Tests show all generated files up to date.","labels":["ci","generator"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.4.6","depends_on_id":"agentic_coding_flywheel_setup-mjt.4","type":"parent-child","created_at":"2025-12-21T13:49:23.558016-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.4.6","depends_on_id":"agentic_coding_flywheel_setup-mjt.4.1","type":"blocks","created_at":"2025-12-21T13:49:24.285845-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.5","title":"Phase 4: install.sh refactor to orchestrator + archive bootstrap","description":"## Purpose\nTurn install.sh into a thin orchestrator that sources libs + generated installers and runs a manifest-driven execution plan.\n\n## Core requirements\n- curl|bash mode bootstraps a **single archive** for a single ref and validates scripts before sourcing.\n- Generated scripts are sourced only after env detection (module functions validate contract at call-time).\n- Selection resolved once with dependency closure (`--only/--skip/--only-phase/--no-deps/--print-plan`).\n- Legacy flags remain compatible by mapping to module/tags (no behavior drift).\n- Category migration is feature-flagged to allow incremental rollout.\n\n## Acceptance criteria\n- install.sh line count drops over time (target \u003c500) without losing features.\n- No behavior drift in existing wizard flows.\n- curl|bash never sources partially-downloaded files.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T13:47:14.353871-05:00","updated_at":"2025-12-21T13:47:14.353871-05:00","labels":["installer","manifest"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.5","depends_on_id":"agentic_coding_flywheel_setup-mjt","type":"parent-child","created_at":"2025-12-21T13:47:14.354293-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.5","depends_on_id":"agentic_coding_flywheel_setup-mjt.4","type":"blocks","created_at":"2025-12-21T13:47:15.270314-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.5.1","title":"Add scripts/lib/contract.sh (acfs_require_contract)","description":"## Goal\nCentralize runtime contract validation so install.sh + generated code enforce the same rules.\n\n## Requirements\n- `acfs_require_contract \u003ccontext\u003e` returns non-zero on violation\n- Error message is actionable (which vars/functions missing)\n\n## Acceptance criteria\n- Generated modules call it at entry.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:24.455626-05:00","updated_at":"2025-12-21T15:43:09.734154-05:00","closed_at":"2025-12-21T15:43:09.734154-05:00","close_reason":"Completed","labels":["installer","security"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.5.1","depends_on_id":"agentic_coding_flywheel_setup-mjt.5","type":"parent-child","created_at":"2025-12-21T13:49:24.455976-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.5.2","title":"Implement curl|bash archive bootstrap (atomic + validated + coherent)","description":"## Goal\nMake `curl|bash` installs self-consistent, atomic, and debuggable by bootstrapping a **single repo archive** for a single ref.\n\n## Why this matters (user impact)\n- Mixed-ref installs are a real foot-gun: `install.sh` from commit A + generated scripts from commit B = undefined behavior.\n- Piecemeal raw-file downloads increase the chance of partial downloads and truncation.\n- Beginners need reliability: if something fails, we should fail early with a clear explanation.\n\n## Requirements\n### 1) Single-archive bootstrap\n- Fetch `https://github.com/\u003cowner\u003e/\u003crepo\u003e/archive/\u003cref\u003e.tar.gz` for a single `ACFS_REF`.\n- Extract only the allowlisted runtime subset (final allowlist comes from `mjt.2.3`):\n  - `scripts/lib/**`\n  - `scripts/generated/**`\n  - `scripts/preflight.sh` (Phase 0 preflight)\n  - `acfs/**`\n  - `checksums.yaml`\n  - `acfs.manifest.yaml`\n\n### 2) Atomic + validated\n- Download to a temp file.\n- Validate tarball exists and extraction succeeds.\n- Run `bash -n` on extracted shell scripts before sourcing.\n- Only after validation: point `ACFS_LIB_DIR/ACFS_GENERATED_DIR/...` at the extracted tree.\n\n### 3) Coherence check (prevents mixed refs)\n- Compute `sha256(acfs.manifest.yaml)`.\n- Verify it matches `ACFS_MANIFEST_SHA256` in `scripts/generated/manifest_index.sh` (and/or generated headers).\n- If mismatch: abort with a clear “bootstrap mismatch” error.\n\n### 4) UX considerations\n- Error messages must tell the user what to do next:\n  - “Pin to a tag/sha” suggestion\n  - “Retry” suggestion for transient failures\n- Prefer using the shared curl wrapper (and its retry/backoff behavior) rather than raw `curl`.\n\n### 5) Optional caching\n- Optional: mirror extracted bootstrap under `$ACFS_HOME/cache/bootstrap/\u003cref\u003e/` for faster re-runs.\n- Must not break correctness (cache must be keyed by ref + validated).\n\n## Acceptance criteria\n- No process substitution sourcing.\n- Never sources partially downloaded files.\n- Clear failure messages for:\n  - network errors\n  - extraction errors\n  - bash -n failures\n  - manifest/generated mismatch\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:24.619419-05:00","updated_at":"2025-12-21T15:59:03.390147-05:00","closed_at":"2025-12-21T15:59:03.390147-05:00","close_reason":"Completed","labels":["installer","security"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.5.2","depends_on_id":"agentic_coding_flywheel_setup-mjt.5","type":"parent-child","created_at":"2025-12-21T13:49:24.619777-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.5.2","depends_on_id":"agentic_coding_flywheel_setup-mjt.5.1","type":"blocks","created_at":"2025-12-21T13:49:25.425443-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.5.2","depends_on_id":"agentic_coding_flywheel_setup-0iq","type":"related","created_at":"2025-12-21T14:50:18.736723-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.5.2","depends_on_id":"agentic_coding_flywheel_setup-nna","type":"related","created_at":"2025-12-21T14:50:25.244808-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.5.3","title":"Refactor install.sh source order (env detect before sourcing generated)","description":"## Goal\nEnsure install.sh can parse args and detect environment before loading generated installers.\n\n## Requirements\n- Source minimal libs first (logging/security/contract/install_helpers)\n- `detect_environment` sets required runtime vars\n- Source `manifest_index.sh` + generated installers only after env is ready\n\n## Acceptance criteria\n- `--list-modules` and `--print-plan` work without running installs.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:24.78378-05:00","updated_at":"2025-12-21T16:20:24.448608-05:00","closed_at":"2025-12-21T16:20:24.448608-05:00","close_reason":"Implemented: detect_environment(), list_modules(), print_execution_plan(). Fixed array scoping with declare -gA. Tested both --list-modules and --print-plan.","labels":["installer"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.5.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.5","type":"parent-child","created_at":"2025-12-21T13:49:24.784184-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.5.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.5.2","type":"blocks","created_at":"2025-12-21T13:49:25.569426-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.5.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.5.7","type":"blocks","created_at":"2025-12-21T14:09:00.408281-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.5.4","title":"Implement acfs_resolve_selection (deps closure + skip safety + print-plan)","description":"## Goal\nCompute the effective execution plan once (deterministic), then make per-module checks cheap.\n\n## Inputs\n- `scripts/generated/manifest_index.sh` (phase/deps/func/category/tags/defaults)\n- CLI-derived selection sets:\n  - `ONLY_*` (modules, phases; optionally tags/categories)\n  - `SKIP_*` (modules; optionally tags/categories)\n  - legacy flag shims (applied by mapping into SKIP/ONLY sets)\n- Control flags:\n  - `NO_DEPS` / `--no-deps`\n  - `PRINT_PLAN` / `--print-plan`\n\n## Algorithm (must be explicit + testable)\n1) **Start set**\n- If `--only` provided: start set = ONLY_MODULES\n- Else if `--only-phase`: start set = all modules in those phases\n- Else: start set = `enabled_by_default` modules\n\n2) **Apply skips**\n- Remove any `SKIP_MODULES`.\n- (Optional if we choose): expand `SKIP_TAGS` / `SKIP_CATEGORIES` into concrete module IDs using manifest_index maps.\n\n3) **Dependency closure (default)**\n- Unless `--no-deps`, expand the start set by adding all transitive deps using `ACFS_MODULE_DEPS`.\n- `--no-deps` MUST print a prominent warning.\n\n4) **Skip safety**\n- If a required dependency is skipped, fail early with an actionable message:\n  - show the module, the missing dep, and at least one dependency chain.\n\n5) **Derive deterministic ordered plan**\n- `ACFS_EFFECTIVE_PLAN=(...)` should be computed by filtering `ACFS_MODULES_IN_ORDER`.\n- `should_run_module` becomes a cheap membership test (`ACFS_EFFECTIVE_RUN[module]=1`).\n\n6) **Plan/introspection outputs**\n- `--print-plan` prints the deterministic plan and exits (no state mutation).\n- `--list-modules` lists available modules using manifest_index data (never hard-coded).\n\n## Error semantics\n- Unknown module id (in `--only`/`--skip`) =\u003e hard error.\n- Unknown phase =\u003e hard error.\n- `--skip` that breaks deps =\u003e hard error.\n\n## Acceptance criteria\n- Behavior matches the spec examples in `mjt.1.2`.\n- Output is stable/diffable and does not mutate state.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:24.946744-05:00","updated_at":"2025-12-21T16:25:11.196768-05:00","closed_at":"2025-12-21T16:25:11.196768-05:00","close_reason":"Implemented acfs_resolve_selection in scripts/lib/selection.sh with dependency closure, skip safety validation, and --print-plan support. All 10 tests pass.","labels":["installer"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.5.4","depends_on_id":"agentic_coding_flywheel_setup-mjt.5","type":"parent-child","created_at":"2025-12-21T13:49:24.947105-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.5.4","depends_on_id":"agentic_coding_flywheel_setup-mjt.5.3","type":"blocks","created_at":"2025-12-21T13:49:25.809089-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.5.5","title":"Preserve legacy flags by mapping to tags/modules","description":"## Goal\nKeep wizard and docs working while changing internal implementation.\n\n## Why this matters (user impact)\nIf we break existing flags, beginners will follow the wizard/README and hit confusing behavior drift (“the docs say X but the installer did Y”). This task ensures compatibility while still allowing the manifest-driven engine to be the only real source of behavior.\n\n## Requirements\n### 1) Legacy flags become pure selection config\nExisting flags (example set; confirm via inventory):\n- `--skip-postgres`\n- `--skip-vault`\n- `--skip-cloud`\n\nMust be implemented as:\n- adding module IDs to `SKIP_MODULES`, and/or\n- adding tags/categories to `SKIP_TAGS` / `SKIP_CATEGORIES` (if we implement them)\n\n### 2) No special-case installation logic\n- No `if [[ $SKIP_CLOUD == 1 ]]; then ... fi` inside install steps.\n- The orchestrator should just execute the resolved plan; selection decides what’s included.\n\n### 3) Prevent drift\n- Prefer mapping to tags/categories derived from `manifest_index.sh` so the mapping stays in sync as modules evolve.\n- At minimum: keep the mapping table documented in the plan doc and validated by tests.\n\n## Acceptance criteria\n- Running install with legacy flags produces the same behavior as before.\n- Legacy flags are wrappers over the manifest selection engine.\n- `--print-plan` shows legacy-derived skips as explicit exclusions.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:25.119663-05:00","updated_at":"2025-12-21T16:27:29.028725-05:00","closed_at":"2025-12-21T16:27:29.028725-05:00","close_reason":"Legacy flag mapping complete: --skip-postgres, --skip-vault, --skip-cloud map to module IDs via acfs_apply_legacy_skips(). Committed in 9a14e58. Tests pass, --print-plan shows legacy-derived skips.","labels":["installer"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.5.5","depends_on_id":"agentic_coding_flywheel_setup-mjt.5","type":"parent-child","created_at":"2025-12-21T13:49:25.12001-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.5.5","depends_on_id":"agentic_coding_flywheel_setup-mjt.5.4","type":"blocks","created_at":"2025-12-21T13:49:25.99067-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.5.6","title":"Add feature flags for incremental category rollout (generated vs legacy)","description":"## Goal\nMake the migration safe and reversible without commented-out code.\n\n## Why this matters\nThis refactor touches `install.sh` (high-risk). Feature flags let us roll out manifest-driven installs category-by-category while preserving a reliable rollback path.\n\n## Requirements\n- Provide a **global** toggle:\n  - `ACFS_USE_GENERATED=0|1` (default 1 once migration begins)\n- Provide **per-category** toggles so we can migrate incrementally:\n  - e.g. `ACFS_USE_GENERATED_BASE`, `..._SHELL`, `..._LANG`, `..._AGENTS`, `..._CLOUD`, `..._STACK`, `..._ACFS`\n\nBehavior:\n- If per-category toggle is set, it overrides the global.\n- If toggles are unset, default behavior is “use generated for migrated categories; legacy for unmigrated categories”.\n\n## Guardrails\n- The orchestrator remains the single owner of:\n  - state/resume\n  - `run_phase` framing\n  - `try_step` / `report_failure`\n- Feature flags must not bypass those wrappers; they only choose *which installer function* to invoke.\n\n## Acceptance criteria\n- A maintainer can flip one env var to force legacy behavior for a category (for debugging / rollback).\n- No commented legacy code blocks; rollback paths remain executable.\n- Plan/test coverage ensures both paths stay working during migration.\n","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T13:49:25.280291-05:00","updated_at":"2025-12-21T16:44:14.16022-05:00","labels":["installer"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.5.6","depends_on_id":"agentic_coding_flywheel_setup-mjt.5","type":"parent-child","created_at":"2025-12-21T13:49:25.280659-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.5.6","depends_on_id":"agentic_coding_flywheel_setup-mjt.5.4","type":"blocks","created_at":"2025-12-21T13:49:26.134611-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.5.7","title":"Create scripts/lib/install_helpers.sh (run_as_*_shell + exec helpers)","description":"## Goal\nProvide a small, well-tested installer helper library that generated modules can rely on.\n\n## Why this matters\nThe generator should emit install/verify steps as multi-line scripts (heredocs) executed under the correct user context. If we don’t provide a standard run-as-shell abstraction, we’ll end up with ad-hoc `bash -lc ...` calls, inconsistent PATH behavior, and subtle quoting/pipefail bugs.\n\n## Requirements\n### 1) run-as shell helpers (heredoc-friendly)\n- `run_as_target_shell` executes stdin (or a string) as `TARGET_USER`.\n- `run_as_root_shell` executes stdin (or a string) as root.\n- `run_as_current_shell` executes stdin (or a string) as the current user.\n\nEach helper must:\n- support multi-line scripts and pipes reliably\n- enforce strict mode *inside the executed shell* (`set -euo pipefail`)\n- preserve correct PATH (especially for target user installs)\n\n### 2) command existence helpers\n- `command_exists` (current user)\n- `command_exists_as_target` (target user)\n\n### 3) compatibility constraints\n- Must compose with existing `run_as_target` logic (don’t break existing call sites).\n- Must work when `TARGET_USER` is already the current user.\n- Must not introduce side effects at source-time.\n\n## Acceptance criteria\n- Generated modules can execute both one-liner and heredoc install steps correctly.\n- A multi-line heredoc with pipes fails correctly under strict mode.\n- ShellCheck passes for the helper library.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T14:08:09.789132-05:00","updated_at":"2025-12-21T15:54:38.323237-05:00","closed_at":"2025-12-21T15:54:38.323237-05:00","close_reason":"Completed","labels":["installer","lib"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.5.7","depends_on_id":"agentic_coding_flywheel_setup-mjt.5","type":"parent-child","created_at":"2025-12-21T14:08:09.789755-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.5.8","title":"Integrate manifest-driven execution with resume/state + error reporting","description":"## Goal\nEnsure the new manifest-driven execution path *improves* reliability rather than regressing it.\n\n## Why this matters\nMultiple open reliability epics are upgrading `install.sh` with:\n- resume/state persistence\n- phase wrappers\n- structured error reporting\n- checksum recovery + skip tracking\n\nIf we refactor `install.sh` without explicitly integrating those systems, we risk shipping a “clean architecture” that is worse for beginners (harder to recover from failures).\n\n## Scope\n- The orchestrator remains the owner of:\n  - state.json persistence\n  - phase framing (`run_phase`)\n  - step-level error context (`try_step` / `report_failure`)\n  - skip tracking + end-of-install reporting\n- Generated module functions remain simple:\n  - validate contract at entry\n  - run their install/verify logic\n  - return status (optional modules may degrade gracefully)\n\n## Integration requirements\n- Wrap category/phase entrypoints with `run_phase` (or equivalent).\n- Wrap module invocations as `try_step \"module:\u003cid\u003e\" install_\u003c...\u003e` so failures point to the exact module.\n- Record module outcomes in state:\n  - failed module id\n  - completed module ids (preferred for deep resume)\n  - skipped module/tool reasons (checksum mismatch, network error after retries, optional failure, etc.)\n- Ensure `--print-plan` and `--list-modules` do not mutate state.\n\n## Acceptance criteria\n- A failed module clearly reports:\n  - phase\n  - module id\n  - suggested fix (via ERROR_PATTERNS if available)\n- Skipped tools/modules surface as “intentionally skipped” (not “missing”) in:\n  - end-of-install summary (`agentic_coding_flywheel_setup-8z5`)\n  - doctor output (`agentic_coding_flywheel_setup-qup`)\n- Resume behavior does not regress after refactor.\n\n## Notes\nThis task is intentionally blocked by the core reliability primitives so we integrate once, not twice.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T14:08:21.108486-05:00","updated_at":"2025-12-21T16:34:05.466563-05:00","closed_at":"2025-12-21T16:34:05.466563-05:00","close_reason":"Integrated state.sh/report.sh reliability libs, wrapped phases with run_phase(), added structured error reporting","labels":["installer","reliability"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.5.8","depends_on_id":"agentic_coding_flywheel_setup-mjt.5","type":"parent-child","created_at":"2025-12-21T14:08:21.111821-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.5.8","depends_on_id":"agentic_coding_flywheel_setup-mjt.5.4","type":"blocks","created_at":"2025-12-21T14:09:00.613259-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.5.8","depends_on_id":"agentic_coding_flywheel_setup-uxc","type":"blocks","created_at":"2025-12-21T14:09:00.814968-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.5.8","depends_on_id":"agentic_coding_flywheel_setup-yaj","type":"blocks","created_at":"2025-12-21T14:09:01.004753-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.5.8","depends_on_id":"agentic_coding_flywheel_setup-qqo","type":"blocks","created_at":"2025-12-21T14:09:01.197676-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.5.8","depends_on_id":"agentic_coding_flywheel_setup-5zm","type":"blocks","created_at":"2025-12-21T14:09:01.404498-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.5.8","depends_on_id":"agentic_coding_flywheel_setup-8z5","type":"related","created_at":"2025-12-21T14:28:09.978881-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.5.8","depends_on_id":"agentic_coding_flywheel_setup-qup","type":"related","created_at":"2025-12-21T14:28:10.123317-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.6","title":"Phase 5: Testing + CI for manifest-driven installs","description":"## Purpose\nMake the refactor safe by adding targeted tests that prevent regressions.\n\n## Test requirements\n- Offline curl|bash bootstrap simulation test\n- Selection safety tests (dependency closure, skip-dep failure)\n- Existing Docker integration tests remain passing\n- CI drift check for generated scripts\n\n## Acceptance criteria\n- CI fails if generated outputs drift from manifest.\n- CI exercises the curl|bash bootstrap code path without network.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T13:47:14.513673-05:00","updated_at":"2025-12-21T13:47:14.513673-05:00","labels":["ci","installer","tests"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.6","depends_on_id":"agentic_coding_flywheel_setup-mjt","type":"parent-child","created_at":"2025-12-21T13:47:14.514034-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.6","depends_on_id":"agentic_coding_flywheel_setup-mjt.5","type":"blocks","created_at":"2025-12-21T13:47:15.419049-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.6.1","title":"Add offline curl|bash bootstrap simulation test","description":"## Goal\nPrevent regressions in the `curl|bash` bootstrap code path (especially after future refactors).\n\n## Requirements\n- Test runs with **no network** by simulating `SCRIPT_DIR=\"\"` while using a **local archive copy**.\n- Validate the happy path:\n  - bootstrap chooses the archive path\n  - extraction succeeds\n  - `bash -n` validation runs on sourced scripts\n  - sourcing libs + generated scripts works\n  - coherence check passes (`acfs.manifest.yaml` matches `ACFS_MANIFEST_SHA256`)\n\nNice-to-have negative coverage (if cheap):\n- Break coherence (e.g., swap manifest file) and ensure bootstrap aborts with “bootstrap mismatch”.\n\n## Acceptance criteria\n- CI runs this test on every push.\n- Failures are crisp and point at bootstrap validation (not later in the install).\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:26.303655-05:00","updated_at":"2025-12-21T14:27:01.315941-05:00","labels":["installer","tests"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.6.1","depends_on_id":"agentic_coding_flywheel_setup-mjt.6","type":"parent-child","created_at":"2025-12-21T13:49:26.30408-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.6.2","title":"Add selection safety tests (--only deps closure, --skip dep failure)","description":"## Goal\nEnsure selection logic is predictable, safe, and remains stable as modules evolve.\n\n## Required coverage\n- `--only \u003cmodule\u003e` expands dependencies by default (plan includes deps before the target where needed).\n- `--no-deps` disables closure and prints a prominent warning.\n- `--skip \u003cdep\u003e` that breaks a required dependency fails early with an actionable error.\n\n## Recommended extra coverage (cheap, prevents footguns)\n- Unknown module id in `--only/--skip` fails fast.\n- Unknown phase in `--only-phase` fails fast.\n- `--print-plan` output is deterministic (stable ordering) and does not mutate state.\n- Legacy flags (e.g., `--skip-vault`) map into the same selection engine (at least one golden test).\n\n## Acceptance criteria\n- Tests encode the “golden path” examples from `mjt.1.2` so docs/spec can’t drift.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:26.466872-05:00","updated_at":"2025-12-21T14:27:09.243909-05:00","labels":["installer","tests"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.6.2","depends_on_id":"agentic_coding_flywheel_setup-mjt.6","type":"parent-child","created_at":"2025-12-21T13:49:26.467226-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.6.2","depends_on_id":"agentic_coding_flywheel_setup-mjt.6.1","type":"blocks","created_at":"2025-12-21T13:49:26.771646-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.6.3","title":"Update CI workflows for manifest sync + bootstrap simulation","description":"## Goal\nMake drift and bootstrap regressions impossible to merge.\n\n## Requirements\n- Drift enforcement:\n  - CI runs generator and fails if `scripts/generated/**` differs from what the manifest produces.\n  - Prefer using generator `--validate/--diff` workflows once available.\n\n- Shell safety checks:\n  - `bash -n` on sourced scripts (libs + generated).\n  - ShellCheck on installer scripts (where applicable).\n\n- Installer path coverage:\n  - Run the offline `curl|bash` bootstrap simulation test (`mjt.6.1`).\n  - Run selection safety tests (`mjt.6.2`).\n\n## Acceptance criteria\n- CI blocks merges on any drift, syntax error, or bootstrap regression.\n- Bootstrap simulation runs without network so it’s reliable in CI.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T13:49:26.629053-05:00","updated_at":"2025-12-21T14:27:16.3678-05:00","labels":["ci","tests"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.6.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.6","type":"parent-child","created_at":"2025-12-21T13:49:26.629406-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.6.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.6.1","type":"blocks","created_at":"2025-12-21T13:49:26.921026-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.7","title":"Phase 6: Documentation + maintainer workflow","description":"## Purpose\nDocument the *new* contract so future changes don’t reintroduce drift.\n\n## Scope\n- Update README in existing sections (no new “contributing” content).\n- Add an internal maintainer guide for adding/updating modules safely.\n- Update wizard/docs to prefer tagged releases for curl|bash installs.\n\n## Acceptance criteria\n- Docs match reality (no “two universes”).\n- Internal-only posture preserved.\n","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T13:47:14.682393-05:00","updated_at":"2025-12-21T13:47:14.682393-05:00","labels":["docs","installer","manifest"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.7","depends_on_id":"agentic_coding_flywheel_setup-mjt","type":"parent-child","created_at":"2025-12-21T13:47:14.682737-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.7","depends_on_id":"agentic_coding_flywheel_setup-mjt.6","type":"blocks","created_at":"2025-12-21T13:47:15.564642-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.7.1","title":"Update user docs for new selection + curl|bash ref pinning","description":"## Goal\nMake user-facing documentation match the new reality.\n\n## Requirements\n- Document:\n  - prefer tagged releases for curl|bash installs\n  - `--only/--skip/--print-plan` behavior\n- Integrate into existing README sections (no new contributor language)\n\n## Related\n- Coordinate with existing README umbrella issue(s).\n","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T13:49:27.085569-05:00","updated_at":"2025-12-21T13:49:27.085569-05:00","labels":["docs"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.7.1","depends_on_id":"agentic_coding_flywheel_setup-mjt.7","type":"parent-child","created_at":"2025-12-21T13:49:27.085966-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.7.1","depends_on_id":"agentic_coding_flywheel_setup-kgf","type":"related","created_at":"2025-12-21T13:49:51.031101-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.7.2","title":"Write internal maintainer guide: adding modules + regenerating safely","description":"## Goal\nFuture-proof: make it easy to add modules without breaking invariants.\n\n## Must cover\n- Adding module fields correctly (phase/run_as/installed_check/verify)\n- Adding checksums\n- Running generator + drift checks\n- How to validate curl|bash bootstrap changes\n\n## Constraints\n- Internal-only posture; no “contributing” language.\n","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T13:49:27.243622-05:00","updated_at":"2025-12-21T13:49:27.243622-05:00","labels":["docs","manifest"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.7.2","depends_on_id":"agentic_coding_flywheel_setup-mjt.7","type":"parent-child","created_at":"2025-12-21T13:49:27.243989-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.7.2","depends_on_id":"agentic_coding_flywheel_setup-mjt.7.1","type":"blocks","created_at":"2025-12-21T13:49:27.561994-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mjt.7.3","title":"Add pre-commit/git-hook workflow to regenerate on manifest change","description":"## Goal\nReduce human error: don’t forget to regenerate `scripts/generated/**` when the manifest changes.\n\n## Requirements\n- Provide a simple workflow that runs regeneration when relevant files change:\n  - `acfs.manifest.yaml`\n  - `packages/manifest/**` (generator)\n- Hook/workflow must be:\n  - fast enough to be usable\n  - optional convenience (CI remains the enforcement layer)\n\n## Constraints\n- Keep it simple.\n- Use Bun for any JS/TS generator invocation.\n- Do not introduce new lockfiles or heavy hook frameworks.\n\n## Acceptance criteria\n- Maintainers have an easy “default” path that keeps generated outputs in sync.\n- CI still fails on drift even if someone bypasses local hooks.\n","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T13:49:27.409057-05:00","updated_at":"2025-12-21T14:27:26.814162-05:00","labels":["docs","tooling"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-mjt.7.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.7","type":"parent-child","created_at":"2025-12-21T13:49:27.409412-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-mjt.7.3","depends_on_id":"agentic_coding_flywheel_setup-mjt.7.1","type":"blocks","created_at":"2025-12-21T13:49:27.702769-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-mwh","title":"Create VPS provider guides (OVH, Contabo, Hetzner)","description":"# Task: Create VPS Provider Guides\n\n## Description\nCreate detailed provider-specific guides with screenshots.\n\n## Location\n- scripts/providers/ovh.md\n- scripts/providers/contabo.md\n- scripts/providers/hetzner.md\n\n## Each Guide Contains\n\n### Provider Overview\n- Price range for recommended specs\n- Pros/cons\n- Direct signup link\n\n### Step-by-Step with Screenshots\n1. Navigate to VPS section\n2. Select Ubuntu 25.x image\n3. Choose specs (~$50/mo tier)\n4. Add SSH key (screenshot of where)\n5. Create server\n6. Find IP address (screenshot)\n\n### Provider Quirks\n- Default username (root vs ubuntu)\n- Firewall setup needed?\n- Any DNS/network setup needed?\n\n## Screenshot Placeholders\nUse consistent naming:\n- ovh-step1-select-os.png\n- ovh-step2-add-ssh-key.png\n- etc.\n\n## Integration\nWebsite wizard step 5 loads these guides dynamically.\n\n## Acceptance Criteria\n- [ ] Guide for OVH\n- [ ] Guide for Contabo\n- [ ] Guide for Hetzner\n- [ ] Screenshot placeholders\n- [ ] Consistent format","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:38:16.271045-05:00","updated_at":"2025-12-20T12:25:21.350296-05:00","closed_at":"2025-12-20T12:25:21.350296-05:00","close_reason":"Created comprehensive VPS setup guides for OVH, Contabo, and Hetzner. Each guide includes provider overview, pros/cons, step-by-step instructions, and provider-specific notes. Screenshot placeholders included. Commit 8c725ed.","labels":["documentation","task"]}
{"id":"agentic_coding_flywheel_setup-my5","title":"acfs update should not abort early when bun is missing","description":"scripts/lib/update.sh runs under set -euo pipefail; update_agents/update_cloud return 1 when bun is missing, which aborts the whole update run and skips unrelated updates (rust/uv/etc). Treat missing bun as a recorded failure (increment FAIL_COUNT) but return 0 so the updater continues and summarizes.","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-20T15:37:57.713727-05:00","updated_at":"2025-12-20T15:38:42.384269-05:00","closed_at":"2025-12-20T15:38:42.384269-05:00","close_reason":"Make scripts/lib/update.sh treat missing bun as a recorded failure (FAIL_COUNT) but return 0 so remaining updates continue under set -euo pipefail.","labels":["reliability","tooling"]}
{"id":"agentic_coding_flywheel_setup-n7o","title":"Docs drift: README claims install.sh runs scripts/generated but it doesn't","description":"README architecture diagram/text indicates scripts/generated installer + doctor outputs are wired into install.sh, but install.sh currently contains its own phase logic and doesn't reference scripts/generated. Decide whether to integrate install.sh with generated scripts, or update README to match reality.","notes":"Updated README to clearly state scripts/generated outputs are reference/future and are not invoked by install.sh yet (see commit e891cbe).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T19:16:14.904067-05:00","updated_at":"2025-12-20T20:09:06.894046-05:00","closed_at":"2025-12-20T20:09:06.89405-05:00","labels":["architecture","docs"]}
{"id":"agentic_coding_flywheel_setup-nb4","title":"[ubu.6] Integrate upgrade phase into install.sh","description":"# Integrate Upgrade Phase into install.sh\n\n## Purpose\nWire the Ubuntu upgrade functionality into the main installer flow as \"Phase -1\" (before all other phases).\n\n## Changes to install.sh\n\n### New CLI Flags\n```bash\n# In parse_args()\n--skip-ubuntu-upgrade)\n    SKIP_UBUNTU_UPGRADE=true\n    ;;\n--target-ubuntu=*)\n    TARGET_UBUNTU_VERSION=\"${1#*=}\"\n    ;;\n```\n\n### New Global Variables\n```bash\n# Ubuntu upgrade options\nSKIP_UBUNTU_UPGRADE=false\nTARGET_UBUNTU_VERSION=\"25.10\"  # Default target\n```\n\n### Integration Point\nAdd before existing Phase 0 (preflight):\n```bash\nmain() {\n    # ... existing setup ...\n    \n    # Phase -1: Ubuntu Upgrade (before everything else)\n    if [[ \"$SKIP_UBUNTU_UPGRADE\" != \"true\" ]]; then\n        run_ubuntu_upgrade_phase\n    fi\n    \n    # Phase 0: Preflight\n    run_preflight_checks\n    \n    # ... rest of phases ...\n}\n```\n\n### New Function: run_ubuntu_upgrade_phase()\n```bash\nrun_ubuntu_upgrade_phase() {\n    # Source upgrade library\n    source \"$ACFS_LIB_DIR/ubuntu_upgrade.sh\"\n    \n    log_section \"Ubuntu Version Check\"\n    \n    # Get current version\n    local current_version=$(ubuntu_get_version_string)\n    log_info \"Current Ubuntu version: $current_version\"\n    \n    # Check if upgrade needed\n    if ubuntu_version_gte \"$current_version\" \"$TARGET_UBUNTU_VERSION\"; then\n        log_success \"Ubuntu $current_version meets target ($TARGET_UBUNTU_VERSION)\"\n        return 0\n    fi\n    \n    # Calculate upgrade path\n    local upgrade_path=$(ubuntu_calculate_upgrade_path \"$TARGET_UBUNTU_VERSION\")\n    log_info \"Upgrade path: $current_version → $upgrade_path → $TARGET_UBUNTU_VERSION\"\n    \n    # Run preflight checks\n    if ! ubuntu_preflight_checks; then\n        log_error \"Preflight checks failed. Cannot proceed with upgrade.\"\n        log_info \"Use --skip-ubuntu-upgrade to bypass (not recommended)\"\n        exit 1\n    fi\n    \n    # Save original args for resume after reboot\n    export ACFS_ORIGINAL_ARGS=\"$*\"\n    \n    # Initialize upgrade state\n    state_upgrade_init \"$current_version\" \"$TARGET_UBUNTU_VERSION\" \"$upgrade_path\"\n    \n    # Setup resume service\n    ubuntu_setup_resume\n    \n    # Start upgrade\n    log_step \"Starting Ubuntu upgrade to $TARGET_UBUNTU_VERSION\"\n    log_warn \"This will take 30-60 minutes per version and require reboots.\"\n    log_warn \"SSH sessions will disconnect. Reconnect after reboot.\"\n    \n    ubuntu_do_upgrade\n    \n    # If we get here, reboot is needed\n    ubuntu_trigger_reboot\n    \n    # Script exits here - resume service takes over after reboot\n}\n```\n\n## Resume Detection\n\nWhen install.sh runs after reboot, detect if we are resuming:\n```bash\n# At start of main()\nif state_upgrade_get_stage == \"awaiting_reboot\"; then\n    # This is a resume - upgrade service should handle it\n    # But if user manually runs install.sh, resume gracefully\n    log_info \"Detected in-progress upgrade. Checking status...\"\n    run_ubuntu_upgrade_phase  # Will continue upgrade chain\nfi\n```\n\n## Documentation Updates\n\nUpdate install.sh header comments with new flags:\n```bash\n#   --skip-ubuntu-upgrade  Skip automatic Ubuntu version upgrade\n#   --target-ubuntu=VER    Set target Ubuntu version (default: 25.10)\n```\n\n## Error Handling\n\nIf upgrade fails:\n1. Log error to /var/log/acfs/upgrade.log\n2. Set error state in state.json\n3. Print recovery instructions\n4. Exit with non-zero code\n\nUser can then:\n- Fix the issue manually\n- Re-run install.sh (will detect failed state and offer options)\n- Use --skip-ubuntu-upgrade to proceed on current version","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T16:22:11.33453-05:00","updated_at":"2025-12-21T16:22:11.33453-05:00","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-nb4","depends_on_id":"agentic_coding_flywheel_setup-auf","type":"blocks","created_at":"2025-12-21T16:23:36.629339-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-nb4","depends_on_id":"agentic_coding_flywheel_setup-0ge","type":"blocks","created_at":"2025-12-21T16:23:36.876802-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-nb4","depends_on_id":"agentic_coding_flywheel_setup-lhe","type":"blocks","created_at":"2025-12-21T16:26:43.088899-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-nb4","depends_on_id":"agentic_coding_flywheel_setup-cxr","type":"blocks","created_at":"2025-12-21T16:26:43.266262-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-nb4","depends_on_id":"agentic_coding_flywheel_setup-itb","type":"blocks","created_at":"2025-12-21T16:26:43.439406-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-nna","title":"Add automatic retry for transient network errors","description":"# Task: Add automatic retry for transient network errors\n\n## Purpose\nHandle temporary network issues gracefully without user intervention.\n\n## Retry Strategy\n\n### Timing: Immediate → 5s → 15s\n**Rationale for these intervals:**\n- **Immediate retry (0s):** Many transient errors clear instantly (TCP reset, brief DNS hiccup)\n- **5 second wait:** Enough for most CDN/routing issues to resolve\n- **15 second wait:** Handles rate limiting, brief outages\n- **Total wait:** 20 seconds max - fast enough to not frustrate users\n\n```bash\nRETRY_DELAYS=(0 5 15)  # Immediate, then 5s, then 15s\n\nretry_with_backoff() {\n    local cmd=\"$1\"\n    local description=\"$2\"\n    local max_attempts=${#RETRY_DELAYS[@]}\n    \n    for ((attempt=0; attempt\u003cmax_attempts; attempt++)); do\n        local delay=${RETRY_DELAYS[$attempt]}\n        \n        if ((attempt \u003e 0)); then\n            log_info \"Retry $attempt/$((max_attempts-1)) for $description (waiting ${delay}s)...\"\n            sleep \"$delay\"\n        fi\n        \n        if eval \"$cmd\" 2\u003e/dev/null; then\n            ((attempt \u003e 0)) \u0026\u0026 log_info \"Succeeded on retry $attempt\"\n            return 0\n        fi\n    done\n    \n    return 1\n}\n```\n\n### Retryable Errors\nOnly retry for transient network issues:\n```bash\nis_retryable_error() {\n    local exit_code=\"$1\"\n    local stderr=\"$2\"\n    \n    # curl exit codes for network issues\n    case \"$exit_code\" in\n        6)  return 0 ;;  # Could not resolve host\n        7)  return 0 ;;  # Failed to connect\n        28) return 0 ;;  # Operation timeout\n        35) return 0 ;;  # SSL connect error\n        52) return 0 ;;  # Empty reply\n        56) return 0 ;;  # Network receive error\n    esac\n    \n    # Check stderr for common transient messages\n    if [[ \"$stderr\" =~ (timeout|timed.out|connection.refused|temporarily) ]]; then\n        return 0\n    fi\n    \n    return 1  # Not retryable\n}\n```\n\n### Integration with fetch_and_run()\n```bash\nverified_fetch_and_run() {\n    local url=\"$1\"\n    local checksum=\"$2\"\n    local name=\"$3\"\n    shift 3\n    \n    retry_with_backoff \\\n        \"verify_checksum \\\"$url\\\" \\\"$checksum\\\" \\\"$name\\\"\" \\\n        \"fetching $name\"\n    \n    local status=$?\n    if ((status \\!= 0)); then\n        log_error \"Failed to fetch $name after ${#RETRY_DELAYS[@]} attempts\"\n        return 1\n    fi\n    \n    # Content already verified, now run\n    verified_content | bash -s -- \"$@\"\n}\n```\n\n## Non-Retryable Scenarios\n- HTTP 404 (script doesnt exist)\n- HTTP 403 (permission denied)\n- Checksum mismatch (not a network issue)\n- Script execution errors\n\n## Dependencies\n- Used by: security.sh fetch functions\n- Used by: install.sh download operations\n\n## Acceptance Criteria\n- [ ] Retry delays: 0s, 5s, 15s (total 20s max)\n- [ ] Only retries network-related curl errors\n- [ ] Clear logging of retry attempts\n- [ ] Does not retry checksum mismatches\n- [ ] Does not retry HTTP 4xx errors","notes":"Implementing retry-with-backoff for transient curl failures in scripts/lib/security.sh (0s/5s/15s).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T12:50:37.817313-05:00","updated_at":"2025-12-21T15:02:52.336748-05:00","closed_at":"2025-12-21T15:02:52.336748-05:00","close_reason":"Added retry-with-backoff (0/5/15s) for transient curl failures. Implemented acfs_curl_with_retry_and_sentinel() in scripts/lib/security.sh and wired into fetch_checksum()/verify_checksum(). Added the same retry logic to install.sh's acfs_fetch_url_content() and used it for remote checksums.yaml fetch.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-nna","depends_on_id":"agentic_coding_flywheel_setup-qqo","type":"blocks","created_at":"2025-12-21T12:51:28.919648-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-obi","title":"Implement Dicklesworthstone stack updates","description":"## What\nImplement the 'stack' category for acfs-update. This is the most complex category because these tools use verified installers.\n\nTools to update:\n- NTM (Named Tmux Manager)\n- MCP Agent Mail\n- UBS (Ultimate Bug Scanner)\n- BV (Beads Viewer)\n- CASS (Coding Agent Session Search)\n- CM (CASS Memory System)\n- CAAM (Coding Agent Account Manager)\n- SLB (Simultaneous Launch Button)\n\n## Technical Details\n- Most tools: Re-run installer from GitHub (handles update logic internally)\n- MCP Agent Mail: Special case - git pull + uv sync in ~/mcp_agent_mail\n- For updates (not fresh installs), we trust the GitHub repos directly\n- No checksum verification needed for updates - installer scripts are trusted\n\n## Update Flow for Each Tool\n1. Check if installed (binary exists)\n2. Capture current version\n3. Run installer with appropriate flags (e.g., --update, --yes)\n4. Capture new version\n5. Log the change\n\n## Considerations\n- Unlike fresh installs, we don't verify checksums for updates\n- The installer scripts themselves handle idempotent updates\n- MCP Agent Mail is different (git-based, not binary releases)\n- Some tools may not have --update flag - reinstall is safe\n\n## Success Criteria\n- [ ] All 8 stack tools update correctly\n- [ ] MCP Agent Mail git pull + uv sync works\n- [ ] Skips uninstalled tools\n- [ ] Version changes logged\n- [ ] No checksum errors (we bypass for updates)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:26:42.374382-05:00","updated_at":"2025-12-21T13:32:19.419493-05:00","closed_at":"2025-12-21T13:32:19.419493-05:00","close_reason":"Replaced by agentic_coding_flywheel_setup-d0g which includes proper checksum verification. The original 'bypass checksums' approach was a security vulnerability.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-obi","depends_on_id":"agentic_coding_flywheel_setup-75e","type":"blocks","created_at":"2025-12-21T13:27:25.347073-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-pom","title":"Implement ACFS self-update","description":"## What\nBefore updating other components, acfs-update should update itself:\n1. git pull in ~/.acfs (or wherever ACFS is installed)\n2. Re-source the update script if it changed\n3. Continue with other updates using latest logic\n\n## Why This Matters\n- Ensures we have the latest update logic before updating tools\n- Fixes any bugs in the update process itself\n- Keeps checksums.yaml current (though not used for updates)\n\n## Technical Details\n- ACFS installed at ~/.acfs or detected via ACFS_HOME env var\n- git pull --ff-only to avoid merge conflicts\n- If update script changed, need to re-exec with same args\n\n## Considerations\n- What if git pull fails? (network, conflicts)\n- Should we require this, or make it optional?\n- Re-exec is tricky - need to preserve all args and state\n\n## Decision\nMake self-update automatic but non-fatal. If it fails, warn and continue with current version.\n\n## Success Criteria\n- [ ] ACFS self-updates on each run\n- [ ] Handles git pull failures gracefully\n- [ ] Re-exec works if script changed (or skip re-exec v1)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:26:45.271437-05:00","updated_at":"2025-12-21T13:31:43.349328-05:00","closed_at":"2025-12-21T13:31:43.349328-05:00","close_reason":"Out of scope for v1. ACFS is not git-cloned to ~/.acfs, so self-update requires re-running the installer. Users can do this manually. Consider for v2 after changing install to use git clone.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-pom","depends_on_id":"agentic_coding_flywheel_setup-75e","type":"blocks","created_at":"2025-12-21T13:27:25.670496-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-q10","title":"Harden installer: true dry-run, onboard source, HTTPS PGDG","description":"Fix install.sh --dry-run so it makes no system changes and works without sudo; install onboard command from packages/onboard/onboard.sh (single source of truth); switch PGDG apt repo URL to HTTPS; fix checksum computation in scripts/lib/security.sh.","status":"closed","priority":1,"issue_type":"bug","assignee":"FuchsiaCreek","created_at":"2025-12-20T13:18:40.054877-05:00","updated_at":"2025-12-20T13:22:16.261425-05:00","closed_at":"2025-12-20T13:22:16.261425-05:00","close_reason":"Fixed install.sh dry-run to make no system changes + allow running without sudo; install onboard from packages/onboard; switch PGDG repo to HTTPS; fix security.sh checksum logic."}
{"id":"agentic_coding_flywheel_setup-qqo","title":"Create error context tracking globals and try_step() wrapper","description":"# Task: Create error context tracking globals and try_step() wrapper\n\n## Context\nPart of EPIC: Per-Phase Error Reporting (agentic_coding_flywheel_setup-fkf)\n\n## What to Do\nAdd error context tracking to capture exactly where failures occur:\n\n### Global Variables\n```bash\nCURRENT_PHASE=\"\"\nCURRENT_PHASE_NAME=\"\"\nCURRENT_STEP=\"\"\nLAST_ERROR=\"\"\nLAST_ERROR_CODE=\"\"\n```\n\n### try_step() Function\nWrapper for individual operations within a phase:\n```bash\ntry_step \"description\" command args...\n# - Sets CURRENT_STEP\n# - Saves state (for resume granularity)\n# - Captures output and exit code\n# - On failure: sets LAST_ERROR, returns 1\n```\n\n## Acceptance Criteria\n- Every installation command wrapped with try_step\n- Error output captured (not just exit code)\n- Current step visible in state.json for debugging\n- Works with pipes and complex commands\n\n## Implementation Notes\n- Use eval for complex commands\n- Capture both stdout and stderr\n- Truncate very long errors for display\n\n## Files to Modify\n- install.sh: Add globals and try_step function","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T12:43:57.840225-05:00","updated_at":"2025-12-21T14:43:08.613653-05:00","closed_at":"2025-12-21T14:43:08.613653-05:00","close_reason":"Created scripts/lib/error_tracking.sh with try_step(), try_step_optional(), try_step_retry(), phase management, and error reporting functions"}
{"id":"agentic_coding_flywheel_setup-qup","title":"Show skipped tools in acfs doctor output","description":"# Task: Show skipped tools in acfs doctor output\n\n## Purpose\nWhen doctor runs, clearly show which tools were intentionally skipped vs which failed unexpectedly.\n\n## Critical Distinction: Intentional Skip vs Bug\n\n**Problem:** Without this distinction, doctor output is confusing:\n- User intentionally skipped `ohmyzsh` via checksum prompt\n- Doctor shows: `[✗] ohmyzsh: not found`\n- User thinks: \"Did installation break?\"\n\n**Solution:** Track skip reasons and display appropriately.\n\n### Skip Tracking in state.json\n```json\n{\n  \"skipped_tools\": {\n    \"ohmyzsh\": {\n      \"reason\": \"checksum_mismatch\",\n      \"skipped_at\": \"2025-01-15T10:30:00Z\",\n      \"user_choice\": \"skip\"\n    },\n    \"atuin\": {\n      \"reason\": \"network_error\",\n      \"skipped_at\": \"2025-01-15T10:32:00Z\",\n      \"retries\": 3\n    }\n  }\n}\n```\n\n### Doctor Output Format\n```\nACFS Doctor Report\n==================\n\nInstalled Tools:\n  [✓] mise 2024.12.0\n  [✓] uv 0.5.0\n  [✓] bun 1.2.0\n  [✓] go 1.23.0\n  ...\n\nIntentionally Skipped:\n  [○] ohmyzsh - skipped (checksum mismatch, user choice)\n  [○] atuin - skipped (network error after 3 retries)\n\nMissing (unexpected):\n  [✗] lazygit - not found (should be installed by mise)\n  [✗] starship - not found\n\nLegend: [✓] installed  [○] skipped  [✗] missing\n```\n\n### Key Design Decisions\n\n1. **Use `[○]` for skipped** - visually distinct from `[✓]` (success) and `[✗]` (error)\n2. **Show skip reason** - user knows WHY it was skipped\n3. **Separate section** - dont mix intentional skips with failures\n4. **Missing = unexpected** - tools that SHOULD exist but dont\n\n### Implementation\n```bash\nshow_tool_status() {\n    local tool=\"$1\"\n    local state_file=\"$ACFS_STATE_DIR/state.json\"\n    \n    # Check if intentionally skipped\n    if jq -e \".skipped_tools.\\\"$tool\\\"\" \"$state_file\" \u0026\u003e/dev/null; then\n        local reason=$(jq -r \".skipped_tools.\\\"$tool\\\".reason\" \"$state_file\")\n        echo \"[○] $tool - skipped ($reason)\"\n        return\n    fi\n    \n    # Check if installed\n    if command -v \"$tool\" \u0026\u003e/dev/null; then\n        local version=$(\"$tool\" --version 2\u003e/dev/null | head -1 || echo \"installed\")\n        echo \"[✓] $tool $version\"\n    else\n        echo \"[✗] $tool - not found\"\n    fi\n}\n```\n\n## Dependencies\n- Depends on: state.json schema (agentic_coding_flywheel_setup-5zt)\n- Used by: doctor output formatting (agentic_coding_flywheel_setup-aqs)\n\n## Acceptance Criteria\n- [ ] Skipped tools tracked in state.json with reason\n- [ ] Doctor uses [○] symbol for intentional skips\n- [ ] Separate \"Intentionally Skipped\" section in output\n- [ ] Skip reason displayed (checksum/network/user choice)\n- [ ] Clear legend explaining symbols","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T12:50:40.525291-05:00","updated_at":"2025-12-21T15:08:37.008506-05:00","closed_at":"2025-12-21T15:08:37.008506-05:00","close_reason":"Implemented skipped tools display with [○] indicator, legend, and JSON support","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-qup","depends_on_id":"agentic_coding_flywheel_setup-8z5","type":"blocks","created_at":"2025-12-21T12:51:29.321854-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-qxr","title":"Generator: wrap upstream installer scripts with checksum verification","description":"acfs.manifest.yaml + scripts/generated/* currently embed unverified remote-script installs (curl|bash/sh). Align generator output with checksums.yaml + scripts/lib/security.sh so generated scripts execute upstream installers only after checksum verification, then regenerate outputs.","notes":"Generator now rewrites manifest curl|bash/sh installers to checksum-verified execution via scripts/lib/security.sh + checksums.yaml; regenerated scripts have no curl|bash.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T19:16:09.982883-05:00","updated_at":"2025-12-20T19:59:00.734907-05:00","closed_at":"2025-12-20T19:59:00.734909-05:00","labels":["generator","security"]}
{"id":"agentic_coding_flywheel_setup-ss3","title":"Add --json output mode to security.sh --verify","description":"# Task: Add --json output mode to security.sh --verify\n\n## Context\nPart of EPIC: Automated Upstream Checksum Monitoring (agentic_coding_flywheel_setup-4ou)\n\n## What to Do\nEnhance security.sh --verify to output JSON for automation:\n\n### Command\n```bash\n./scripts/lib/security.sh --verify --json\n```\n\n### Output Format\n```json\n{\n    \"timestamp\": \"2025-01-15T06:00:00Z\",\n    \"total\": 14,\n    \"matches\": [\n        {\"name\": \"bun\", \"checksum\": \"abc123...\"}\n    ],\n    \"mismatches\": [\n        {\n            \"name\": \"ntm\",\n            \"expected\": \"abc123...\",\n            \"actual\": \"def456...\",\n            \"url\": \"https://...\"\n        }\n    ],\n    \"errors\": [\n        {\"name\": \"broken\", \"error\": \"Fetch failed\"}\n    ]\n}\n```\n\n### Implementation\nCreate verify_all_json() function that builds JSON output.\n\n## Acceptance Criteria\n- --json flag produces valid JSON\n- All checksums verified and categorized\n- Mismatches include old and new values\n- Errors captured (network failures, etc.)\n\n## Files to Modify\n- scripts/lib/security.sh","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T12:45:51.791796-05:00","updated_at":"2025-12-21T14:48:46.932748-05:00","closed_at":"2025-12-21T14:48:46.932748-05:00","close_reason":"Implemented verify_all_installers_json() function with --json flag for automated verification. Outputs matches, mismatches, errors, and skipped arrays with timestamps."}
{"id":"agentic_coding_flywheel_setup-t0f","title":"[codex.7] Update onboard lesson 04 with account type clarification","description":"## Goal\nUpdate acfs/onboard/lessons/04_agents_login.md to clarify the ChatGPT account requirement.\n\n## Current State\nThe lesson already correctly describes running \"codex auth\" but doesn't explain:\n- That a ChatGPT Pro/Plus subscription is needed (not API account)\n- The difference between API accounts and ChatGPT accounts\n- That users may need to enable device access in ChatGPT settings\n\n## Updates Needed\n1. Add a note about ChatGPT Pro/Plus account requirement\n2. Mention the difference from API accounts\n3. Add troubleshooting if auth fails (check ChatGPT security settings)\n4. Keep the existing correct auth command instructions\n\n## Context for Users\nMany ACFS users may be developers familiar with OpenAI's API who:\n- Have API accounts with OPENAI_API_KEY\n- May NOT have ChatGPT Pro subscriptions\n- Need to understand these are separate things\n\n## Acceptance Criteria\n1. Clear mention of ChatGPT Pro/Plus account requirement\n2. Troubleshooting guidance for common issues\n3. No confusion with API accounts","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-21T16:26:23.414622-05:00","updated_at":"2025-12-21T16:44:11.41514-05:00","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-t0f","depends_on_id":"agentic_coding_flywheel_setup-ua5","type":"blocks","created_at":"2025-12-21T16:26:36.773325-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-t9i","title":"EPIC: Enhanced Doctor with Functional Tests","description":"# Epic: Enhanced Doctor with Functional Tests\n\n## Overview\nAdd --deep flag to acfs doctor that performs functional smoke tests, not just binary existence checks.\n\n## Problem Statement\nacfs doctor only checks if binaries exist, not if they work. It says 'All critical checks passed' but cc immediately fails with 'not authenticated'. Binary existence ≠ functional.\n\n## Business Impact\n- Auth issues are the most common post-install failure\n- Users copy aliases but skip authentication\n- Deep checks catch drift (tokens expire, configs corrupted)\n- Reduces 'it says it passed but nothing works' support tickets\n\n## Technical Approach\n1. Add --deep flag (default doctor stays fast)\n2. Agent auth checks: Claude config exists + test call, Codex OPENAI_API_KEY, Gemini credentials\n3. Database checks: PostgreSQL connection and role verification\n4. Cloud CLI checks: Vault configured, Wrangler/Supabase/Vercel auth status\n5. Token expiration warnings where applicable\n6. Cache results to avoid rate limiting\n\n## Success Criteria\n- --deep catches all auth configuration issues\n- Each check has actionable fix suggestion\n- 4 status levels: pass, warn, fail, info (skip)\n- Maintains backwards compatibility (default doctor unchanged)\n\n## Files to Modify\n- scripts/lib/doctor.sh: Add --deep flag and functional tests\n\n## Reference\nSee: docs/ROADMAP_INSTALLER_RELIABILITY.md Section 5","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-21T12:41:13.234724-05:00","updated_at":"2025-12-21T15:16:10.006918-05:00","closed_at":"2025-12-21T15:16:10.006918-05:00","close_reason":"EPIC complete - all children implemented: --deep flag (01s), agent auth checks (325), DB/cloud CLI checks (azw), run_deep_checks output (aqs), timeout/caching (lz1)","comments":[{"id":5,"issue_id":"agentic_coding_flywheel_setup-t9i","author":"jemanuel","text":"FYI: created `agentic_coding_flywheel_setup-mjt` (Manifest-Driven Installer Integration). This work will refactor `install.sh` to source generated installers + manifest_index and will touch selection semantics (`--only/--skip/--print-plan`) and curl|bash bootstrap (single archive).\n\nPlease keep this epic’s work compatible with your scope:\n- orchestration/state/error-reporting/preflight remains install.sh + scripts/lib owned\n- generated scripts stay source-safe (no top-level side effects)","created_at":"2025-12-21T18:50:07Z"}]}
{"id":"agentic_coding_flywheel_setup-tof","title":"Create README.md for the project","description":"# Task: Create README.md\n\n## Description\nWrite a clear, compelling README for the GitHub repository.\n\n## Structure\n\n### Hero Section\n- Project name and tagline\n- One-sentence description\n- Key value proposition\n\n### Quick Start\nFor users:\n```bash\n# Visit the wizard\nhttps://acfs.dev\n\n# Or paste this on your fresh Ubuntu VPS:\ncurl -fsSL \"https://...\" | bash -s -- --yes --mode vibe\n```\n\n### What Gets Installed\n- Shell environment (zsh, oh-my-zsh, powerlevel10k)\n- Languages (bun, uv, rust, go)\n- Coding agents (Claude, Codex, Gemini)\n- The Dicklesworthstone stack (8 tools)\n\n### Screenshots/GIFs\n- Wizard interface\n- Terminal after install\n- ntm in action\n\n### Development\nFor contributors:\n```bash\ngit clone ...\ncd apps/web\nbun install\nbun run dev\n```\n\n### Architecture\nBrief overview of:\n- apps/web (website)\n- install.sh (installer)\n- acfs/ (configs)\n- packages/ (shared code)\n\n## Do NOT Include\n- Contributing section (per AGENTS.md)\n- Badges (keep it clean)\n- Unnecessary sections\n\n## Acceptance Criteria\n- [ ] Clear value proposition\n- [ ] Quick start for end users\n- [ ] Development instructions\n- [ ] Architecture overview\n- [ ] No contributing section","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:28:03.971189-05:00","updated_at":"2025-12-20T12:11:01.650172-05:00","closed_at":"2025-12-20T12:11:01.650172-05:00","close_reason":"README.md created with comprehensive 700+ lines","labels":["documentation","task"]}
{"id":"agentic_coding_flywheel_setup-tx7","title":"EPIC: Checkpoint-Based Checksum Recovery","description":"# Epic: Checkpoint-Based Checksum Recovery\n\n## Overview\nHandle checksum mismatches gracefully by offering skip/continue options for non-critical tools instead of failing the entire installation.\n\n## Problem Statement\nIf ANY of 14 upstream tools fails checksum verification, entire install fails. One stale checksum on tool #8 wastes all progress from tools 1-7.\n\n## Business Impact\n- Checksum mismatches are usually legitimate updates, not attacks\n- Not all tools equally critical: missing ntm is annoying; missing bun is blocking\n- Completed phases should not be wasted by tool #9 failing\n\n## Technical Approach\n1. Classify tools as CRITICAL (bun, rust, uv, claude) vs RECOMMENDED (ntm, bv, cass, etc.)\n2. Critical mismatches: still abort (security-sensitive)\n3. Recommended mismatches: offer interactive skip/abort/proceed options\n4. Track skipped tools in state.json\n5. Report skipped tools at install completion with manual install commands\n6. Add --strict flag for current behavior (abort on ANY mismatch)\n\n## Success Criteria\n- Critical tool mismatch aborts with clear explanation\n- Non-critical mismatch offers user choice\n- Skipped tools tracked and reported\n- Manual install commands provided for skipped tools\n\n## Files to Modify\n- scripts/lib/security.sh: Criticality classification, recovery logic\n- install.sh: Use new recovery flow, track skipped tools\n\n## Reference\nSee: docs/ROADMAP_INSTALLER_RELIABILITY.md Section 4","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-21T12:40:56.024822-05:00","updated_at":"2025-12-21T15:16:40.596546-05:00","closed_at":"2025-12-21T15:16:40.596546-05:00","close_reason":"EPIC complete - all children implemented: tool classification (v8a), checksum recovery flow (anq), --strict flag (8mv)","comments":[{"id":4,"issue_id":"agentic_coding_flywheel_setup-tx7","author":"jemanuel","text":"FYI: created `agentic_coding_flywheel_setup-mjt` (Manifest-Driven Installer Integration). This work will refactor `install.sh` to source generated installers + manifest_index and will touch selection semantics (`--only/--skip/--print-plan`) and curl|bash bootstrap (single archive).\n\nPlease keep this epic’s work compatible with your scope:\n- orchestration/state/error-reporting/preflight remains install.sh + scripts/lib owned\n- generated scripts stay source-safe (no top-level side effects)","created_at":"2025-12-21T18:50:07Z"}]}
{"id":"agentic_coding_flywheel_setup-u5z","title":"Implement system package updates (apt)","description":"## What\nImplement the 'system' category for acfs-update:\n- sudo apt update\n- sudo apt upgrade -y (or prompt if not --yes)\n- sudo apt autoremove -y\n\n## Technical Details\n- Requires sudo (script should check and prompt)\n- Capture list of upgraded packages for log\n- Detect if reboot required after kernel updates (check /var/run/reboot-required)\n- Handle apt lock (another process using apt)\n\n## Considerations\n- This is the most impactful category (security updates)\n- Should probably run first before other updates\n- May need to restart services (postgres, redis) after - handle gracefully\n\n## Success Criteria\n- [ ] apt update/upgrade runs correctly\n- [ ] Handles sudo password prompt (or errors gracefully if no sudo)\n- [ ] Logs list of packages updated\n- [ ] Warns if reboot required","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T13:25:38.290865-05:00","updated_at":"2025-12-21T15:10:53.652006-05:00","closed_at":"2025-12-21T15:10:53.652006-05:00","close_reason":"Implemented apt lock detection, upgradable package logging, reboot-required check","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-u5z","depends_on_id":"agentic_coding_flywheel_setup-75e","type":"blocks","created_at":"2025-12-21T13:27:24.691755-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-ua5","title":"EPIC: Fix Codex CLI Authentication Documentation (OAuth, Not API Key)","description":"## Overview\n\nThis epic addresses a significant documentation error across the ACFS codebase: the incorrect assumption that OpenAI's codex-cli uses an OPENAI_API_KEY environment variable for authentication.\n\n## The Reality\n\nOpenAI's codex-cli uses a **built-in OAuth authentication system**, similar to how Claude Code and Gemini CLI work:\n\n1. **Authentication Method**: OAuth via web browser or device-level code flow\n2. **Accounts**: Uses ChatGPT Pro/Plus accounts (consumer accounts), NOT API accounts\n3. **No API Key Needed**: OPENAI_API_KEY is for the OpenAI API, NOT for codex-cli\n4. **Security Setting Required**: Must enable device code flow in ChatGPT settings (Settings → Security → API/Device access)\n\n## Why This Matters\n\n1. **User Confusion**: Current docs tell users to set OPENAI_API_KEY, which is:\n   - Wrong (codex-cli ignores it)\n   - Misleading (users may think they need an OpenAI API account)\n   - Potentially dangerous (exposing API keys unnecessarily)\n\n2. **Doctor Checks Broken**: Our health checks look for OPENAI_API_KEY, which means:\n   - Legitimate users (authenticated via OAuth) will get false warnings\n   - Users setting OPENAI_API_KEY will get false positives\n\n3. **Account Confusion**: OpenAI has TWO account types:\n   - **API Account**: Uses OPENAI_API_KEY, billed separately, for programmatic access\n   - **ChatGPT Account** (Pro/Plus): Uses OAuth, consumer subscription, what codex-cli uses\n\n## Success Criteria\n\n1. No references to OPENAI_API_KEY for codex-cli authentication\n2. Doctor checks correctly verify codex OAuth token\n3. All documentation accurately describes the OAuth flow\n4. Clear distinction between API accounts and ChatGPT accounts\n5. Install messages guide users to run codex auth","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-21T16:24:54.207594-05:00","updated_at":"2025-12-21T16:25:04.973842-05:00"}
{"id":"agentic_coding_flywheel_setup-uxc","title":"Implement init_state() and save_state() functions","description":"# Task: Implement init_state() and save_state() functions\n\n## Context\nPart of EPIC: Phase-Granular Progress Persistence (agentic_coding_flywheel_setup-5uu)\n\n## What to Do\nCreate bash functions for state management:\n\n### init_state()\n- Check if ~/.acfs/state.json exists\n- If exists: load COMPLETED_PHASES array, CURRENT_PHASE, detect resume scenario\n- If not exists: initialize empty state, create ~/.acfs directory\n- Handle corrupted state files gracefully (warn and start fresh)\n\n### save_state()\n- Write current state to ~/.acfs/state.json atomically\n- Use write-to-temp-then-move pattern to prevent corruption\n- Include all tracked fields from v2 schema\n- Log state save for debugging\n\n## Acceptance Criteria\n- init_state() correctly loads or initializes state\n- save_state() writes atomic JSON (no partial writes)\n- Corrupted state file detected and handled\n- Functions work when jq is not installed (use sed fallback)\n\n## Implementation Notes\n- Use mktemp for atomic writes\n- Consider that jq may not be installed yet (use basic parsing)\n- Test both fresh install and resume scenarios\n\n## Files to Modify\n- install.sh or scripts/lib/state.sh (new)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T12:42:40.635486-05:00","updated_at":"2025-12-21T14:38:29.61414-05:00","closed_at":"2025-12-21T14:38:29.61414-05:00","close_reason":"Implemented in scripts/lib/state.sh with v2 schema, atomic writes, and full lifecycle functions","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-uxc","depends_on_id":"agentic_coding_flywheel_setup-5zt","type":"blocks","created_at":"2025-12-21T12:47:27.650646-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-uxc","depends_on_id":"agentic_coding_flywheel_setup-aa1","type":"blocks","created_at":"2025-12-21T12:51:28.454984-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-v8a","title":"Classify tools as CRITICAL vs RECOMMENDED","description":"# Task: Classify tools as CRITICAL vs RECOMMENDED\n\n## Purpose\nDistinguish between tools that MUST succeed vs tools that can be skipped without breaking the system.\n\n## Tool Classification\n\n### CRITICAL (installation fails if these fail)\nThese are foundational tools that other tools or the dev workflow depend on:\n\n```bash\nCRITICAL_TOOLS=(\n    \"mise\"      # Runtime manager - node/python/go depend on this\n    \"uv\"        # Python package manager - many tools need it\n    \"bun\"       # Node runtime - used by mise and web tooling\n    \"go\"        # Go compiler - needed for several tools (lazygit, etc)\n    \"git\"       # Already installed, but verify\n    \"curl\"      # Needed for everything\n)\n```\n\n### RECOMMENDED (skip with warning if fail)\nThese enhance the experience but system works without them:\n\n```bash\nRECOMMENDED_TOOLS=(\n    # Shell enhancements\n    \"ohmyzsh\"\n    \"zoxide\"\n    \"atuin\"\n    \"fzf\"\n    \"eza\"\n    \"bat\"\n    \"ripgrep\"\n    \"fd\"\n    \"delta\"\n    \"lazygit\"\n    \"lazydocker\"\n    \n    # Development tools\n    \"claude_code\"  # Can install manually later\n    \"direnv\"\n    \"starship\"\n    \n    # Dicklesworthstone stack\n    \"ntm\"\n    \"mcp_agent_mail\"\n    \"ubs\"\n    \"bv\"\n    \"cass\"\n    \"cm\"\n    \"caam\"\n    \"slb\"\n)\n```\n\n## Why Go is CRITICAL\n\n**Rationale:**\n1. `lazygit` requires Go to build\n2. Several modern CLI tools are written in Go\n3. If Go fails, multiple downstream tools will silently fail\n4. Go installation is reliable (official binary)\n\n## Implementation\n\n```bash\nis_critical_tool() {\n    local tool=\"$1\"\n    for critical in \"${CRITICAL_TOOLS[@]}\"; do\n        [[ \"$tool\" == \"$critical\" ]] \u0026\u0026 return 0\n    done\n    return 1\n}\n\nhandle_tool_failure() {\n    local tool=\"$1\"\n    local error=\"$2\"\n    \n    if is_critical_tool \"$tool\"; then\n        log_error \"CRITICAL tool failed: $tool\"\n        log_error \"$error\"\n        log_error \"Installation cannot continue.\"\n        exit 1\n    else\n        log_warn \"Optional tool failed: $tool\"\n        log_warn \"$error\"\n        SKIPPED_TOOLS+=(\"$tool\")\n    fi\n}\n```\n\n## Non-Interactive Behavior\n\nWhen running non-interactively (CI, agents):\n- CRITICAL tool checksum mismatch → ABORT\n- RECOMMENDED tool checksum mismatch → AUTO-SKIP with warning\n\n## Dependencies\n- Used by: checksum mismatch handler (agentic_coding_flywheel_setup-4jr)\n- Used by: error reporting (agentic_coding_flywheel_setup-5zm)\n\n## Acceptance Criteria\n- [ ] CRITICAL_TOOLS array defined with: mise, uv, bun, go, git, curl\n- [ ] RECOMMENDED_TOOLS array for everything else\n- [ ] is_critical_tool() helper function\n- [ ] handle_tool_failure() respects classification\n- [ ] Non-interactive mode auto-skips RECOMMENDED, aborts on CRITICAL","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T12:44:36.267827-05:00","updated_at":"2025-12-21T14:43:26.105479-05:00","closed_at":"2025-12-21T14:43:26.105479-05:00","close_reason":"Created scripts/lib/tools.sh with CRITICAL_TOOLS (git, curl, bun, uv, go, zsh, mise, rustup, cargo) and RECOMMENDED_TOOLS arrays. Implemented is_critical_tool(), is_recommended_tool(), get_tool_classification(), handle_tool_failure(), and non-interactive auto-skip logic. All acceptance criteria met."}
{"id":"agentic_coding_flywheel_setup-va8","title":"[codex.6] Regenerate installer scripts after fixes","description":"## Goal\nAfter fixing the source files (doctor.sh, agents.sh), regenerate all derived scripts.\n\n## Why Needed\nThe manifest generator creates scripts from the source libraries. Any fixes to:\n- scripts/lib/doctor.sh\n- scripts/lib/agents.sh\n\nMust be followed by regenerating:\n- scripts/generated/doctor_checks.sh\n- scripts/generated/install_agents.sh\n\n## Commands\ncd packages/manifest \u0026\u0026 bun run generate\n\n## Verification\nAfter regeneration:\n1. Grep generated files for OPENAI_API_KEY - should find none related to codex auth\n2. Review the generated scripts for correct codex auth guidance\n\n## Depends On\n- codex.1 (doctor.sh fixes)\n- codex.2 (agents.sh fixes)\n\n## Acceptance Criteria\n1. All generated scripts reflect source file changes\n2. No stale OPENAI_API_KEY references in generated codex checks","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T16:26:02.623412-05:00","updated_at":"2025-12-21T16:41:00.602163-05:00","closed_at":"2025-12-21T16:41:00.602163-05:00","close_reason":"Regenerated all installer scripts. No OPENAI_API_KEY references for codex in generated files.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-va8","depends_on_id":"agentic_coding_flywheel_setup-ua5","type":"blocks","created_at":"2025-12-21T16:26:36.575242-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-va8","depends_on_id":"agentic_coding_flywheel_setup-epc","type":"blocks","created_at":"2025-12-21T16:26:37.491646-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-va8","depends_on_id":"agentic_coding_flywheel_setup-yn6","type":"blocks","created_at":"2025-12-21T16:26:37.681275-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-vmg","title":"Fix wizard step 5-\u003e6 navigation bug (page reload)","description":"User reported clicking 'SSH into your VPS' button on step 5 reloads the page instead of navigating. Root cause: ssh-connect page redirects back to create-vps if no IP stored. Fixed by: 1) Hiding Next button on step 5 (page has its own validated Continue button), 2) Scrolling to IP input if stepper is clicked, 3) Removed all window.alert() calls. Also fixed Contabo SSH key docs.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-21T15:15:41.35079-05:00","updated_at":"2025-12-21T15:15:48.703623-05:00","closed_at":"2025-12-21T15:15:48.703623-05:00","close_reason":"Fixed in commits 246d272, d0e852e. Wizard step 5 no longer shows confusing Next button; navigation validates IP presence; window.alert replaced with scroll-to-element; Contabo docs updated."}
{"id":"agentic_coding_flywheel_setup-vqr","title":"Create SSH troubleshooting guide","description":"# Task: Create SSH Troubleshooting Guide\n\n## Description\nComprehensive guide for common SSH connection failures.\n\n## Location\n- Website: Embedded in wizard step 6\n- Installer: ~/.acfs/docs/ssh_troubleshooting.md\n\n## Common Issues Covered\n\n### Permission denied (publickey)\n**Symptoms:** `Permission denied (publickey)`\n**Causes:**\n1. Wrong key file specified\n2. Key not added to VPS\n3. Wrong username\n\n**Fixes:**\n```bash\n# Verify key exists\nls -la ~/.ssh/acfs_ed25519*\n\n# Try with verbose output\nssh -v -i ~/.ssh/acfs_ed25519 ubuntu@IP\n```\n\n### Connection refused\n**Symptoms:** `Connection refused`\n**Causes:**\n1. SSH service not running\n2. Firewall blocking port 22\n3. Wrong IP address\n\n**Fixes:**\n- Check IP is correct\n- VPS provider may need firewall rule\n\n### Connection timeout\n**Symptoms:** `Connection timed out`\n**Causes:**\n1. Wrong IP\n2. VPS not fully booted\n3. Network issue\n\n**Fixes:**\n- Wait 2-3 minutes for VPS to boot\n- Verify IP in provider dashboard\n\n### Host key verification failed\n**Symptoms:** `Host key verification failed`\n**Causes:** \n- VPS was recreated with same IP\n- Man-in-the-middle warning\n\n**Fixes:**\n```bash\nssh-keygen -R IP_ADDRESS\n```\n\n## Acceptance Criteria\n- [ ] All common issues documented\n- [ ] Clear cause → fix structure\n- [ ] Commands are copy-paste ready\n- [ ] Integrated in website step 6","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:39:03.569312-05:00","updated_at":"2025-12-20T11:30:24.161611-05:00","closed_at":"2025-12-20T11:30:24.161611-05:00","close_reason":"Created comprehensive SSH troubleshooting guide at acfs/docs/ssh_troubleshooting.md covering all common issues","labels":["documentation","task"]}
{"id":"agentic_coding_flywheel_setup-vwv","title":"Build ERROR_PATTERNS database with suggested fixes","description":"# Task: Build ERROR_PATTERNS database with suggested fixes\n\n## Context\nPart of EPIC: Per-Phase Error Reporting (agentic_coding_flywheel_setup-fkf)\n\n## What to Do\nCreate a database of known error patterns and their fixes:\n\n### Error Patterns to Include\n```bash\ndeclare -A ERROR_PATTERNS=(\n    [\"curl: (7) Failed to connect\"]=\"Network issue. Check: curl -I https://google.com\"\n    [\"curl: (6) Could not resolve\"]=\"DNS failed. Check: cat /etc/resolv.conf\"\n    [\"E: Unable to locate package\"]=\"Package not found. Try: sudo apt-get update\"\n    [\"Permission denied\"]=\"Permission issue. Ensure running as root or with sudo.\"\n    [\"No space left on device\"]=\"Disk full. Free up space: df -h\"\n    [\"gpg: keyserver receive failed\"]=\"GPG keyserver unreachable. Retry or check firewall.\"\n    [\"Connection timed out\"]=\"Network timeout. Check firewall for outbound HTTPS.\"\n    [\"checksum mismatch\"]=\"Upstream script changed. See GitHub issues.\"\n    [\"rate limit\"]=\"API rate limited. Wait 60 seconds and retry.\"\n)\n```\n\n### get_suggested_fix() Function\nMatch error text against patterns and return fix suggestion.\n\n## Acceptance Criteria\n- At least 10 common error patterns covered\n- get_suggested_fix() returns actionable text\n- Fallback message for unknown errors\n- Easy to extend with new patterns\n\n## Files to Create\n- scripts/lib/errors.sh","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T12:43:59.387392-05:00","updated_at":"2025-12-21T14:39:10.792761-05:00","closed_at":"2025-12-21T14:39:10.792761-05:00","close_reason":"Created scripts/lib/errors.sh with 33 error patterns and get_suggested_fix() function. All tests pass."}
{"id":"agentic_coding_flywheel_setup-w0q","title":"install.sh: dry-run prints misleading completion banner","description":"In --dry-run mode, install.sh skips all phases but still prints the full 'ACFS Installation Complete' summary. Adjust print_summary (or main) to show a dry-run summary instead, clearly stating no changes were made.","status":"closed","priority":1,"issue_type":"bug","assignee":"FuchsiaCreek","created_at":"2025-12-20T13:56:39.819372-05:00","updated_at":"2025-12-20T13:57:24.752126-05:00","closed_at":"2025-12-20T13:57:24.752126-05:00","close_reason":"Fixed install.sh so --dry-run prints a dry-run completion banner (no changes made) instead of the full 'Installation Complete' summary."}
{"id":"agentic_coding_flywheel_setup-wsj","title":"Implement acfs session export command","description":"# Task: Implement acfs session export command\n\n## Purpose\nExport agent coding sessions for sharing, documentation, and learning.\n\n## Primary Value: Learning and Documentation\n\nThe main value of session export is NOT \"replay\" but rather:\n1. **Show your work** - Share how you solved a problem\n2. **Team knowledge** - Document tribal knowledge in session form\n3. **Debugging** - Export problematic session for analysis\n4. **Onboarding** - \"Watch\" how experienced devs work\n\n## Export Command\n\n```bash\n# Export current/recent session\nacfs session export\n# → Exports to stdout (pipe to file)\n\nacfs session export \u003e my-session.json\n# → Save to file\n\nacfs session export --format=markdown \u003e session.md\n# → Human-readable markdown\n\nacfs session export --session-id=abc123\n# → Export specific session\n```\n\n## Export Formats\n\n### JSON (default, machine-readable)\n```json\n{\n  \"version\": \"1.0\",\n  \"schema\": \"acfs-session-v1\",\n  \"metadata\": {\n    \"exported_at\": \"2025-01-15T10:00:00Z\",\n    \"hostname\": \"[REDACTED]\",\n    \"acfs_version\": \"0.5.0\",\n    \"duration_seconds\": 3600\n  },\n  \"summary\": {\n    \"command_count\": 150,\n    \"tools_used\": [\"claude\", \"git\", \"npm\"],\n    \"files_modified\": 23\n  },\n  \"commands\": [\n    {\n      \"timestamp\": \"2025-01-15T09:00:00Z\",\n      \"type\": \"shell\",\n      \"command\": \"npm test\",\n      \"exit_code\": 0,\n      \"duration_ms\": 5000\n    }\n  ]\n}\n```\n\n### Markdown (human-readable)\n```markdown\n# Session Export: 2025-01-15\n\n**Duration:** 1 hour\n**Commands:** 150\n**Tools:** claude, git, npm\n\n## Timeline\n\n### 09:00 - Initial Setup\n\\`\\`\\`bash\nnpm install\n\\`\\`\\`\nExit: 0, Duration: 5s\n\n### 09:05 - Running Tests\n\\`\\`\\`bash\nnpm test\n\\`\\`\\`\n...\n```\n\n## Implementation\n\n```bash\nexport_session() {\n    local format=\"${1:-json}\"\n    local session_id=\"${2:-$(get_current_session_id)}\"\n    \n    # Get session data from CASS\n    local session_data\n    session_data=$(cass get-session \"$session_id\" 2\u003e/dev/null) || {\n        log_error \"Session not found: $session_id\"\n        return 1\n    }\n    \n    # Apply sanitization\n    session_data=$(sanitize_session \"$session_data\")\n    \n    case \"$format\" in\n        json)\n            echo \"$session_data\" | jq \".\"\n            ;;\n        markdown)\n            convert_to_markdown \"$session_data\"\n            ;;\n        *)\n            log_error \"Unknown format: $format\"\n            return 1\n            ;;\n    esac\n}\n```\n\n## Dependencies\n- Depends on: Session schema (agentic_coding_flywheel_setup-c61)\n- Depends on: Sanitization (agentic_coding_flywheel_setup-1xq)\n- Depends on: CASS research (agentic_coding_flywheel_setup-eli)\n\n## Acceptance Criteria\n- [ ] Export to JSON (default)\n- [ ] Export to Markdown\n- [ ] Applies sanitization before export\n- [ ] Can export current or specific session\n- [ ] Output to stdout (pipeable)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T12:46:39.793024-05:00","updated_at":"2025-12-21T15:51:22.04615-05:00","closed_at":"2025-12-21T15:51:22.04615-05:00","close_reason":"Implemented session export in session.sh: (1) export_session() with --format json|markdown, --no-sanitize, --output options, (2) export_recent_session() for quick workspace export, (3) convert_to_acfs_schema() to transform CASS JSON to our schema, (4) Applies sanitization automatically for JSON, text sanitization for other formats. All acceptance criteria met.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-wsj","depends_on_id":"agentic_coding_flywheel_setup-c61","type":"blocks","created_at":"2025-12-21T12:47:39.978906-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-wsj","depends_on_id":"agentic_coding_flywheel_setup-1xq","type":"blocks","created_at":"2025-12-21T12:47:40.147584-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-wsj","depends_on_id":"agentic_coding_flywheel_setup-542","type":"blocks","created_at":"2025-12-21T12:51:29.863386-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-wy1","title":"[codex.4] Research and document codex-cli auth token location","description":"## Goal\nDetermine the exact location where codex-cli stores OAuth tokens so we can correctly detect authentication.\n\n## Research Tasks\n1. Check codex-cli source code or documentation for token storage location\n2. Test on a real system with codex-cli installed\n3. Verify location consistency across:\n   - macOS\n   - Linux\n   - Different codex-cli versions\n\n## Expected Locations to Check\nBased on common patterns:\n- ~/.codex/auth.json\n- ~/.codex/config.json\n- ~/.config/codex/auth.json\n- ~/.local/share/codex/\n- XDG_CONFIG_HOME/codex/\n- XDG_DATA_HOME/codex/\n\n## Outputs\n1. Document the actual token file path\n2. Document the file format (JSON structure)\n3. Document any version-specific differences\n4. Update doctor.sh detection logic accordingly\n\n## Why First\nThis task should be done before codex.1 because we need to know WHERE to look for the OAuth token before we can update the doctor check.\n\n## Acceptance Criteria\n1. Verified token storage location documented\n2. Token file format understood\n3. Any OS/version differences noted","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T16:25:59.770556-05:00","updated_at":"2025-12-21T16:30:21.243265-05:00","closed_at":"2025-12-21T16:30:21.243265-05:00","close_reason":"Documented codex-cli OAuth token storage: ~/.codex/auth.json with tokens.access_token for OAuth and OPENAI_API_KEY for legacy. See docs/codex-auth-research.md","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-wy1","depends_on_id":"agentic_coding_flywheel_setup-ua5","type":"blocks","created_at":"2025-12-21T16:26:36.228137-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-x0l","title":"Implement acfs-update global update command","description":"","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-21T13:24:52.632832-05:00","updated_at":"2025-12-21T15:12:00.388768-05:00","closed_at":"2025-12-21T15:12:00.388768-05:00","close_reason":"Completed"}
{"id":"agentic_coding_flywheel_setup-xos","title":"Generate PR body with changelog info","description":"# Task: Generate PR body with changelog info\n\n## Context\nPart of EPIC: Automated Upstream Checksum Monitoring (agentic_coding_flywheel_setup-4ou)\n\n## What to Do\nEnhance the GitHub Action to include useful context in the PR body:\n\n### PR Body Template\n```markdown\n## Upstream Checksum Updates\n\nThe following upstream installer scripts have changed:\n\n### ntm\n- Old: `abc123...` (16 chars)\n- New: `def456...`\n- URL: https://...\n\n### bv\n- Old: `ghi789...`\n- New: `jkl012...`\n- URL: https://...\n\n---\n\n⚠️ **Review Required**: Verify these are legitimate updates.\n\n### Verification Steps\n1. Check upstream release notes\n2. Review the diff in installer scripts\n3. Ensure no malicious content\n```\n\n### Optional Enhancements\n- Fetch GitHub release notes if tool is on GitHub\n- Include commit messages from upstream\n- Link to upstream changelog\n\n## Acceptance Criteria\n- PR body has structured format\n- Each changed tool listed with checksums\n- Verification checklist included\n- Body is readable and actionable\n\n## Files to Modify\n- .github/workflows/checksum-monitor.yml","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T12:45:54.162805-05:00","updated_at":"2025-12-21T15:06:18.487252-05:00","closed_at":"2025-12-21T15:06:18.487252-05:00","close_reason":"Enhanced checksum monitoring workflow PR body with: structured tool listings (old/new checksums, URLs), fetch error section, verification checklist, and common causes table. Uses body-path for cleaner formatting.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-xos","depends_on_id":"agentic_coding_flywheel_setup-coj","type":"blocks","created_at":"2025-12-21T12:47:37.983456-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-y0d","title":"Docs reference missing VM test script","description":"AGENTS.md and README.md reference tests/vm/test_install_ubuntu.sh, but only tests/vm/.gitkeep exists. This confuses contributors and breaks documented commands.","acceptance_criteria":"Either:\n- Add tests/vm/test_install_ubuntu.sh that actually runs a meaningful installer test, OR\n- Update AGENTS.md and README.md to remove/replace the reference.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-20T14:48:12.189137-05:00","updated_at":"2025-12-20T14:52:41.74062-05:00","closed_at":"2025-12-20T14:52:41.74062-05:00","close_reason":"Added missing tests/vm/test_install_ubuntu.sh (Docker-based integration test) and updated README/AGENTS installer testing docs."}
{"id":"agentic_coding_flywheel_setup-yad","title":"EPIC: Website Wizard MVP","description":"# Epic: Website Wizard MVP\n\n## Overview\nBuild the step-by-step wizard website that guides beginners from \"I have a laptop\" to \"paste the curl|bash command\".\n\n## Background \u0026 Reasoning\nThe wizard is the user's first touchpoint with ACFS. It must:\n- Feel premium and trustworthy\n- Never overwhelm with jargon\n- Make every step feel achievable\n- Handle both Mac and Windows users\n- Guide through VPS provider selection\n\n## Tech Stack\n- Next.js 16 App Router\n- Bun runtime\n- Tailwind CSS + shadcn/ui\n- Vercel hosting + Cloudflare caching\n\n## Key Design Principles\n1. **Single action per screen** - One button or one command\n2. **Copy button on every command** - Reduce friction\n3. **\"I did it\" checkbox** - Gates \"Next\" button\n4. **Collapsible troubleshooting** - Don't clutter but be ready\n\n## Success Criteria\n- [ ] All 10 wizard steps implemented\n- [ ] OS-aware command rendering\n- [ ] Mobile responsive\n- [ ] Lighthouse score \u003e 90\n- [ ] Works without JavaScript (progressive enhancement)\n\n## Relationship to Project Goals\nThe wizard is the \"front door\" to ACFS. A confused or frustrated user at this stage will never reach the VPS installer. Excellence here directly enables the 10-minute promise.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-19T22:20:46.959703-05:00","updated_at":"2025-12-20T11:25:29.453083-05:00","closed_at":"2025-12-20T11:25:29.453083-05:00","close_reason":"All 15 wizard steps implemented and verified. Epic complete.","labels":["epic","website"]}
{"id":"agentic_coding_flywheel_setup-yad.1","title":"Initialize Next.js 16 App Router project","description":"# Task: Initialize Next.js 16 App Router Project\n\n## Description\nSet up the Next.js 16 project in apps/web/ with:\n- App Router structure\n- TypeScript configuration\n- Tailwind CSS\n- shadcn/ui components\n\n## Technical Details\n```bash\ncd apps/web\nbunx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir\nbunx shadcn-ui@latest init\n```\n\n## Configuration\n- Use Bun as package manager\n- Configure for Vercel deployment\n- Set up path aliases (@/components, @/lib)\n- Configure next.config.js for optimal settings\n\n## Reasoning\nNext.js 16 with App Router provides:\n- Modern React Server Components\n- Automatic code splitting\n- Optimal performance defaults\n- Easy Vercel deployment\n\n## Acceptance Criteria\n- [ ] Next.js 16 project created\n- [ ] TypeScript strict mode enabled\n- [ ] Tailwind CSS working\n- [ ] shadcn/ui initialized\n- [ ] bun run dev works\n- [ ] bun run build succeeds","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:22:18.88745-05:00","updated_at":"2025-12-19T23:27:32.977854-05:00","closed_at":"2025-12-19T23:27:32.977854-05:00","close_reason":"Next.js 16 project initialized with TypeScript, Tailwind CSS v4, shadcn/ui, and turbopack. Build and type-check pass.","labels":["task","website"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yad.1","depends_on_id":"agentic_coding_flywheel_setup-yad","type":"parent-child","created_at":"2025-12-19T22:22:18.88924-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-yad.10","title":"Implement wizard Step 5: Create VPS and Attach SSH Key","description":"# Task: Wizard Step 5 - Create VPS\n\n## Description\nGuide users through VPS creation with provider-specific instructions.\n\n## Key Elements\n- Universal checklist (select Ubuntu, paste SSH key, create, copy IP)\n- Provider-specific collapsible sections with screenshots\n- IP address input field (validated, stored in localStorage)\n\n## Why This Is Its Own Step\nThis is the most variable step - different providers have different UIs.\nScreenshots and specific guidance needed for each.\n\n## Acceptance Criteria\n- [ ] Universal checklist clear\n- [ ] Provider sections expandable\n- [ ] IP input with validation\n- [ ] Screenshot placeholders ready","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:37:06.118022-05:00","updated_at":"2025-12-19T23:54:02.512884-05:00","closed_at":"2025-12-19T23:54:02.512884-05:00","close_reason":"Closed","labels":["mvp","task","website","wizard-step"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yad.10","depends_on_id":"agentic_coding_flywheel_setup-yad","type":"parent-child","created_at":"2025-12-19T22:37:06.120067-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-yad.11","title":"Implement wizard Step 6: SSH Into Your VPS","description":"# Task: Wizard Step 6 - SSH Connection\n\n## Description\nHelp users make their first SSH connection to the VPS.\n\n## Why This Is Critical\nThis is where most beginners fail:\n- Wrong username (root vs ubuntu)\n- Key permissions wrong\n- Firewall blocking port 22\n- Host key verification confusion\n\n## Key Elements\n- Command using stored IP from step 5\n- OS-aware command (Mac vs Windows)\n- \"Try ubuntu@, if fails try root@\" guidance\n- Host key verification explanation\n- Comprehensive troubleshooting section\n\n## Troubleshooting Covered\n- Permission denied (publickey)\n- Connection refused\n- Connection timeout\n- Host key verification failed\n\n## Acceptance Criteria\n- [ ] Command uses stored IP\n- [ ] OS-specific variants shown\n- [ ] ubuntu/root fallback explained\n- [ ] Troubleshooting expandable section","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:37:07.524339-05:00","updated_at":"2025-12-19T23:55:35.709759-05:00","closed_at":"2025-12-19T23:55:35.709759-05:00","close_reason":"Closed","labels":["mvp","task","website","wizard-step"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yad.11","depends_on_id":"agentic_coding_flywheel_setup-yad","type":"parent-child","created_at":"2025-12-19T22:37:07.526273-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-yad.12","title":"Implement wizard Step 7: Paste the ACFS One-Liner","description":"# Task: Wizard Step 7 - The Magic Moment\n\n## Description\nThe climactic step where users paste the installer command.\n\n## Why This Matters\nThis is the entire point of ACFS. Make it feel:\n- Special (this is the magic)\n- Safe (explain what it does)\n- Transparent (link to source)\n\n## Key Elements\n- Large, prominent command card\n- Giant copy button\n- \"What this will do\" section (collapsible)\n- Link to install.sh source on GitHub\n- Expected duration (~10-15 minutes)\n- \"Don't close this terminal\" warning\n\n## The Command\n```bash\ncurl -fsSL \"https://raw.githubusercontent.com/Dicklesworthstone/agentic_coding_flywheel_setup/main/install.sh?$(date +%s)\" | bash -s -- --yes --mode vibe\n```\n\n## Acceptance Criteria\n- [ ] Command prominently displayed\n- [ ] Copy button works\n- [ ] \"What this does\" expandable\n- [ ] Link to source code\n- [ ] Duration estimate shown","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:37:07.828318-05:00","updated_at":"2025-12-19T23:56:55.262473-05:00","closed_at":"2025-12-19T23:56:55.262473-05:00","close_reason":"Closed","labels":["mvp","task","website","wizard-step"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yad.12","depends_on_id":"agentic_coding_flywheel_setup-yad","type":"parent-child","created_at":"2025-12-19T22:37:07.828743-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-yad.13","title":"Implement wizard Step 8: Reconnect as Ubuntu","description":"# Task: Wizard Step 8 - Reconnect as Ubuntu\n\n## Description\nIf user ran installer as root, guide them to reconnect as ubuntu.\n\n## Key Elements\n- Conditional display (only if started as root)\n- Simple exit + reconnect command\n- Verification that shell is now zsh\n- Skip button if already ubuntu\n\n## Commands\n```bash\nexit\nssh -i ~/.ssh/acfs_ed25519 ubuntu@YOUR_IP\n```\n\n## Why This Step Exists\nThe installer creates/normalizes the ubuntu user. If they started as root,\nthey need to reconnect to get the full zsh experience.\n\n## Acceptance Criteria\n- [ ] Conditional display logic\n- [ ] Skip option for ubuntu users\n- [ ] Reconnect command with stored IP\n- [ ] Verify new shell is zsh","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:37:32.653128-05:00","updated_at":"2025-12-19T23:58:52.209483-05:00","closed_at":"2025-12-19T23:58:52.209483-05:00","close_reason":"Closed","labels":["task","website","wizard-step"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yad.13","depends_on_id":"agentic_coding_flywheel_setup-yad","type":"parent-child","created_at":"2025-12-19T22:37:32.655059-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-yad.14","title":"Implement wizard Step 9: ACFS Status Check","description":"# Task: Wizard Step 9 - Status Check\n\n## Description\nVerification step using acfs doctor.\n\n## Key Elements\n- Single command: `acfs doctor`\n- Full checklist display matching doctor output\n- Optional: JSON paste for auto-check\n- Re-run installer suggestion if failures\n\n## The Checklist\nDisplay all check categories:\n- Identity \u0026 permissions\n- Shell setup\n- Core tools (bun, uv, cargo, go, tmux, rg, sg)\n- Coding agents (claude, codex, gemini)\n- Cloud/DB tools (vault, postgres, wrangler, supabase, vercel)\n- Dicklesworthstone stack (all 8 tools)\n\n## Acceptance Criteria\n- [ ] Doctor command prominently shown\n- [ ] Static checklist displayed\n- [ ] Optional JSON paste auto-check\n- [ ] \"If something fails\" guidance","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:37:34.363135-05:00","updated_at":"2025-12-19T23:58:52.210537-05:00","closed_at":"2025-12-19T23:58:52.210537-05:00","close_reason":"Closed","labels":["task","website","wizard-step"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yad.14","depends_on_id":"agentic_coding_flywheel_setup-yad","type":"parent-child","created_at":"2025-12-19T22:37:34.365539-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-yad.15","title":"Implement wizard Step 10: Launch Onboarding","description":"# Task: Wizard Step 10 - Completion \u0026 Onboarding\n\n## Description\nCelebration screen with next steps.\n\n## Key Elements\n- Success celebration (subtle confetti or similar)\n- `onboard` command card\n- Quick reference of installed commands\n- \"What's next\" guidance\n\n## Quick Reference Card\n```\nAgents: cc, cod, gmi\nOrchestration: ntm\nMemory: cass, cm\nQuality: ubs\nTasks: bv\nCoordination: am\nAuth: caam\nSafety: slb\n```\n\n## What's Next Suggestions\n1. Run onboard tutorial\n2. Try: ntm spawn myproject --cc=2 --cod=1\n3. Explore your new tools\n\n## Acceptance Criteria\n- [ ] Celebration UI (tasteful)\n- [ ] onboard command card\n- [ ] Quick reference displayed\n- [ ] Next steps guidance\n- [ ] Link to documentation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:37:34.671676-05:00","updated_at":"2025-12-19T23:58:52.211023-05:00","closed_at":"2025-12-19T23:58:52.211023-05:00","close_reason":"Closed","labels":["task","website","wizard-step"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yad.15","depends_on_id":"agentic_coding_flywheel_setup-yad","type":"parent-child","created_at":"2025-12-19T22:37:34.672106-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-yad.2","title":"Create Stepper component for wizard navigation","description":"# Task: Create Stepper Component\n\n## Description\nBuild a reusable Stepper component that shows:\n- All 10 wizard steps in left sidebar\n- Current step highlighted\n- Completed steps with checkmark\n- Click-to-navigate (only to completed steps)\n\n## Design\n```\n┌─────────────────────────────────────────────────┐\n│ ✓ 1. Choose OS                                  │\n│ ✓ 2. Install terminal                           │\n│ ● 3. Generate SSH key  ← current (highlighted)  │\n│   4. Rent a VPS                                 │\n│   5. Create VPS                                 │\n│   ...                                           │\n└─────────────────────────────────────────────────┘\n```\n\n## Technical Details\n- Use URL query param for current step\n- Store completed steps in localStorage\n- Prevent navigation to incomplete steps\n- Responsive: hide on mobile, show as bottom nav\n\n## Props Interface\n```typescript\ninterface StepperProps {\n  currentStep: number;\n  completedSteps: number[];\n  onStepClick?: (step: number) =\u003e void;\n}\n```\n\n## Acceptance Criteria\n- [ ] Shows all 10 steps with icons/numbers\n- [ ] Current step visually distinct\n- [ ] Completed steps show checkmark\n- [ ] Can click completed steps to navigate\n- [ ] Cannot click incomplete steps\n- [ ] Responsive on mobile","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:22:31.96731-05:00","updated_at":"2025-12-19T23:46:03.691241-05:00","closed_at":"2025-12-19T23:46:03.691241-05:00","close_reason":"Closed","labels":["component","task","website"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yad.2","depends_on_id":"agentic_coding_flywheel_setup-yad","type":"parent-child","created_at":"2025-12-19T22:22:31.969974-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-yad.3","title":"Create CommandCard component with copy button","description":"# Task: Create CommandCard Component\n\n## Description\nBuild a reusable component for displaying copyable commands with:\n- OS-aware command rendering (Mac vs Windows)\n- Copy button with visual feedback\n- \"I ran this\" checkbox\n- Optional explanation text\n\n## Design\n```\n┌─────────────────────────────────────────────────────┐\n│ ┌─────────────────────────────────────────────┬───┐ │\n│ │ ssh -i ~/.ssh/acfs_ed25519 ubuntu@IP       │ 📋│ │\n│ └─────────────────────────────────────────────┴───┘ │\n│ ☐ I ran this command                                │\n└─────────────────────────────────────────────────────┘\n```\n\n## Props Interface\n```typescript\ninterface CommandCardProps {\n  command: string;\n  macCommand?: string;      // If different from Windows\n  windowsCommand?: string;  // If different from Mac\n  description?: string;\n  showCheckbox?: boolean;\n  onComplete?: () =\u003e void;\n}\n```\n\n## Technical Details\n- Use navigator.clipboard.writeText for copy\n- Show \"Copied!\" toast or icon change\n- Checkbox state persisted in localStorage\n- Code font with proper wrapping\n\n## Acceptance Criteria\n- [ ] Displays command in monospace font\n- [ ] Copy button works\n- [ ] Visual feedback on copy\n- [ ] OS-aware rendering (detect from localStorage)\n- [ ] Checkbox persists state\n- [ ] Accessible (keyboard navigation)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T22:22:44.689911-05:00","updated_at":"2025-12-19T23:29:17.096555-05:00","closed_at":"2025-12-19T23:29:17.096555-05:00","close_reason":"CommandCard component created with copy button, OS-aware command display, checkbox persistence, and accessibility support","labels":["component","task","website"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yad.3","depends_on_id":"agentic_coding_flywheel_setup-yad","type":"parent-child","created_at":"2025-12-19T22:22:44.691645-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-yad.4","title":"Implement wizard Step 1: OS Selection (Mac/Windows)","description":"# Task: Implement Wizard Step 1 - OS Selection\n\n## Description\nCreate the first wizard step where users choose their operating system (Mac or Windows).\n\n## Page Copy\n**Title:** What computer are you using?\n**Subtitle:** This helps us show you the right commands.\n\n**Options:**\n- 🍎 **Mac** - macOS, MacBook, iMac, Mac Mini, Mac Studio\n- 🪟 **Windows** - Windows 10, Windows 11\n\n## Technical Details\n- Store selection in localStorage as `acfs_os`\n- Store in URL as `?os=mac` or `?os=windows`\n- Large clickable cards for each option\n- Auto-advance on selection\n\n## Route\n`/wizard/os/page.tsx`\n\n## Acceptance Criteria\n- [ ] Two clear options: Mac and Windows\n- [ ] Selection stored in localStorage\n- [ ] Selection reflected in URL\n- [ ] Auto-advances to step 2\n- [ ] Can return and change selection\n- [ ] Mobile-friendly touch targets","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:22:55.647302-05:00","updated_at":"2025-12-19T23:48:15.049301-05:00","closed_at":"2025-12-19T23:48:15.049301-05:00","close_reason":"Closed","labels":["task","website","wizard-step"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yad.4","depends_on_id":"agentic_coding_flywheel_setup-yad","type":"parent-child","created_at":"2025-12-19T22:22:55.649137-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-yad.5","title":"Implement wizard Step 2: Install Terminal","description":"# Task: Implement Wizard Step 2 - Install Terminal\n\n## Description\nGuide users to install a good terminal application based on their OS selection.\n\n## Page Copy\n\n### Mac Version\n**Title:** Install a terminal you'll actually like\n**Body:** \nInstall **Ghostty** or **WezTerm** (either is fine).\nOpen it once after installing.\n\n**Links:**\n- [Download Ghostty](https://ghostty.org/download)\n- [Download WezTerm](https://wezfurlong.org/wezterm/installation.html)\n\n**Note:** macOS already includes SSH, so you're ready to go.\n\n### Windows Version\n**Title:** Install Windows Terminal\n**Body:**\nInstall **Windows Terminal** from the Microsoft Store.\nOpen it once after installing.\n\n**Link:** [Get Windows Terminal](ms-windows-store://pdp/?ProductId=9N0DX20HK701)\n\n**Verify:** Run this in the terminal:\n```powershell\nssh -V\n```\nYou should see a version number.\n\n## Technical Details\n- OS-aware content rendering\n- External links open in new tab\n- Optional verification command\n\n## Route\n`/wizard/terminal/page.tsx`\n\n## Acceptance Criteria\n- [ ] Shows correct content based on OS\n- [ ] Download links work\n- [ ] Verification step for Windows\n- [ ] \"I installed it\" button advances","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:23:08.838021-05:00","updated_at":"2025-12-19T23:49:33.451126-05:00","closed_at":"2025-12-19T23:49:33.451126-05:00","close_reason":"Closed","labels":["task","website","wizard-step"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yad.5","depends_on_id":"agentic_coding_flywheel_setup-yad","type":"parent-child","created_at":"2025-12-19T22:23:08.839785-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-yad.6","title":"Implement wizard Step 3: Generate SSH Key","description":"# Task: Implement Wizard Step 3 - Generate SSH Key\n\n## Description\nGuide users through generating an SSH key pair and copying their public key.\n\n## Page Copy\n**Title:** Create your SSH key (this is your \"login key\")\n**Body:**\nYou're going to create a key pair. You will paste the **public key** into your VPS provider.\n\n### Generate the key\n**Mac:**\n```bash\nssh-keygen -t ed25519 -C \"acfs\" -f ~/.ssh/acfs_ed25519\n```\n\n**Windows (PowerShell):**\n```powershell\nssh-keygen -t ed25519 -C \"acfs\" -f $HOME\\.ssh\\acfs_ed25519\n```\n\nPress Enter twice when asked for a passphrase (leave it empty).\n\n### Copy your public key\n**Mac:**\n```bash\ncat ~/.ssh/acfs_ed25519.pub\n```\n\n**Windows:**\n```powershell\ntype $HOME\\.ssh\\acfs_ed25519.pub\n```\n\n**Action:** Copy the entire output (starts with `ssh-ed25519 ...`)\n\n## Technical Details\n- Two CommandCard components (generate, copy)\n- OS-aware commands\n- Emphasize copying the .pub file\n\n## Acceptance Criteria\n- [ ] Clear two-step process\n- [ ] OS-specific commands shown\n- [ ] Copy buttons on both commands\n- [ ] \"I copied my public key\" checkbox\n- [ ] Troubleshooting for common errors","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:23:21.636553-05:00","updated_at":"2025-12-19T23:50:52.605731-05:00","closed_at":"2025-12-19T23:50:52.605731-05:00","close_reason":"Closed","labels":["task","website","wizard-step"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yad.6","depends_on_id":"agentic_coding_flywheel_setup-yad","type":"parent-child","created_at":"2025-12-19T22:23:21.639421-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-yad.7","title":"Implement wizard Step 4: Rent a VPS","description":"# Task: Implement Wizard Step 4 - Rent a VPS\n\n## Description\nGuide users to rent a VPS from a supported provider with appropriate specs.\n\n## Page Copy\n**Title:** Rent a VPS (~$50/month sweet spot)\n**Body:**\nPick a VPS provider and rent a server. This is where your coding agents will live.\n\n### Recommended Providers\n- **OVH** - European, good value\n- **Contabo** - Budget-friendly, high specs\n- **Hetzner** - Developer favorite\n- **Other** - Any provider with Ubuntu VPS works\n\n### What to choose\n- **OS:** Ubuntu 25.x (or newest Ubuntu available)\n- **CPU:** 4-8 vCPU\n- **RAM:** 8-16 GB\n- **Storage:** 100GB+ NVMe SSD\n- **Price:** ~$50/month is the sweet spot\n\n### Important\n- Make sure \"SSH key login\" is available\n- You'll paste your public key in the next step\n\n## Technical Details\n- Provider cards that expand with specific guidance\n- Checklist of what to select\n- Links to signup pages\n\n## Components\n- ProviderChooser with expandable cards\n- Checklist component\n\n## Acceptance Criteria\n- [ ] Provider cards with logos\n- [ ] Expandable provider-specific guidance\n- [ ] Clear spec recommendations\n- [ ] Links to provider signup\n- [ ] \"I rented a VPS\" advances","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:23:33.751033-05:00","updated_at":"2025-12-19T23:52:16.561453-05:00","closed_at":"2025-12-19T23:52:16.561453-05:00","close_reason":"Closed","labels":["task","website","wizard-step"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yad.7","depends_on_id":"agentic_coding_flywheel_setup-yad","type":"parent-child","created_at":"2025-12-19T22:23:33.75301-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-yad.8","title":"Implement wizard Steps 5-7: Create VPS, SSH In, Paste Installer","description":"# Task: Implement Wizard Steps 5-7\n\n## Description\nImplement the core VPS setup steps:\n- Step 5: Create VPS and attach SSH key\n- Step 6: SSH into your VPS\n- Step 7: Paste the ACFS one-liner\n\n## Step 5: Create VPS + Attach SSH Key\n**Title:** Create your VPS and add your SSH key\n**Content:**\n1. Select Ubuntu 25.x as the OS image\n2. Find \"SSH Keys\" section\n3. Paste your public key (the one you copied earlier)\n4. Create the server\n5. Copy the IP address shown\n\nChecklist:\n- [ ] Selected Ubuntu image\n- [ ] Pasted my SSH public key\n- [ ] Server created\n- [ ] I have the IP address\n\n## Step 6: SSH In\n**Title:** Connect to your VPS\n**Command (Mac):**\n```bash\nssh -o StrictHostKeyChecking=accept-new -i ~/.ssh/acfs_ed25519 ubuntu@YOUR_IP\n```\n\n**Command (Windows):**\n```powershell\nssh -o StrictHostKeyChecking=accept-new -i $HOME\\.ssh\\acfs_ed25519 ubuntu@YOUR_IP\n```\n\n**Note:** If `ubuntu@` fails, try `root@` instead.\n\n## Step 7: Paste the ACFS One-Liner\n**Title:** Paste the magic command\n**Command:**\n```bash\ncurl -fsSL \"https://raw.githubusercontent.com/Dicklesworthstone/agentic_coding_flywheel_setup/main/install.sh?$(date +%s)\" | bash -s -- --yes --mode vibe\n```\n\n**What this will do:**\n- Create/enforce ubuntu user with passwordless sudo\n- Install your full toolchain (shell, languages, agents)\n- Install the Dicklesworthstone stack (all 8 tools)\n- End by telling you what to type next\n\n## Acceptance Criteria\n- [ ] Step 5: Provider-agnostic guidance\n- [ ] Step 6: IP input field to customize command\n- [ ] Step 7: Big, prominent command card\n- [ ] Troubleshooting sections for common issues","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:23:48.826787-05:00","updated_at":"2025-12-19T22:36:40.547518-05:00","closed_at":"2025-12-19T22:36:40.547521-05:00","labels":["task","website","wizard-step"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yad.8","depends_on_id":"agentic_coding_flywheel_setup-yad","type":"parent-child","created_at":"2025-12-19T22:23:48.828541-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-yad.9","title":"Implement wizard Steps 8-10: Reconnect, Status, Onboard","description":"# Task: Implement Wizard Steps 8-10\n\n## Description\nComplete the final wizard steps:\n- Step 8: Reconnect as ubuntu\n- Step 9: ACFS Status Check\n- Step 10: Run onboard\n\n## Step 8: Reconnect as Ubuntu\n**Title:** Reconnect as ubuntu\n**Body:**\nIf you installed while logged in as `root`, reconnect as `ubuntu`:\n```bash\nexit\nssh -i ~/.ssh/acfs_ed25519 ubuntu@YOUR_IP\n```\n\n**Skip if:** Already logged in as ubuntu\n\n## Step 9: ACFS Status Check\n**Title:** Verify your VPS is ready (one command)\n**Body:**\nRun this on your VPS:\n```bash\nacfs doctor\n```\n\n**What you should see:**\nA checklist with lots of `PASS ✅` lines.\n\n**Interactive checklist** - shows all installed tools:\n- Identity \u0026 permissions\n- Shell setup\n- Core tools\n- Coding agents\n- Cloud/DB tools\n- Dicklesworthstone stack\n\n**Optional:** Paste JSON output for auto-check\n\n## Step 10: Run Onboard + Start Vibe Coding\n**Title:** You're ready! Start the tutorial\n**Command:**\n```bash\nonboard\n```\n\n**Quick reference:**\n- `cc` - Claude Code\n- `cod` - Codex CLI\n- `gmi` - Gemini CLI\n- `ntm` - Named Tmux Manager\n- `cass` - Session search\n- `cm` - Memory system\n- `ubs` - Bug scanner\n- `bv` - Beads viewer\n\n## Acceptance Criteria\n- [ ] Step 8: Skip option for non-root users\n- [ ] Step 9: Full status checklist display\n- [ ] Step 9: Optional JSON paste auto-check\n- [ ] Step 10: Celebration UI (confetti?)\n- [ ] Step 10: Quick reference card","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:24:04.4838-05:00","updated_at":"2025-12-19T22:36:41.482071-05:00","closed_at":"2025-12-19T22:36:41.482073-05:00","labels":["task","website","wizard-step"],"dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yad.9","depends_on_id":"agentic_coding_flywheel_setup-yad","type":"parent-child","created_at":"2025-12-19T22:24:04.48597-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-yaj","title":"Implement run_phase() wrapper and phase skipping","description":"# Task: Implement run_phase() wrapper and phase skipping\n\n## Context\nPart of EPIC: Phase-Granular Progress Persistence (agentic_coding_flywheel_setup-5uu)\n\n## What to Do\nCreate run_phase() function that:\n1. Checks if phase is already completed (is_phase_completed)\n2. If completed: log 'Phase N already done, skipping' and return 0\n3. If not completed: set CURRENT_PHASE, save state, run phase function\n4. On success: add to COMPLETED_PHASES, save state\n5. On failure: set FAILED_PHASE, save state, return 1\n\n### Helper Functions\n- is_phase_completed(phase_num): Check if phase in COMPLETED_PHASES\n- complete_phase(phase_num): Add to completed, increment current, save\n\n## Acceptance Criteria\n- Completed phases are skipped on resume\n- Current phase tracked before execution\n- Phase completion persisted immediately (before next phase)\n- Failure state recorded for debugging\n\n## Usage Example\n```bash\nrun_phase 1 \"User Normalization\" install_phase_1\nrun_phase 2 \"APT Packages\" install_phase_2\nrun_phase 3 \"Shell Setup\" install_phase_3\n# ... etc\n```\n\n## Files to Modify\n- install.sh: Wrap all phase calls with run_phase()","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T12:42:41.718027-05:00","updated_at":"2025-12-21T14:42:02.906151-05:00","closed_at":"2025-12-21T14:42:02.906151-05:00","close_reason":"Implemented run_phase() wrapper in scripts/lib/state.sh with phase skipping, state tracking, timing, and logging integration.","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yaj","depends_on_id":"agentic_coding_flywheel_setup-uxc","type":"blocks","created_at":"2025-12-21T12:47:27.913015-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-yh5","title":"run_as_user: make curl|bash pipelines fail fast","description":"Several scripts/lib/* helpers run commands as TARGET_USER via `bash -c \"$cmd\"` (agents.sh, languages.sh, cli_tools.sh, cloud_db.sh, stack.sh). That new bash does not inherit pipefail, so `curl ... | bash` can return success when curl fails (bash runs empty input). Prefix the spawned shell with `set -o pipefail;` so pipeline failures propagate correctly.","status":"closed","priority":1,"issue_type":"bug","assignee":"FuchsiaCreek","created_at":"2025-12-20T17:21:53.334333-05:00","updated_at":"2025-12-20T17:35:11.544723-05:00","closed_at":"2025-12-20T17:35:11.544723-05:00","close_reason":"Already implemented on main in commit 0de3e7330b2d133789f85167c063c0c9bee7cd52 (adds set -o pipefail to run-as-user helpers)."}
{"id":"agentic_coding_flywheel_setup-yn6","title":"[codex.2] Fix agents.sh codex setup messages","description":"## Goal\nUpdate scripts/lib/agents.sh to provide correct guidance for codex-cli authentication.\n\n## Current (Incorrect) Messages\n1. After install: \"Note: Set OPENAI_API_KEY or run 'codex' to complete login\"\n2. Status check: \"not configured (set OPENAI_API_KEY or run 'codex')\"\n3. Next steps: \"Codex: Set OPENAI_API_KEY or run 'codex'\"\n\n## Correct Messages\n1. After install: \"Run 'codex auth' to authenticate with your ChatGPT Pro account\"\n2. Status check: \"not configured (run 'codex auth' to login)\"\n3. Next steps: \"Codex: Run 'codex auth' and complete browser login\"\n\n## Additional Context to Add\nThe messages should clarify:\n- Uses ChatGPT Pro/Plus account (not API account)\n- Authentication via web browser (OAuth flow)\n- May need to enable device access in ChatGPT security settings\n\n## Files to Modify\n- scripts/lib/agents.sh: Update log messages in install_codex_cli(), verify_agent_auth()\n- Regenerate scripts/generated/install_agents.sh after changes\n\n## Acceptance Criteria\n1. No mention of OPENAI_API_KEY for codex auth\n2. Clear guidance to use codex auth command\n3. Mention of ChatGPT Pro account (not API account)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T16:25:35.687293-05:00","updated_at":"2025-12-21T16:39:44.607676-05:00","closed_at":"2025-12-21T16:39:44.607676-05:00","close_reason":"Fixed all codex auth messages in agents.sh to use OAuth login instead of OPENAI_API_KEY","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-yn6","depends_on_id":"agentic_coding_flywheel_setup-ua5","type":"blocks","created_at":"2025-12-21T16:26:35.867431-05:00","created_by":"daemon"},{"issue_id":"agentic_coding_flywheel_setup-yn6","depends_on_id":"agentic_coding_flywheel_setup-wy1","type":"blocks","created_at":"2025-12-21T16:26:37.297527-05:00","created_by":"daemon"}]}
{"id":"agentic_coding_flywheel_setup-ywk","title":"Create integration test for resume behavior","description":"# Task: Create integration test for resume behavior\n\n## Context\nPart of EPIC: Phase-Granular Progress Persistence (agentic_coding_flywheel_setup-5uu)\n\n## Why Testing is Critical\nResume behavior is complex and bugs could cause:\n- Users losing progress (defeats the purpose)\n- Infinite loops (always resumes to same point)\n- Skipping phases that weren't complete\n- Data corruption in state file\n\n## Test Scenarios\n\n### 1. Normal resume\n- Run install, stop after phase 5\n- Re-run, verify phases 1-5 skipped, 6+ run\n\n### 2. Corrupted state\n- Create invalid state.json\n- Run install, verify recovery prompt shown\n\n### 3. Force reinstall\n- Run install, stop after phase 5\n- Re-run with --force-reinstall\n- Verify all phases run\n\n### 4. Interrupt during phase\n- Run install, interrupt mid-phase\n- Re-run, verify that phase runs again\n\n### 5. Version mismatch\n- Create state.json with different version\n- Verify warning shown\n\n## Implementation\nAdd to tests/vm/test_install_ubuntu.sh or create tests/resume_test.sh\n\n## Acceptance Criteria\n- All 5 scenarios tested\n- Tests can run in CI (Docker)\n- Clear pass/fail output\n- Tests don't modify production state\n\n## Files to Create\n- tests/resume_test.sh or modify existing test script","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T12:51:54.987501-05:00","updated_at":"2025-12-21T15:01:17.969637-05:00","closed_at":"2025-12-21T15:01:17.969637-05:00","close_reason":"Completed","dependencies":[{"issue_id":"agentic_coding_flywheel_setup-ywk","depends_on_id":"agentic_coding_flywheel_setup-yaj","type":"blocks","created_at":"2025-12-21T12:52:06.405711-05:00","created_by":"daemon"}]}
